<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org story by grinder: This Fortnight on perl5-porters - 3-16 April 2006</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>This Fortnight on perl5-porters - 3-16 April 2006</h1>
<h2><a href="/user/grinder/">grinder</a> on 2006-04-20T08:30:00</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>The porters concentrate on the Coverity reports, cleaning up
a collection of crazy, curious and crufty code constructs.</p>
<p><h1> <a name="topics_of_interest">Topics of Interest</a> </h1>
<p>
<h2> <a name="even_more_recursion_removed_from_the_regex_engine">Even more recursion removed from the regex engine</a> </h2>
</p> <p>Dave Mitchell continued his quest to improve the regexp engine. In
this batch of changes, he used slab allocations to deal with the
hassle of saving the context required for dealing with backtracking.</p>
<p>With a couple of other improvements, the performance is now back to
where it was when the engine used a recursive approach, so the
efficiency is the same now as it was then. More importantly, he
also removed the final recursion path triggered by <code>(??(..code..})</code>
assertions. This opens the way to a number of other improvements.</p>
<p>The only downside is that at the moment it looks like the changes
are so extensive that it is unlikely to be backported to <code>maint</code>.</p>
<pre>
  Watch this space
  <a href="http://xrl.us/kw8f">http://xrl.us/kw8f</a> </pre>
<p>Andy Lester later scavenged a bit of unused code in <em>regexec.c</em>,
which made Dave realise that the code was only unused because he
had accidentally deleted some other code that referred to it. So
he reverted Andy's change and restored the code he had removed.</p>
<pre>
  Whatever gets you there
  <a href="http://xrl.us/kw8g">http://xrl.us/kw8g</a> </pre>
<p>
<h2> <a name="empty_keys_in__config">Empty keys in <code>%Config</code> </a> </h2>
</p> <p>Brendan O'Dea forwarded a wacky bug from Debian, in that <code>%Config</code>
has some place-holders for paths to programs like <code>tail(1)</code> or
<code>sendmail(1)</code>, but <em>Configure</em> never probes for them, so they
are left empty. One would have to run something like</p>
<pre>
  Configure -Dtail=/usr/local/bin/tail</pre>
<p>and then write code like</p>
<pre>
  my $tail = $Config{tail} || '/usr/bin/tail';</pre>
<p>in order to make any use of it, and thus wanted to know what the
idea was. Despite his best <code>Configure</code>-fu, H.Merijn Brand was
at a loss to explain why these (but not all) values were empty,
because it was set up to in fact probe for them.</p>
<p>Andy Dougherty provided the missing pieces of the puzzle, which
was sufficient for H.Merijn to figure out what was happening,
and how to fix it.</p>
<pre>
  H.Merijn gets some more -fu
  <a href="http://xrl.us/kw8h">http://xrl.us/kw8h</a> </pre>
<p>Some time prior to the above thread, H.Merijn made a plea to
get people to test <code>Configure</code>, as it has received a good
working over recently, and some things may have been broken
in the process.</p>
<pre>
  Test this
  <a href="http://xrl.us/kw8i">http://xrl.us/kw8i</a> </pre>
<p>
<h2> <a name="coverity_defect_scan_of_perl">Coverity defect scan of Perl</a> </h2>
</p> <p>A while back, Coverity announced that it had applied its source
code analysis tool to a number of high-profile open source
projects. At the outset, Perl had a very favourable ratio of
defects to lines of source code.</p>
<p>Nicholas Clark noted with dismay that a number of other projects
(PHP, PostgreSQL and Samba) had since addressed every single reported
defect, thereby pushing Perl to the back of the pack. Benjamin
Holzman and Andy Dougherty went looking to see what they could do.</p>
<pre>
  &quot;Issue&quot; is probably more accurate than &quot;defect&quot;
  <a href="http://xrl.us/kw8j">http://xrl.us/kw8j</a> </pre>
<pre>
  The current state of play
  <a href="http://scan.coverity.com/">http://scan.coverity.com/</a> </pre>
<p>
<h2> <a name="acting_upon_the_coverity_findings">Acting upon the Coverity findings</a> </h2>
</p> <p>Andy Lester started working through the warnings produced by the
Coverity source code analysis tool. The first thing he dealt with was
some dubious <code>#ifdef</code>s dealing with <code>SOCKS5</code>-specific code,</p>
<pre>
  Clean socks
  <a href="http://xrl.us/kw8k">http://xrl.us/kw8k</a> </pre>
<p>and tightened up some code in <em>pp.c</em> that should be clearer to both
humans and source code analysis tools,</p>
<pre>
  Everyone's a winner
  <a href="http://xrl.us/kw8m">http://xrl.us/kw8m</a> </pre>
<p>and tidied up some code in <em>pp.c</em> that, while not officially
<em>wrong</em>, was certainly of dubious merit.</p>
<pre>
  Barely legal
  <a href="http://xrl.us/kw8n">http://xrl.us/kw8n</a> </pre>
<p>Jarkko fixed <em>locale.c</em>,</p>
<pre>
  <a href="http://xrl.us/kw8o">http://xrl.us/kw8o</a> </pre>
<p>and since he enjoyed it so much, he did it again,</p>
<pre>
  <a href="http://xrl.us/kw8p">http://xrl.us/kw8p</a> </pre>
<p>and then examined another issue that arose when you set
<code>$/ = \0</code>, and documented that as well,</p>
<pre>
  One less undocumented feature
  <a href="http://xrl.us/kw8q">http://xrl.us/kw8q</a> </pre>
<p>and continued by adding <code>NULL</code> guards to calls to <code>IoIFP</code> in <em>pp_sys.c</em>,</p>
<pre>
  <a href="http://xrl.us/kw8r">http://xrl.us/kw8r</a> </pre>
<p>not to mention a similar problem concerning formats, also in <em>pp_sys.c</em>,</p>
<pre>
  Little wonder this was never encountered
  <a href="http://xrl.us/kw8s">http://xrl.us/kw8s</a> </pre>
<p>and added an <code>assert</code> in <em>perlio.c</em>, which should be sufficient for Coverity
to understand what is going on. Alas, Nicholas noted that it doesn't appear
to believe perl's special home-grown <code>assert</code>. So Jarkko added a comment
that should be understandable by a human (and tough beans for Coverity),</p>
<pre>
  <a href="http://xrl.us/kw8t">http://xrl.us/kw8t</a> </pre>
<p>Andy then guarded a pointer dereference, by ensuring that it points to something
useful (that is, something other than <code>NULL</code>) in <em>regcomp.c</em>,</p>
<pre>
  <a href="http://xrl.us/kw8u">http://xrl.us/kw8u</a> </pre>
<p>attempted to indicate that <code>listsv</code> is never <code>NULL</code>, elsewhere in
the same file,</p>
<pre>
  <a href="http://xrl.us/kw8v">http://xrl.us/kw8v</a> </pre>
<p>but amended it following a suggestion by Nicholas.</p>
<pre>
  <a href="http://xrl.us/kw8w">http://xrl.us/kw8w</a> </pre>
<p>In <em>regexec.c</em>, Jarkko moved a <code>NULL</code> check in the hope that it
would allow Coverity to make better sense of the code,</p>
<pre>
  <a href="http://xrl.us/kw8x">http://xrl.us/kw8x</a> </pre>
<p>but that appeared insufficient, and so he hoisted the check even further
up in the routine, blowing away Andy's delicate <code>const</code>ing work in the
process,</p>
<pre>
  Real Men don't use const
  <a href="http://xrl.us/kw8y">http://xrl.us/kw8y</a> </pre>
<p>and added another <code>NULL</code> check. Dave Mitchell thought that this was
slightly pointless, for if the variable in question really was
<code>NULL</code> at that time, then the pattern was in such trouble that
stopping to check whether the variable contains <code>NULL</code> is just
rearranging the deck-chairs.</p>
<pre>
  <a href="http://xrl.us/kw8z">http://xrl.us/kw8z</a> </pre>
<p>Jarkko then plugged up a leaking file handle in
<em>ext/XS/Typemap/Typemap.xs</em>. Unfortunately, the obvious one line
fix was also incredibly wrong, causing bad things to happen, which
left Jarkko and Nicholas scratching their heads.</p>
<p>Tim Jenness recalled that there was a discussion on this issue a
few years back, and the gist of the problem is that when a handle
is created in XS, the core takes over and claims the responsibility
of of closing it for you. A mechanism to prevent this delegation
from occurring is available for XS authors who need it, but it is
not ideal in the general case, as it prevents useful DWIMmery from
taking place, such as (surprise!) closing the file.</p>
<pre>
  Too clever, or not clever enough
  <a href="http://xrl.us/kw82">http://xrl.us/kw82</a> </pre>
<p>Jarkko carried on and clarified a pointer aliasing issue, by removing
a temporary alias hanging around in <em>perlio.c</em>,</p>
<pre>
  <a href="http://xrl.us/kw83">http://xrl.us/kw83</a> </pre>
<p>and another temporary in the same file that caused Coverity to think
there was a resource leak.</p>
<pre>
  <a href="http://xrl.us/kw84">http://xrl.us/kw84</a> </pre>
<p>and yet another problem of allocated but unused memory, also in <em>perlio.c</em>.
This time Jarkko tried to edit the diff after generation, but was caught out by
Coverit^WNicholas, who applied the change that Jarkko meant to make in the
first place.</p>
<pre>
  <a href="http://xrl.us/kw84">http://xrl.us/kw84</a> </pre>
<p>Coverity fussed over a section of code in <em>doop.c</em> that in fact only
scratched the surface of the main problem. Jarkko added a slew of tests
to <em>bop.t</em> and fixed the real problem in the code.</p>
<pre>
  <a href="http://xrl.us/kw85">http://xrl.us/kw85</a> </pre>
<p>Yitzchak Scott-Thoennes followed up on <em>ext/Filter/Util/Call/Call.c</em> where
calling <code>filter_read(-1)</code> would indeed produce spectacular badness. The
solution probably lies in removing the signedness from the variable used,
but in any event, some sort of sanity checking should be added.</p>
<pre>
  <a href="http://xrl.us/kw86">http://xrl.us/kw86</a> </pre>
<p>Yitzchak also found a problem with <code>NULL</code> in <em>ext/Socket/Socket.c</em>, and
wondered whether the code was over-engineered, and chopping out a
conditional would improve matters. Again, a defensive approach to bad
data will be required.</p>
<pre>
  <a href="http://xrl.us/kw87">http://xrl.us/kw87</a> </pre>
<p>Yitzchak also prodded Nicholas into making a change to clear up an
issue in <em>ext/IO/IO.c</em>. While it appears out that many of these
issues are in fact "Can't Happen" problems from within perl, since
they are guarded against elsewhere, it may wind up helping the
development of XS modules, since garbage values may be caught
earlier, rather than a core dump 20000 statements later on.</p>
<pre>
  <a href="http://xrl.us/kw88">http://xrl.us/kw88</a> </pre>
<p>Benjamin Holzman came back with a fix for what is probably a "Can't Happen"
bug in <code>Storable</code>,</p>
<pre>
  <a href="http://xrl.us/kw8n">http://xrl.us/kw8n</a> </pre>
<p>and another safety check in <em>pp_sys.c</em> that could only be triggered by
XS code going out to lunch.</p>
<pre>
  <a href="http://xrl.us/kw89">http://xrl.us/kw89</a> </pre>
<p>Andy Dougherty looked at <em>toke.c</em> and found that Coverity incorrectly
flagged some code in a loop as dead when in fact it could be reached
the second time around. He therefore wanted to add a Coverity-friendly
message to signal that it was legitimately <code>ENOTABUG</code> so that
Coverity would not count it as a defect in the following round.</p>
<p>Two possibilities are available, either a C comment that adheres to
a specific format &#224; la <code>lint</code>, or adding an entry to their on-line
database.</p>
<p>He wondered whether, as a matter of policy, the comment should
appear in the source (thus making a visible reference to what is,
at the end of the day, a commercial product, and therefore giving
them a sprinkling of mindshare), or just using the database. He
favoured the comment approach.</p>
<p>Andy Lester voted against the idea, arguing that tools come and
go, but comments tend to remain (and worse, drift out of date).
John Peacock voted for, arguing that if Coverity were to disappear
tomorrow, we could always <code>grep</code> the codebase to strip them out.</p>
<p>Hugo van der Sanden remarked that he had regularly spent time chasing
through the source to determine whether a possible path between two
points of code existed, and thought that Coverity was probably
unable to perform the required gymnastics to arrive at a similar
conclusion. Be that as it may, an occasional comment in the source,
explaining these matters to future porters, would not go amiss. If
Coverity can't figure it out, that's their problem.</p>
<p>Adam Kennedy was against the comment idea too, offering the hypothesis
of what was not a bug initially, becoming a real bug in six months
time due to an innocuous change elsewhere, but the report being
suppressed due to the initial Coverity comment. This reminds me of
advice from Klortho, #11922: You don't suppress error messages, you
dumbass, you <strong>PAY ATTENTION</strong> and try to understand them.</p>
<pre>
  The correct use of comments
  <a href="http://xrl.us/kw9a">http://xrl.us/kw9a</a> </pre>
<p>Andy D. then found what was probably a genuine problem, at least
as far as clarity of intent is concerned, in <em>utf8.c</em>.</p>
<pre>
  <a href="http://xrl.us/kw9b">http://xrl.us/kw9b</a> </pre>
<p>Andy also looked at an issue in <em>hv.c</em>, which he traced to change
#24810 made by Nicholas last year, but the simple fix would create
a visible change in behaviour from the public API, and the
complex fix was too much for him to deal with without assistance.</p>
<p>It turns out that Coverity was right, and Nicholas resolved it with
change #27761, adding a regression test that exercised some code which
until now had always remained unvisited by the test suite.</p>
<pre>
  Bonus statement coverage improvement
  <a href="http://xrl.us/kw9c">http://xrl.us/kw9c</a> </pre>
<p>After his initial call to arms, Nicholas had a closer look at some
of the defects. One in particular caught his eye made his wonder
whether the problem was not in fact a bug in Coverity's analysis,
and whether it should be reported to Coverity. David Landgren
noted that on the <code>postfix-users</code> mailing list, Wietse Venema
had announced a new release of Postfix, that in part dealt with
Coverity findings, many of which were false positives.</p>
<pre>
  Wietse's thoughts on Coverity
  <a href="http://comments.gmane.org/gmane.mail.postfix.user/139710">http://comments.gmane.org/gmane.mail.postfix.user/139710</a> </pre>
<p>
<h2> <a name="a_first_cut_at_state_variables">A first cut at <code>state</code> variables</a> </h2>
</p> <p>For a long time, the only technique for creating static variables
in functions &#224; la C was to use the dubious (and now, deprecated)
<code>my $var if 0</code> construct. (The officially sanctioned approach is
to use an outer (<code>BEGIN</code> or bare) block and hoist the variable
outside the function).</p>
<p>This situation started to change this week, when Rafael Garcia-Suarez
landed his first draft to add <code>state</code> variable to perl. Now you can
do the following:</p>
<pre>
  $ bleadperl -le 'sub f { state $x = 10; print $x++ } f; f; f'
  10
  11
  12</pre>
<p>This will be available via <code>use feature 'state'</code>. I thought it
was nifty. A couple of people threw up their hands in horror.</p>
<p>In order to proceed, what is needed are more tests, and to
implement state arrays and hashes as well.</p>
<pre>
  A little rough around the edges
  <a href="http://xrl.us/kw9d">http://xrl.us/kw9d</a> </pre>
<p>
<h2> <a name="underscores_in_version_numbers">Underscores in version numbers</a> </h2>
</p> <p>Jan Dubois kicked off an interesting thread concerning underscores
in version numbers, the problems they pose, how to work around those
problems, what happens with dual-lifed modules, the CPAN indexer
and a mythical script belonging to Randal that checks if the universe
is in sync.</p>
<pre>
  I never know which version I'm going to be
  <a href="http://xrl.us/kw9e">http://xrl.us/kw9e</a> </pre>
<p>
<h2> <a name="benchmarking_perlbench">Benchmarking <code>perlbench</code> </a> </h2>
</p> <p>Jim Cromie presented some benchmarks concerning his work to <strong>replace
<code>S_new_HE</code> with <code>Perl_new_body</code> </strong> and asked for some advice as to
how to proceed, and received none.</p>
<pre>
  <a href="http://xrl.us/kw9f">http://xrl.us/kw9f</a> </pre>
<p>Following on from these efforts, Jim looked at benchmarking the
same executable against itself five times. He was happy that the
overall averages all came out to 100%, but many individual tests
showed variations of up to 2%.</p>
<p>Jim felt that this constituted a threshold noise factor, below which
differences are worthless. Jim then wondered whether different CPUs
and platforms would have different thresholds, and whether such
information should be collected in a more systematic manner.</p>
<pre>
  Benchmarking perlbench
  <a href="http://xrl.us/kw9g">http://xrl.us/kw9g</a> </pre>
<p>
<h2> <a name="doing_battle_with_old_aix_compilers">Doing battle with old AIX compilers</a> </h2>
</p> <p>Jarkko discovered that AIX's <code>xlc</code> C compiler will do the following:</p>
<pre>
  #define FOO(n) printf(&quot;n = %d\n&quot;, n)
  FOO(10); # expands to &quot;10 = 10\10&quot;</pre>
<p>which is, while apparently legal, also quite useless. He therefore
patched a couple of files to work around the breakage this introduces.
Lukas Mai cited the C standard, chapter and verse (ISO 9899:1999, page
152, footnote 144) that indicates that the above compiler
behaviour is indeed incorrect.</p>
<p>Nick Ing-Simmons said that it used to be legal, but ANSI/ISO
tightened the specification in a latter revision to the standard,
and the compiler is adhering to the previous standard.
H.Merijn Brand pointed out that other "old" compilers continue
to be supported as capable of compiler perl, and offered some
insights into the issues surrounding C compilers on AIX.</p>
<pre>
  What could you do with a macro like that?
  <a href="http://xrl.us/kw9h">http://xrl.us/kw9h</a> </pre>
<p>
<h2> <a name="open_fh_______in_not_like_open_fh_______"> <code>open(FH, ...)</code> in not like <code>open FH, (...)</code> </a> </h2>
</p> <p>Ken Williams was trying to concoct a multi-argument open function
to avoid using backticks, and the attendant shell-quoting problems,
but was having trouble sneaking it past 5.005. It wouldn't actually
have to run on 5.005, but everything Ken tried resulted in
compile-time errors, or else if it was accepted by 5.005, it didn't
do anything useful on 5.6+.</p>
<p>Mike Guy offered a venerably ancient technique that would possibly
still work with punched cards, and had an added bonus of separating
out the <code>open</code> and <code>fork</code> into discrete steps, thereby permitting
fine-grained error checking.</p>
<pre>
  Revise your classics
  <a href="http://xrl.us/kw9i">http://xrl.us/kw9i</a> </pre>
<p>
<h2> <a name="looking_for_cutandpaste_programming">Looking for cut-and-paste programming</a> </h2>
</p> <p>Jarkko launched <code>cpd</code> (cut-and-paste-detector) at a recent copy of
<code>blead</code> to see what would happen. Andy Lester was so impressed he
wanted a Makefile <code>cpd</code> target so that he could see how it was
invoked. Jarkko deferred, saying that the tool is still a little
fragile, being unable to parse perl's source code completely. At
the moment he's working with the author to shake out the remaining
bugs.</p>
<pre>
  Stand back
  <a href="http://xrl.us/kw9j">http://xrl.us/kw9j</a> </pre>
<p>Andy then took the chainsaw to <em>dump.c</em>. which had acquired some
duplicated code in the process of incorporating Larry Wall's MAD
work.</p>
<p>(In case I haven't mentioned it already, MAD stands for
Misc Attribute Decoration and is the process of hanging sufficient
information off the op-tree to be able to recover the source
code afterwards. Up until now, the compilation phase has simply
been required to produce bytecode for the run-time interpreter,
and it's usually impossible to figure out by inspecting the
bytecode to figure out what the original Perl source would have
looked like (think: peep-hole optimisations).</p>
<p>Being able to go from source code to bytecode back to
source code is an important step in getting Perl 6 to run Perl 5
code).</p>
<pre>
  <a href="http://xrl.us/kw9k">http://xrl.us/kw9k</a> </pre>
<p>The first time through, the patch didn't stick, so Andy did it
again.</p>
<pre>
  <a href="http://xrl.us/kw9m">http://xrl.us/kw9m</a> </pre>
<pre>
  CPD project page
  <a href="http://pmd.sourceforge.net/cpd.html">http://pmd.sourceforge.net/cpd.html</a> </pre>
<p>
<h2> <a name="measuring_code_complexity">Measuring code complexity</a> </h2>
</p> <p>Jarkko finished with a discussion on code complexity, noting that
Coverity gives you the McCabe Cyclomatic Complexity, the Halstead
Effort and the Halstead Error Estimate. The results of for perl
seem about right: <code>Perl_keyword</code> in <em>toke.c</em> is as complex as the
following thirteen most complex functions combined (featuring such
family favourites as <code>Perl_magic_get</code>, <code>Perl_is_gv_magical</code> and
<code>S_looks_like_bool</code>).</p>
<p>Yitzchak wanted to know whether macros were expanded or not in
calculating the indices, because in a codebase with such heavy
uses of macros as perl's, the differences in perceived complexity
are significant. Jarkko thought that they weren't. Anything that
attempted to resolve the macros in <em>sv.c</em> would blow a fuse.</p>
<pre>
  Statistician's delight
  <a href="http://xrl.us/kw9n">http://xrl.us/kw9n</a> </pre>
<p>
<hr>
<h1> <a name="patches_of_interest">Patches of Interest</a> </h1>
</p> <p>
<h2> <a name="wrapping_up_the_io__socket_tests_on_win32">Wrapping up the <code>IO::Socket</code> tests on <code>Win32</code> </a> </h2>
</p> <p>Yves Orton polished his patch to make the <code>IO::Socket</code> tests pass on
<code>Win32</code>. Jim Cromie updated <em>concise-xs.t</em>, because the <code>B::Concise</code>
tests picked up the API changes that Yves introduced.</p>
<pre>
  All sockets are go
  <a href="http://xrl.us/kqp4">http://xrl.us/kqp4</a> </pre>
<p>In another sub-thread on this topic, Nick Ing-Simmons circled back
to the problem of how to determine whether a Windows perl can <code>fork</code>
or not. The problem is one of semantics: yes, perl on Windows can
<code>fork</code>, but without creating a new process, or allocating a new
memory space, so it hardly counts as a POSIX <code>fork</code>, even if it
looks the same at a certain distance.</p>
<p>For this reason, the <code>$Config{d_fork}</code> should not be used on <code>Win32</code>.
Andy Dougherty nevertheless maintained that <em>something</em> in <code>%Config</code>
should be available, such as a putative <code>$Config{d_pseudofork}</code> key,
the idea being that people shouldn't have to grovel through
<code>$Config{ccflags}</code> to try to determine whether particular combination
of flags present or absent means that a specific feature or behaviour
is available.</p>
<pre>
  So I guess we need a meta $Config{some_sort_of_fork}
  <a href="http://xrl.us/kw9o">http://xrl.us/kw9o</a> </pre>
<p>
<h2> <a name="overridable_filetest_operators">Overridable filetest operators</a> </h2>
</p> <p>Salvador Fandi&#241;o pitched his patch to add <code>/</code>, <code>^</code> and <code>1</code> as
prototypes for user function to allow them to mimic accurately the
built-in functions.</p>
<pre>
  Warnocked
  <a href="http://xrl.us/kw9p">http://xrl.us/kw9p</a> </pre>
<p>
<h2> <a name="renaming_variables_in_some_mg_c_routines">Renaming variables in some <em>mg.c</em> routines</a> </h2>
</p> <p>Andy Lester noted that in a couple of routines, nothing is ever read from
the <code>mg</code> parameters that are passed in, and worse, are used by the code
to stash intermediate calculations. So Andy marked them as Unused, and
declared some new local variables whose names better reflect their purpose.</p>
<pre>
  Refactoring at its finest
  <a href="http://xrl.us/kw9q">http://xrl.us/kw9q</a> </pre>
<p>
<hr>
<h1> <a name="new_and_old_bugs_from_rt">New and old bugs from RT</a> </h1>
</p> <p>
<h2> <a name="chr_65535__should_be_allowed_in_regexes___38293_"> <code>chr(65535)</code> should be allowed in regexes (#38293)</a> </h2>
</p> <p>Back in January, Marc Lehmann filed a bug report concerning the
possibilities available for matching (or not) <code>chr(65535)</code>.
Sadahiro-san, resident UTF-8 guru, examined the problem in
depth, uncovered a number of inconsistencies surrounding such
Unicode code-points and wrote a patch to clean it up. Said
patch includes tests (yay!) to ensure the problem doesn't
come back, and more tests (double yay!) for a related bug
(#37836).</p>
<p>Rafael wondered whether <em>perlunicode.pod</em> should be updated
to document more precisely what happens when <code>use warnings 'utf8'</code>
is in force, but Tomoyuki answered that it would probably be
better to rework perl to deal with Unicode non-characters more
reasonably, as per the standard.</p>
<pre>
  <a href="http://xrl.us/kw9r">http://xrl.us/kw9r</a> </pre>
<p>At the same time, Ilya Zakharevich ran into this exact problem on
<code>comp.lang.perl.misc</code>.</p>
<pre>
  It's a small world
  <a href="http://xrl.us/kw9s">http://xrl.us/kw9s</a> </pre>
<p>
<h2> <a name="_____pat______doesn_t_set__1___37407_"> <code>/(??{ &quot;(PAT)&quot; })/</code> doesn't set <code>$1</code> (#37407)</a> </h2>
</p> <p>Dominic Dunlop returned to this bug, noting that</p>
<pre>
  my $dot = qr{ () }x;
  &quot;&quot; =~ /(??{ $dot })/x;</pre>
<p>no longer dumps core on <code>blead</code>, but then again it doesn't dump core
for 5.8.6 or 5.8.8 either. On the other hand,</p>
<pre>
  &quot;a&quot; =~ /(??{ &quot;(a)&quot; })/</pre>
<p>which was Abigail's original problem in the bug report doesn't capture
the 'a' into <code>$1</code>. Hugo thought that, given the documentation, this
was not a bug: the implementation just isn't up to this sort of caper.</p>
<p>Dominic thought that the documentation should be tightened up to explain
more precisely how <code>(??{})</code> currently behaves. Abigail conceded the
point, but offered a specific real world example where the ability
would come in handy (matching shortened IPv6 addresses).</p>
<pre>
  <a href="http://xrl.us/kw9t">http://xrl.us/kw9t</a> </pre>
<p>
<h2> <a name="memory_leak_occurs_when_an_eval_statement_exits_by_a_signal___38854_">Memory leak occurs when an <code>eval</code> statement exits by a signal (#38854)</a> </h2>
</p> <p>Itsuro Oda reported a problem when dying via a <code>SIGALRM</code> handler
in an <code>eval</code> block, with a nice short test case to show the good
and the bad.</p>
<pre>
  Warnocked
  <a href="http://xrl.us/kw9u">http://xrl.us/kw9u</a> </pre>
<p>
<h2> <a name="failing_to_build_lib_file_basename_pm___38891_">Failing to build <em>lib/File/Basename.pm</em> (#38891)</a> </h2>
</p> <p>Cliff Liu tried to build perl, and it failed with some
peculiar errors when building <em>lib/File/Basename.pm</em>.</p>
<pre>
  <a href="http://xrl.us/kw9v">http://xrl.us/kw9v</a> </pre>
<p>
<h2> <a name="those_bleeding_greedy_quantifiers___38906_">Those bleeding greedy quantifiers (#38906)</a> </h2>
</p> <p>Japhy found an odd corner-case in the regexp engine where greediness
and quantifiers get confused and located the likely culprit in
<em>regexec.c</em>. "Animator" took a stab at resolving the problem,
which is no mean feat considering it was <code>h(?:er|is)</code> first attempt at
patching the regexp engine. Dave Mitchell took it and cleaned it up
for <code>blead</code> and included Japhy's original test-case bug snippets.</p>
<pre>
  <a href="http://xrl.us/kw9w">http://xrl.us/kw9w</a> </pre>
<p>
<h2> <a name="perl5_bug_summary">Perl5 Bug Summary</a> </h2>
</p> <p>The week before last (twenty less than the previous week, all hail
Steve Peters):</p>
<pre>
  <a href="http://xrl.us/kw9x">http://xrl.us/kw9x</a> </pre>
<p>Last week (six more closed):</p>
<pre>
  <a href="http://xrl.us/kw9y">http://xrl.us/kw9y</a> </pre>
<pre>
  The remaining 1537 are here
  <a href="http://rt.perl.org/rt3/NoAuth/perl5/Overview.html">http://rt.perl.org/rt3/NoAuth/perl5/Overview.html</a> </pre>
<p>
<hr>
<h1> <a name="new_core_modules">New Core Modules</a> </h1>
</p> <ul>
<li>
<p>ExtUtils-Install version 1.38 uploaded by Yves Orton. This handles the
problems on Win32 dealing with the unlinking of open files, and also
adds an <code>INSTALL.SKIP</code> directive that users of revision control systems
should appreciate.</p>
<p>Following a query from Rafael, Yves explained the difference between
<code>INSTALL.SKIP</code> and <code>MANIFEST.SKIP</code>.</p>
<pre>
  <a href="http://xrl.us/kw9z">http://xrl.us/kw9z</a> </pre>
</li>
<li>
<p>H.Merijn Brand uploaded The latest and greatest <code>dor</code> patch
(the <code>$var //= $eigenvalue</code> trick from Perl 6) for application to
to the current <code>maint</code> snapshot. Not exactly a module, but hard to
live without once you've grown used to it.</p>
<pre>
  <a href="http://xrl.us/kw92">http://xrl.us/kw92</a> </pre>
</li>
</ul>
<p>
<hr>
<h1> <a name="in_brief">In Brief</a> </h1>
</p> <p>The <strong> <code>use sort 'stable'</code> sorting in reverse</strong> bug was fixed by
Robin Houston.</p>
<pre>
  <a href="http://xrl.us/kw93">http://xrl.us/kw93</a> </pre>
<p>Jarkko Hietaniemi patched <strong> <code>ext/IO/t/io_unix.t</code> to fall back and
use <em>/tmp</em> </strong> should the current working directory have permissions
too restrictive to allow sockets to be created.</p>
<pre>
  <a href="http://xrl.us/kw94">http://xrl.us/kw94</a> </pre>
<p>The issue with <strong> <code>pow</code> failures on AIX</strong>, and how to work around
it, was sorted out.</p>
<pre>
  <a href="http://xrl.us/kw95">http://xrl.us/kw95</a> </pre>
<p>Jim Cromie supplied a long update to his current obsession (<strong>arenas
for op-codes</strong>), and a patch to <em>sv.c</em>.</p>
<pre>
  <a href="http://xrl.us/kw96">http://xrl.us/kw96</a> </pre>
<p>Nicholas Clark noted that <strong>a better strategy for testing <code>Perl_ss_dup</code> </strong>
is required, as it never gets called on Unix, as its main use is in
association with the pseudo-forking code on Windows.</p>
<pre>
  <a href="http://xrl.us/kw97">http://xrl.us/kw97</a> </pre>
<p>Hugo van der Sanden fixed a problem <strong>setting <code>%ENV</code> keys to
<code>undef</code> </strong> that was causing the test suite to emit a faint burning smell.</p>
<pre>
  <a href="http://xrl.us/kw98">http://xrl.us/kw98</a> </pre>
<p>Jerry D. Hedden reposted his <strong>patch to sync <code>blead</code>'s <code>threads</code>
with CPAN</strong>. Rafael found that it did not compile on older versions
of HP-UX (that is, 10.20, unsupported by HP for a couple of years
now). This will be cleaned up in a subsequent patch.</p>
<pre>
  <a href="http://xrl.us/kw99">http://xrl.us/kw99</a> </pre>
<p>More changes here:</p>
<pre>
  <a href="http://xrl.us/kxaa">http://xrl.us/kxaa</a> </pre>
<p>Jan Dubois patched <strong> <em>threads.pm</em> to overload the <code>!=</code> operator</strong>
as <code>==</code> is overloaded to allow threads to be compared by thread id,
since <em>overload.pm</em> cannot (or does not) implicitly derive <code>!=</code>
from <code>==</code>.</p>
<pre>
  <a href="http://xrl.us/kxab">http://xrl.us/kxab</a> </pre>
<p>In doing so, tidied up the placement of the  documentation for <code>~~</code>
(smart match).</p>
<pre>
  <a href="http://xrl.us/kxac">http://xrl.us/kxac</a> </pre>
<p>Joshua ben Jore arranged things so that <strong> <code>foreach (...)</code> isn't a
<code>B::Lint</code> warning anymore</strong>. Hugo and Rafael both commented on the
proposal, and Joshua defended his position with ease.</p>
<pre>
  <a href="http://xrl.us/kxad">http://xrl.us/kxad</a> </pre>
<p>Steve Hay was struggling with the <strong> <code>PERL_UNUSED_DECL</code> change
(27649) breaking threaded builds on Win32 with gcc-3.4.2</strong>.</p>
<pre>
  In space no-one can hear you scream
  <a href="http://xrl.us/kxae">http://xrl.us/kxae</a> </pre>
<p>Ravi Sastry had <strong>a problem with <em>lib/ExtUtils/t/Constant.t</em> on z/OS</strong>.
Sadahiro-san, resident EBCDIC guru, spotted an suspect ASCIIism in a
complemented character class and spelt it out longhand. A conversation
on the finer points of EBCDICisms ensued, and Ravi finally got it working
to his satisfaction.</p>
<pre>
  <a href="http://xrl.us/kxaf">http://xrl.us/kxaf</a> </pre>
<p>Continuing on z/OS, Mohammad Haseen had problems with
<code>-DPERL_EXTERNAL_GLOB</code>, which dictates to perl whether it should handle
globbing itself or defer to an external process.</p>
<pre>
  <a href="http://xrl.us/kxag">http://xrl.us/kxag</a> </pre>
<p>He was also having problems with <em>lib/ExtUtils/t/Embed.t</em>. Nick
Ing-Simmons was suspicious of the compiler switches used, and
suggested some work-arounds.</p>
<pre>
  <a href="http://xrl.us/kxah">http://xrl.us/kxah</a> </pre>
<p>Nick Ing-Simmons carefully explained <strong>the advantages and differences of
dynamic versus static builds of Perl</strong>.</p>
<pre>
  <a href="http://xrl.us/kxai">http://xrl.us/kxai</a> </pre>
<p>Upcoming versions of <strong>Solaris will permit 32-bit processes to open
more than 256 <code>stdio</code> file handles</strong>. Alan Burlison sent in a
pre-emptive patch to allow <code>gcc</code> to deal with the change.</p>
<pre>
  Your standard preprocessor trickery
  <a href="http://xrl.us/kxaj">http://xrl.us/kxaj</a> </pre>
<p>Dominic Dunlop went through RT looking for <strong>tickets involving
postponed regexes <code>(??{...})</code> </strong> and found nine. He then
summarised the situation of each one.</p>
<pre>
  <a href="http://xrl.us/kxak">http://xrl.us/kxak</a> </pre>
<p>Yann Combarnous offered a patch to silence an "uninitialized value"
warning in <em>CGI.pm</em> (bug #38865).</p>
<pre>
  <a href="http://xrl.us/kxam">http://xrl.us/kxam</a> </pre>
<p>Chris Dolan identified a problem with <strong>changing <code>$0</code> on Darwin leads
to excessive padding in <code>ps</code> </strong> (bug #38868)</p>
<pre>
  <a href="http://xrl.us/kxan">http://xrl.us/kxan</a> </pre>
<p>Jan Dubois posted a patch to ease <strong>the combination of UTF-16
with <code>:crlf</code> </strong>. Nick Ing-Simmons started to have second thoughts
on the approach.</p>
<pre>
  <a href="http://xrl.us/kxao">http://xrl.us/kxao</a> </pre>
<p>John E. Malmberg published an RFC concerning
<strong>UTF-8 file specifications on VMS</strong>. Steve Hay wanted the same for
<code>Win32</code>. Nicholas Clark helped John finalise his patch.</p>
<pre>
  <a href="http://xrl.us/kxap">http://xrl.us/kxap</a> </pre>
<p>Steffen Ullrich posted a bug showing how to crash perl by having
<strong> <code>$1</code> bound to an out-of-scope variable</strong>. (bug #38869)</p>
<pre>
  <a href="http://xrl.us/kxaq">http://xrl.us/kxaq</a> </pre>
<p>Joshua ben Jore is a sick person. He uses emacs for a start. On top
of that, he h(ij)?acked his syntax checking minor mode to <strong>refuse
to save the file if it doesn't lint cleanly</strong>. Download his code,
and you can too!</p>
<pre>
  <a href="http://xrl.us/kxar">http://xrl.us/kxar</a> </pre>
<p>Dan Kogai was happy to discover that <strong>search.cpan.org now groks the
<code>=encoding</code> directive</strong>, which improved the presentation of his
modules there. Tels rushed off to add Unicode examples to his POD.</p>
<pre>
  <a href="http://xrl.us/kxas">http://xrl.us/kxas</a> </pre>
<p>In between bouts of jousting with Coverity, Andy still found some time
to <strong>deliver some consting goodness in <em>regcomp.c</em> </strong>. Dave applied
most of it, but held back on one part as he's about to let more
<em>regcomp.c</em> improvements escape from the basement.</p>
<pre>
  <a href="http://xrl.us/kxat">http://xrl.us/kxat</a> </pre>
<p>Philip M. Gollucci <strong>ran into trouble</strong>, due to the recent changes
<strong>concerning <code>PERL_UNUSED_DECL</code> when compiling Apache's <code>apreq</code> </strong>.
It is apparently something to do with <em>ppport.h</em>, but his diff
appeared to rewrite <em>ppport.h</em> in its entirety, so I'm not sure
anyone knew what to do with it.</p>
<pre>
  <a href="http://xrl.us/kxau">http://xrl.us/kxau</a> </pre>
<p>Torsten Foertsch was having <strong>problems with <code>(&quot;x&quot;x32769)=~/\A(.)\1*\z/s
and print &quot;$1\n&quot;</code> </strong> and wondered what to do about it. Hugo explained
what was going wrong, and realised in passing that the <em>diagnostics.pm</em>
diagnostic needs a bit of work, following on from Dave's
recursive-to-iterative transformation of the regexp engine.</p>
<pre>
  <a href="http://xrl.us/kxav">http://xrl.us/kxav</a> </pre>
<p>Jerry D. Hedden took a third attempt at <strong>synching <code>blead</code> with
CPAN's <code>threads</code> </strong>. Rafael put it through the wringer and came
up with some problems in conjunction with <code>PERL_TRACK_MEMPOOL</code>
and offered advice as to where things could be breaking. Rafael
made a couple of other comments on the changes and finished
with a word of thanks, because few people have had the courage
to venture into this code and attempt to clean it up.</p>
<pre>
  <a href="http://xrl.us/kxaw">http://xrl.us/kxaw</a> </pre>
<p>Andy <strong>tweaked the <code>FIT_ARENA</code> macros</strong>. Jim Cromie explained that
what Andy had done was to re-merge a macro that H.Merijn had
previously split apart into two, but could no longer recall what
necessity had driven H.Merijn to do such a thing.</p>
<pre>
  <a href="http://xrl.us/kxax">http://xrl.us/kxax</a> </pre>
<p>Linda Walsh tweaked <strong> <em>Benchmark.pl</em> to remove spurious warning</strong>
that occurs when the <code>:hireswallclock</code> option is used.</p>
<pre>
  <a href="http://xrl.us/kxay">http://xrl.us/kxay</a> </pre>
<p>Jan Dubois taught <strong> <code>Pod::Html::depod()</code> how to deal with multi-line
strings</strong> and update the test suite to boot,</p>
<pre>
  <a href="http://xrl.us/kxaz">http://xrl.us/kxaz</a> </pre>
<p>and also fixed up <strong>anchor generation in <code>Pod::Html</code> for <code>=item item 2</code> </strong>.</p>
<pre>
  <a href="http://xrl.us/kxa2">http://xrl.us/kxa2</a> </pre>
<p>Herv&#233; Guillemet had a problem with <strong>nested closures losing
their references to outer variables</strong>, noted in bug (#38895).
Yitzchak explained that the problem had been fixed in <code>blead</code>,
but that the change was unlikely to make it back to <code>maint</code>,
and offered a simple technique to route around the damage.</p>
<pre>
  <a href="http://xrl.us/kxa3">http://xrl.us/kxa3</a> </pre>
<p>Andy Lester made a simple, but elegant improvement to <em>mg.c</em> to
make it clearer what was being returned in <code>Perl_magic_scalarpack</code>,
and elsewhere to split the use of variable that had been pressed into
use in two distinct roles into two separate variables. This is
has been pretty much the overall aim of Andy's refactorisations
over the past months; it's only now that he's starting to get there.</p>
<pre>
  <a href="http://xrl.us/kxa4">http://xrl.us/kxa4</a> </pre>
<p>H.Merijn implemented a trick in <code>Configure</code> to <strong>introduce a new
<code>-DEBUGGING</code> switch</strong> that would be an improvement over
<code>-DDEBUGGING</code>. Many people appeared to appreciate the concept.</p>
<pre>
  <a href="http://xrl.us/kxa5">http://xrl.us/kxa5</a> </pre>
<p>Slaven Rezic tweaked <code>perlfaq8</code> via bug report #38901 to improve
<strong>how to discover if I'm running interactively or not</strong>.</p>
<pre>
  <a href="http://xrl.us/kxa6">http://xrl.us/kxa6</a> </pre>
<p>Jerrad Pierce looked at <strong> <code>Module::Corelist</code> through the lens of perl 4.036</strong>
and came up with a number of additions for it, arguing that it would have
a certain educational value. Rafael remained somewhat unconvinced.</p>
<pre>
  <a href="http://xrl.us/kxa7">http://xrl.us/kxa7</a> </pre>
<p>Nicholas Clark revived and old thread started by Jos I. Boumans concerning
a <strong>Bug or Limitation of Filehandles in <code>pp_require</code> </strong>.</p>
<pre>
  <a href="http://xrl.us/kxa8">http://xrl.us/kxa8</a> </pre>
<p>This then segued into <strong>code references in <strong>@INC</strong> and source filters</strong>. Nick
Ing-Simmons mentioned a truly mind-boggling use that he had put it to.</p>
<pre>
  <a href="http://xrl.us/kxa9">http://xrl.us/kxa9</a> </pre>
<p>So Nicholas went ahead and changed what he said he'd change, but
then discovered <strong> <code>Filter::Simple</code> error messages getting mangled
inside <code>require</code> </strong> (#38920).</p>
<pre>
  <a href="http://xrl.us/kxba">http://xrl.us/kxba</a> </pre>
<p>Andy Lester cached a pointer dereference to a bitfield, in the hope
of improving the performance of <code>is_list_assignment</code> in <em>op.c</em>.
Nicholas knew from bitter experience that it is hard to outsmart
compilers these days, but applied the patch anyway.</p>
<pre>
  Take 1
  <a href="http://xrl.us/kxbb">http://xrl.us/kxbb</a> </pre>
<pre>
  Take 2
  <a href="http://xrl.us/kxbc">http://xrl.us/kxbc</a> </pre>
<p>Andy finished by <strong>removing an unused variable in a macro</strong>.</p>
<pre>
  <a href="http://xrl.us/kxbd">http://xrl.us/kxbd</a> </pre>
<p>
<h2> <a name="feedback_from_the_previous_summary">Feedback from the previous summary</a> </h2>
</p> <p>H.Merijn Brand carefully explained just what it takes to
pull a <code>Configure</code> script out the constituent pieces,</p>
<pre>
  <a href="http://xrl.us/kxbe">http://xrl.us/kxbe</a> </pre>
<p>bug #34349 is still open,</p>
<pre>
  <a href="http://xrl.us/kxbf">http://xrl.us/kxbf</a> </pre>
<p>I flipped a bit concerning the layer problem Jan Dubois found,</p>
<pre>
  <a href="http://xrl.us/kxbg">http://xrl.us/kxbg</a> </pre>
<p>and Jerry Hedden explained that thread stack size sizing is even
trickier than first thought.</p>
<pre>
  <a href="http://xrl.us/kxbh">http://xrl.us/kxbh</a> </pre>
<p>
<h2> <a name="about_this_summary">About this summary</a> </h2>
</p> <p>This summary was written by David Landgren. Last week I was in
England on holiday. As I was wandering around Salisbury cathedral,
I kept thinking "Hmm, I hope there won't be too much traffic on p5p
this week". HA!</p>
<p>If you want a bookmarklet approach to viewing bugs and change
reports, there are a couple of bookmarklets that you might find
useful on my page of Perl stuff:</p>
<pre>
  <a href="http://www.landgren.net/perl/">http://www.landgren.net/perl/</a> </pre>
<p>Weekly summaries are published on <em> <a href="http://use.perl.org/">http://use.perl.org/</a> </em> and posted
on a mailing list, (subscription: <em> <a href="mailto:perl5-summary-subscribe@perl.org">perl5-summary-subscribe@perl.org</a> </em>).
The archive is at <em> <a href="http://dev.perl.org/perl5/list-summaries/">http://dev.perl.org/perl5/list-summaries/</a> </em>.
Corrections and comments are welcome.</p>
<p>If you found this summary useful or enjoyable, please consider
contributing to the Perl Foundation to help support the development
of Perl.</p></p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org story by brian_d_foy: Perl5 Regex Engine Abstracted</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Perl5 Regex Engine Abstracted</h1>
<h2><a href="/user/brian_d_foy/">brian_d_foy</a> on 2006-12-04T15:44:00</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>
With patch <a href="http://public.activestate.com/cgi-bin/perlbrowse/29430">Change  #29430</a> the regex engine should now be sufficiently abstracted that it is reasonably feasable to write a plugin to use a different regex engine in perl. The documentation for most of the interface is contained in the perlreguts module although one needs to understand the flags in the regexp.h in order to make it work.
</p></p>
<p><p>
The basic idea is that the existing perl engine and data structures have been ripped in half. The structures which the perl core must interact are now well defined and the parts that are "private" to a given regex engine implementation are now isolated from the core.
</p>
<p>
A big issue with Perl 5.8 and earlier Perls regex engine pluggability interface was that it was intended mostly for swapping in a DEBUG build of the real engine, with the expectation that any engine in use could cope with the data structures generated by any other engine. Additionally some of the management routines for regexps were harded coded into the core, with the expectation that the core routine could handle any engines data.
All of these design issues meant that basically you couldnt plug an arbitrary engine into perl. You would have to apply core patches to do even the meanest implementation.
</p>
<p>
In the new scheme what Perl needs to know about a pattern, is defined by the <code>struct regexp</code>. What Perl needs to know about a regex engine is defined by the <code>struct regexp_engine</code>. All a plug in needs to do is create a <code>regexp_engine</code> that contains the appropriate callbacks and populate %^H appropriatly when the module is use()d. Perl will then use the compiler routine specified by the engine to create a <code>regexp</code> struct which it will then use as though it was its own. The <code>regexp</code> structure contains a pointer to the <code>regexp_engine</code> structure which created it, so the regexp is completely encapsulated. You can compile a regexp using one engine and pass it through to a routine expecting a normal regexp and everything would work out.
</p>
<p>
So now all we need to do is get some intrepid hacker to actually put all this to good use and write a plug in for another engine.
</p>
<p>
And you know what?
</p>
<p>
<b>
The first person that publishes a proper plug in for BleadPerl (soon to be Perl 5.10) will get a <em>METRE OF BEER</em> for doing so....
</b>
</p> <p>
Ill give a bonus prize (to be determined) if the engine ported is the latest TCL engine.
</p>
<p>
So lets see how long it takes... :-)
</p>
<p> <small>Note: I'm going to publish this challenge elsewhere over the next few days. Thanks to AdamK for the idea of the prize.</small> </p></p>


<hr/>



<h2>0th post^Wentry!</h2>
<h3><a href="/user/audreyt/">audreyt</a> on 2006-12-04T16:30:07</h3>
From #p5p:<p><blockquote> <div><tt>17:21 &lt;@audreyt&gt; I need to sleep.<br>17:21 &lt;@audreyt&gt; and here is my entry:<br>17:21 &lt;@audreyt&gt; http://perlcabal.org/user/audreyt/tmp/re-engine-y2k-0.01.tar.gz<br>17:21 &lt;@audreyt&gt; enjoy<nobr> <wbr></nobr>:)<br>17:21 &lt;@dmq&gt; i think you win.<nobr> <wbr></nobr>:-)</tt></div> </blockquote>



<blockquote>

<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/demerphq/">demerphq</a> on 2006-12-04T16:45:23</h3>
<p>
Ha! Hilarious. Ok, so you win. But I guess I should have been more specific about what I meant.
</p>
<p>
So to clarify, to qualify for a prize you have to implement a real functional NON-PERL (language or core) regexp engine as a plug in.</p>
<p>
Meaning, PCRE, the TCL 4 engine, PGE....
</p>
<p>
So the show ain't over folks! Theres still beer to be won.
</p>



<blockquote>

<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/steph/">steph</a> on 2006-12-04T20:19:12</h3>
<p> Hi, I wonder what are the other dimensions to that metre...are they
</p><p> * of capillary size? 
</p><p> * aproximately of a size corresponding to the cross-section of a monster bavarian mug?<nobr> <wbr></nobr>... 
</p><p> * not specified?<nobr> <wbr></nobr>... which will make us<nobr> <wbr></nobr>...well very drunk...(and AdamK poorer)
Actually in Madrid where I live more and more people use m when then mean m**2 especially when they talk about appartments)
</p>

<p> I remember seeing mentioned in Jeffreys F. book that the latest engine of Henry Spencer (possibly used in &gt;tcl8.4) was an hybrid DFA/NFA
and as such did not suffer much when fed pathological entries (of the kind that bring pure NFA engines to their knees). Last time I check it seemed the work had been left unfinished, so I'm not sure what do the tcl people actually use. Is there a special reason why you mention the tcl libraries, besides of looking for a proof of concept for your latest work.
</p>

<p> a few months ago I found a reference about SLK parsing and from there got to the "packrat" parsing entry in wikipedia...and became so interested that I actually started to dissect TheDamian's wonderful top-down parser generator to see what I could reuse<nobr> <wbr></nobr>...and then real life and $work did not leave me a minute to spare</p>

<p> do you know of that article?, actually I should check audreyt blog's more often as it was mentioned there...as "regex parsing in linear time, woow" or something like that. Is Patrick's PGE using that algorithm?...are they plans to port it to parrot or perl5? I'd like to know as the revival of madrid.pm is under way and maybe I could use that meter of beer trick of yours to lure people in doing some interesting work </p>


cheers and thanks for your work
--stephan



<blockquote>

<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/bart/">bart</a> on 2006-12-04T20:51:55</h3>
Funny that you assume AdamK is paying for <em>this</em> metre of beer, too. That was only last time.



<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/demerphq/">demerphq</a> on 2006-12-04T21:41:17</h3>
<blockquote><div>Is there a special reason why you mention the tcl libraries, besides of looking for a proof of concept for your latest work.</div></blockquote>
<p>
Because of the hoo-rahing that it got from Friedl.
And because to the best of my knoweldge there are only a few C regexp engines up to the job, and the Tcl engine represents the one I know of that is furthest from what Perl itself does.
</p>
<p>
With regards to the rest, either I dont know, or we will see later.<nobr> <wbr></nobr>:-)
</p>



<blockquote>

<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/belg4mit/">belg4mit</a> on 2006-12-04T21:50:46</h3>
Well <a href="http://search.cpan.org/user/jettero/POSIX-Regex-0.89/Regex.pm" title="cpan.org">Paul Miller</a cpan.org> might have a a different idea about that.





</blockquote>


<h2>Re:0th post^Wentry!</h2>
<h3><a href="/user/Alias/">Alias</a> on 2006-12-05T01:53:32</h3>
And this folks, is why you need to be VERY specific in challenges for prizes.<br><br>No I'm not paying for this one<nobr> <wbr></nobr>:)<br><br>But my standard was to purchase crates/cartons/slabs of "your favourite non-rediculously-expensive beer" (as in whatever you like, but don't screw me over)<nobr> <wbr></nobr>:) and pile those crates up until they were a metre in height.<br><br>Of course, in retrospect I should have said "at least" or "no more than"<nobr> <wbr></nobr>:) So for stennie's CamelPack prize we approximated by going low and throwing in a six-pack.<br><br>But trust me, it's a LOT of beer<nobr> <wbr></nobr>:)<br><br>Bordering on too much actually, but certainly enough to give away free beer when people come to your house, or something...





</blockquote>

</blockquote>

</blockquote>


<h2>I claim a winning entry. :-)</h2>
<h3><a href="/user/audreyt/">audreyt</a> on 2006-12-05T06:22:36</h3>
It's on CPAN now as re::engine::PCRE.
<p>
You can also download it from <a href="http://perlcabal.org/user/audreyt/tmp/re-engine-PCRE-0.01.tar.gz" title="perlcabal.org">http://perlcabal.org/user/audreyt/tmp/re-engine-PCRE-0.01.tar.gz</a perlcabal.org>.
</p><p>
Enjoy!</p>



<blockquote>

<h2>Re:I claim a winning entry. :-)</h2>
<h3><a href="/user/demerphq/">demerphq</a> on 2006-12-05T14:12:42</h3>
<p>
Well, it looks like that one did it.
</p>
<p>
Congratulations Audrey!
</p>
<p>
Now it needs more tests and some loving care to go from proof of concept to fully usable but I think we have proved the framework is not crippled from the get go.
</p>
<p>
Thanks a lot, it looks like this is a great leap forward.
</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


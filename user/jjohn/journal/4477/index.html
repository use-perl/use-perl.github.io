<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of jjohn: A Perl 6 Request: No Duff's Device</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>A Perl 6 Request: No Duff's Device</h1>
<h2><a href="/user/jjohn/">jjohn</a> on 2002-04-26T12:36:26</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><P><a href="http://www.lysator.liu.se/c/duffs-device.html">Duff's device</a> is a ingenious and nails-on-chalkboard irrating C "idiom" that was designed to move bytes serially into some hardware device (not memory, probably a video card(?)). It exists because a simpler while loop took too long. It is an example of loop unrolling, a technique somewhat unused in Perl
because it is only justifiably employed in high performance applications (eg. animation, games). What makes this code so abhorrant is that it looks like the result of a high-speed impacted between a switch statement and a while loop.
<p>Please, please, great Larry and Damian, do <em>not</em> let Perl 6 allow insanity like this. Perhaps this is the reason Perl has no switch statement? </p>


<hr/>



<h2>Blimey</h2>
<h3><a href="/user/Dom2/">Dom2</a> on 2002-04-26T13:14:02</h3>
I just checked tha apocalypse and it is actually allowed!!!  I was most surprised.  Although you do have to go slightly out of your way to use it, the usual:<br> <br>
&nbsp; &nbsp; given $foo {<br>
&nbsp; &nbsp; &nbsp; &nbsp; when "first" {<nobr> <wbr></nobr>... }<br>
&nbsp; &nbsp; }<br> <br>Syntax won't allow it (when appears to imply a terminal break), you have to do:<br> <br>
&nbsp; &nbsp; given $foo {<br>
&nbsp; &nbsp; &nbsp; &nbsp; if<nobr> <wbr></nobr>/^first$/ {<nobr> <wbr></nobr>... }<br>
&nbsp; &nbsp; }<br> <br>Now there is no implied break.  Damned weird...



<h2>Just goes to show ...</h2>
<h3><a href="/user/jhi/">jhi</a> on 2002-04-26T17:22:57</h3>
... what pumpkining does to one's brain: I find Duff's device to be completely fine C.<br> <br>



<blockquote>

<h2>Re:Just goes to show ...</h2>
<h3><a href="/user/jmm/">jmm</a> on 2002-04-29T14:51:21</h3>
On the other hand, it seems rather pointless to use it in Perl.  If you need a tight loop of just a few instructions, why are you running with an interpreted language?  If you don't need that tight loop, write the code clearly.



<blockquote>

<h2>Re:Just goes to show ...</h2>
<h3><a href="/user/jhi/">jhi</a> on 2002-04-30T16:52:23</h3>
But, but, Duff's device *is* clear C...<br>



<blockquote>

<h2>Re:Just goes to show ...</h2>
<h3><a href="/user/jmm/">jmm</a> on 2002-04-30T17:40:45</h3>
Um, well,<nobr> <wbr></nobr>...<br> <br>It works well, and I understand it fine, and I <i>like</i> it, but there is an inherent inclarity in having the targets of the switch nested an extra block level below the switch body, inside a different control construct.  Imagine putting an else block inside a structure nested within the then block - that's the closest you can come to doing the same thing anywhere else in the language without using goto's. <br> <br>Tom Duff (whom I used to play Dungeons and Dragons with before he moved from Toronto to California to go to Industrial Light and Magic) expressed his own reservations when he posted the original description.  He was surprised when it worked and uncertain whether that was good or bad.



<h2>Re:Just goes to show ...</h2>
<h3><a href="/user/jjohn/">jjohn</a> on 2002-05-03T12:13:32</h3>
for some values of 'clear', sure.<nobr> <wbr></nobr>;-)





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


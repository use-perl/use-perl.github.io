<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of jest: Refactoring the Wheel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Refactoring the Wheel</h1>
<h2><a href="/user/jest/">jest</a> on 2003-10-29T19:19:14</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>Perhaps a year ago, I wrote some programs to deal with running a library database. The application worked nicely, but the programs were terrible--huge chunks of repeated, unmaintainable code.</p>

<p>A number of months ago, I learned a lot more about OO Perl, and went through a big refactoring binge and stuffed lots of things in modules.</p>

<p>A smaller number of months ago, I learned even more about OO Perl, and fixed some of the infelicities of the code.</p>

<p>A few days ago, I greatly generalized the code, so I can use the same modules to handle other databases I work with. This refactoring pass went very smoothly, and I felt confident. In the process I realized that one big chunk of the code is still appallingly bad; I spent a huge amount of  effort on this elaborate solution to a problem that could have been solved much more easily if I had just used some templating system. (I had set up complicated modules to generate and process forms in a particular way.) So now I realize I have to go through and refactor this entire chunk to use TT or something, which will be non-trivial due to the complexity of the existing code.</p>

<p>When I'm finished with this, I will be in <i>exactly the same place as over a year ago</i>. I mean, I'll be a better programmer, and know a lot more, but this code has been in production use  the whole time and no one knows I've done anything at all.</p>

<p>I suppose this is a good thing. But I'd like to throw in something neat, that I couldn't have done a year ago, or something.</p>

<p>&lt;/meditation&gt;</p></p>


<hr/>



<h2>You're doing fine</h2>
<h3><a href="/user/jdavidb/">jdavidb</a> on 2003-10-29T20:38:38</h3>
<p> <i>When I'm finished with this, I will be in exactly the same place as over a year ago. I mean, I'll be a better programmer, and know a lot more, but this code has been in production use the whole time and no one knows I've done anything at all.</i> </p>

<p>You've actually accomplished something great, then.  The code will be much more maintainable.  I'd see lines of code <i>eliminated</i> as a good metric of how much you've simplified the system.</p>

<p>Throwing code out is liberating.  Gets rid of bugs, too.</p>

<p> <i>I suppose this is a good thing. But I'd like to throw in something neat, that I couldn't have done a year ago, or something.</i> </p>

<p>Bide your time.  Programs rarely sit still.  Eventually a feature request or bugfix will come in, and you'll get it done ten times faster than you would have on the old system.</p>

<p>Also, think how much better the next system you write will be, from this experience.</p>



<blockquote>

<h2>Re:You're doing fine</h2>
<h3><a href="/user/ziggy/">ziggy</a> on 2003-10-29T20:49:22</h3>
<blockquote><div> <i>
You've actually accomplished something great, then.  The code will be much more maintainable.  I'd see lines of code eliminated as a good metric of how much you've simplified the system.
</i> </div></blockquote>
There's a scene in <i>Revenge of the Nerds</i>, where someone from Microsoft (I think it was Steve Ballmer) talks about what it was like working with IBM on OS/2.
<p>
The IBM developers were stodgy old mainframe types, who were very regimented, hierarchical and by-the-book.  The developers Microsoft contributed to the project were young hackers who had a "shut up and show me the code" kind of attitude.
</p><p>
One of the bones of contention was about Microsoft doing "negative work".  They'd take some bloated, buggy code IBM had written, and rewrite it in fewer lines.  (KLOC was the only metric IBM had to use for their progress charts.)
</p><p>
Negative work, indeed.<nobr> <wbr></nobr>;-)</p>



<blockquote>

<h2>Re:You're doing fine</h2>
<h3><a href="/user/Timbo/">Timbo</a> on 2003-10-29T21:04:41</h3>
I think maybe you meant <a href="http://www.pbs.org/nerds/" title="pbs.org">Triumph of the Nerds</a pbs.org>, an excellent PBS show by Robert X. Cringely, not <a href="http://imdb.com/title/tt0088000/" title="imdb.com">Revenge of the Nerds</a imdb.com>, an '80s teen flick with little to recommend it.



<blockquote>

<h2>Re:You're doing fine</h2>
<h3><a href="/user/trachtenberga/">trachtenberga</a> on 2003-10-29T21:17:56</h3>
Except Ted McGinley!





</blockquote>

</blockquote>

</blockquote>


<h2>On Refactoring</h2>
<h3><a href="/user/ziggy/">ziggy</a> on 2003-10-29T20:44:00</h3>
Refactoring is a hard sell with a program that works and doesn't need to be updated.  As programmers, we deal with <i>writing</i> code (and debugging it, of course), so our focus is on projects that need work.  We tend to ignore projects that are "complete" and don't need additional labor.
<p>
Cringely <a href="http://www.pbs.org/cringely/pulpit/pulpit20030508.html" title="pbs.org">picked up on this</a pbs.org> a few months back.  When it comes to working bodies of code, going back and refactoring something stable <b>is</b> a waste of time.  But Cringley's ideas of an army of helpful Refactoring Gnomes is specious, and his anti-refactoring bent is decidedly Microsoftian.  Even Martin Fowler doesn't talk about going back and refactoring a finished product, nor does he advocate mythical Refactoring Gnomes to rewrite code that has been written and deployed.
</p><p>
Refactoring works best to clean up code under development.  The next best use for refactoring is learning how to be a better programmer -- studying a project, finding inefficiencies (or hidden complexities) and removing them.  The first kind of effort has direct benefits -- code becomes easier to develop over the development lifecycle, and bugs are easier to find and root out at the source (instead of festering in a bug queue).  The second kind of effort is a long term proposition, and difficult to justify in the short term, unless you can put a monetary value on programmer education and training.
</p><p>
Bob Martin (sorry, no URL handy) once talked about why refactoring is important, even if you don't feel like you're making progress.  Think of programming as a craft, where programmers are like chefs.  If you don't clean up the kitchen at the end of a meal, cooking quickly becomes a chore.  Before you start, you have to dig out the spatula and frying pan from the bottom of the dirty dish pile, clean them off (if you are lucky enough to have an empty sink), scrape off all of the crud from the stove, and so on.  At some point, you really begin to think about just buying a new kitchen with a full kit because you waste so much time rooting around the mess of your current kitchen just to fry an egg.  Here, refactoring just like cleaning up your workspace at the end of the day -- it's tedious, and it takes time, but it's important.  Fail to do so, and there's no way in hell you can make beef wellington without making a major production out of it.
</p><p>
Finally, there's the issue of when code is "finished".  Although you may not have made any user-visible progress in the last year, chances are pretty good that you've done some other beneficial work, like optimizing a query, or something.  If you had implemented all of the required features a year ago with crufty code, <b> <i>and you will never need to add another feature ever again</i> </b>, then refactoring was probably a bad move for the bottom line.  If, on the other hand, you will be writing other programs in the future, or you have some other work that needs to be done on your library search, then there is a net long-term benefit to what you did over the last year.</p>



<h2>You are to be congratulated</h2>
<h3><a href="/user/jordan/">jordan</a> on 2003-10-29T22:56:08</h3>
If you did all that internals work and nobody noticed.<br> <p>Usually, when I do major rewrites, bugs and problems inevitably turn up.  It shows that you worked deliberately and carefully and tested well.<br> </p><p>Congratulations!<br> </p><p>And remember, it's the journey (becoming a better programmer) and not the destination (source code) that is all the fun.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of BooK: Mail::Box++</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Mail::Box++</h1>
<h2><a href="/user/BooK/">BooK</a> on 2009-10-14T07:00:40</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>
So <a href="http://twitter.com/dlandgren/status/4707632109">sferics' disk died</a>
and took everything that wasn't backed up with it. It turns out that one
of the important configuration items that weren't backed up were the
configurations and subcribers lists of the Mailman mailing-lists.
</p><p>
To get the subscribers lists back, we didn't have many options:
</p>
<ul>
<li>Resubscribe all posters, which would also subscribe the ones who did
unsubscribe at some point, and kick out all the lurkers... <i>Not so good.</i></li>
<li>Process all the administrative messages to get a chronological list
of subscribe/unsubscribe action, and rebuild the list from there.</li>
<li>Seed the list with the list of posters, if possible the subscribed ones
(i.e. not the one whose mails were passed through moderation)</li>
</ul>
</p><p>
We use Mailman for managing our mailing-lists. It works well enough
for us, but it has its share of hate:
</p>
<ul>
<li>Localized admin messages are nice, but a <tt>X-Mailman-Action</tt>
header would be nicer, so we would have to process the body of each
actions, in all languages we might have used</li>
</ul>
<p>
Luckily, it also has a few helpful headers:
</p>
<ul>
<li><tt>List-Id</tt>, so we can process a folder full of admin messages
and know about which list each message is about</li>
<li><tt>X-Mailman-Approved-At</tt>, so we can detect messages sent by
non-subscribed posters</li>
</ul>
<p>
I used <a href="http://search.cpan.org/dist/Mail-Box/">Mail::Box</a>
to create two scripts to process the messages (in French and English,
so anyone who subscribed in German is out of luck) and provide some
useful info (the people with the archives and the admin-fu did the actual
work of fixing the lists).
</p><p>
Sure, <tt>Mail::Box</tt> is slow, and the interface is a bit complicated,
but on the other hand it is well documented, and it's correct.
</p><p>
Summary at the end of the day^Wlong week-end:
</p>
<ul>
<li>(incomplete backups)--</li>
<li>Mailman-- # misses useful headers that would have made the job easier</li>
<li><tt>Mail::Box</tt>++ # gets the job done in 20 lines</li>
</ul>
</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


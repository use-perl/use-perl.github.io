<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of chromatic: Porting Test::Class to PIR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Porting Test::Class to PIR</h1>
<h2><a href="/user/chromatic/">chromatic</a> on 2008-04-08T05:39:30</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>Adrian Howard's <a href="http://search.cpan.org/perldoc?Test::Class">Test::Class</a> is one of my favorite Perl modules.  It makes organizing large test suites and improving test coverage much easier.</p>

<p>Parrot has a lot of tests, but probably half or a third of what it needs.  Parrot testing is an interesting hodge-podge; we have tests written in a variety of languages.  I ported Test::Builder from Perl 6 to PIR a couple of years ago, and we've used it to test Parrot and some of the languages hosted on Parrot very successfully.  (I first realized that Parrot's interoperability worked when I successfully called some of the multimethods defined in Test::More in PIR from Pheme, a Scheme-a-like language with no knowledge of multimethods.)</p>

<p>This weekend I ported Test::Class to PIR.  It took a couple of hours.  Actually, it took less than an hour to port the basics of Test::Class to PIR, and slightly over an hour to debug my proof of concept into code of sufficient quality to check in.</p>

<p>Perhaps my favorite part of Test::Class in Perl 5 is the use of subroutine attributes to specify the number of tests you'll run.  Unfortunately for the port, PIR doesn't have subroutine attributes, so I wrote methods to add setup, startup, shutdown, teardown, and test methods to the test object.  I'm not completely happy with the syntax, but it works.</p>

<p>Along the way, I fixed a bug I never knew existed in the PIR Test::Builder, which is nice -- I prefer to find and fix bugs before other people run across them (which is probably why people have assigned me the really tricky bugs in Parrot in recent months).</p>

<p>I did catch myself saying "You know, a declarative language for specifying tests in arbitrary source languages would be very useful".  Mark my words.  In the next five years, everyone reading this will be able to write their own little declarative languages which interoperate fully with other full-fledged languages.</p></p>


<hr/>



<h2>Huzzah!</h2>
<h3><a href="/user/Adrian/">Adrian</a> on 2008-04-08T06:52:19</h3>
xUnit goodness spreading throughout the world!



<h2>N tests</h2>
<h3><a href="/user/djberg96/">djberg96</a> on 2008-04-08T14:49:10</h3>
<p><blockquote><div>Perhaps my favorite part of Test::Class in Perl 5 is the use of subroutine attributes to specify the number of tests you'll run.</div>
</blockquote>
Why not always run them all? When are you going to specify X number of tests in a subroutine, but run less than the total?



<blockquote>

<h2>Re:N tests</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2008-04-08T17:25:02</h3>
<p>I mean that you specify the number of tests in the method.  It's an additional piece of metadata -- "This method runs five tests" -- rather than a directive -- "Only run five tests in this method, and then stop executing this method."</p>



<h2>Re:N tests</h2>
<h3><a href="/user/Aristotle/">Aristotle</a> on 2008-04-09T02:19:23</h3>
<p>Or more precisely, &#8220;this method is expected to run 5 tests.&#8221; So if it runs fewer or more, you know something is wrong.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


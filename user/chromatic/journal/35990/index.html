<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of chromatic: Perl 6 Design Minutes for 26 March 2008</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Perl 6 Design Minutes for 26 March 2008</h1>
<h2><a href="/user/chromatic/">chromatic</a> on 2008-03-27T21:07:03</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>The Perl 6 design team met by phone on 26 March 2008.  Larry, Allison, Patrick, Will, Jerry, Jesse, Nicholas, and chromatic attended.</p>

<p><strong>Patrick:</strong></p>

<ul>
<li>Perl 6 is going pretty well</li>
<li>mainly catching up on mail</li>
<li>finding out where people are and what they're doing</li>
<li>I had a lot of mail</li>
<li>pleased on the progress on Rakudo</li>
<li>people are adding more features and looking at it</li>
<li>still need to look at the new PCT tutorial</li>
<li>my plan is to continue reviewing the new changes to Rakudo</li>
<li>going to get back on track writing about what's going on</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>no spec work this week</li>
<li>lots of conversations on p6l about various parsing issues</li>
<li>relationships of unaries with indexes</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>is it safe for me to ignore that thread?</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>for now</li>
<li>whatever we come up with for the operator precedence parser in STD will be the standard way of doing it</li>
<li>mostly fighting bugs in YAML and losing</li>
<li>giving up on YAML for lexer storage</li>
<li>it does not like to deal with Unicode</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>is this a particular implementation of YAML?</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>all of them</li>
<li>I'm using my own formatted file at the moment</li>
<li>fighting bugs in tagged regular expressions</li>
<li>it loves to coredump for no apparent reason, if you have too many alternatives</li>
<li>in addition to the difficulties with null patterns and null character sets</li>
<li>it always coredumps with those</li>
<li>if I have 28 or so statement control alternatives, it'll run if I delete all but two or three of them</li>
<li>apparently a forward or back pointer stored in a byte or something else badly</li>
<li>may have to dive into the C code to fix that</li>
<li>also finding a few Perl 5 bugs</li>
<li>I really, really exercise lexical scoping within subroutines in my output</li>
<li>nest maps very deeply and expects to keep straight lexical variables within those blocks</li>
<li>something is leaking somewhere</li>
<li>mostly working around those problems</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>Summer of Code stuff now</li>
<li>a few applications are coming in</li>
<li>two look good for Parrot and Rakduo</li>
<li>need to advertise for more</li>
<li>also had a contact from someone who wants to port OpenGL to Parrot</li>
<li>not Geoff Broadwell</li>
<li>seems like a very serious approach</li>
<li>pushing him to apply for funding from TPF</li>
<li>also trying to keep on top of mail and catch up</li>
<li>haven't had any coding time</li>
<li>doing a lot more managing and answering questions</li>
<li>to some extent, that's fine</li>
<li>there are more people involved in the project</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>my brain is full of the strings PDD at the moment</li>
<li>some substantial changes from Simon's original draft</li>
<li>he had a good perspective</li>
<li>I'm looking at overall architecture changes</li>
<li>still supporting what we need to support</li>
<li>just in a different way</li>
</ul>

<p><strong>c:</strong></p>

<ul>
<li>started some Perl 6-related arguments online; it's been a while</li>
<li>made a first patch that gives PIR profiling</li>
<li>it's not a great approach</li>
<li>it gives some visibility though, and I've found a few places for optimization</li>
<li>found a ten-percent speedup in PGE in some cases</li>
<li>Tcl spends most of its time parsing and re-parsing</li>
<li>also going to go through the bug tracker again and see if we can clear out more stuff</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>are you still thinking about applying Warnocked Perl 6/Rakudo patches?</li>
</ul>

<p><strong>c:</strong></p>

<ul>
<li>unless Jerry or Patrick yell</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>if you reply to them, I'll take a look at them</li>
<li>I had architectural concerns about some of them</li>
<li>don't want people cargo-cult things if we check them in</li>
<li>but I'll respond to them if you find them and bring them up</li>
<li>not all are in RT, some were just on the list</li>
</ul>

<p><strong>Richard:</strong></p>

<ul>
<li>spent a couple of days at EclipseCon</li>
<li>trying to get Perl 5 as a supported language within Eclipse</li>
<li>working on a spec, and then we'll shop that around</li>
<li>next week is a day trip to New York on a potential sponsorship call</li>
<li>could be significant</li>
</ul>

<p><strong>Will:</strong></p>

<ul>
<li>ripping out deprecated items</li>
<li>hope to get everything we've deprecated out before the next release</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>I'm in favor of that</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>mostly having conversations about making progress this week</li>
<li>lots of people are burned out</li>
<li>we're not hitting milestones that make people feel like they've been productive</li>
<li>I don't know that we have a good set of milestones in Perl 6</li>
<li>nor that we could lay out a series of good, dated milestones for Rakudo</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>I agree</li>
<li>but you just keep working away and more things become available to more people</li>
<li>one blocker is IO</li>
<li>keeps coming up</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>also exceptions</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>Larry made a comment somewhere that the design is waiting on the implementations to figure out what they need</li>
<li>we can go where we need to go</li>
<li>but we can change later</li>
<li>there's no point in waiting for now</li>
<li>there's a draft design for IO</li>
<li>having an implementation would help people do file IO in Rakudo</li>
<li>I hear Perl is good about that</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>what do you need from Parrot?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>how's the IO PDD?</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>it's written but not implemented</li>
<li>the implementation date is June, I think</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>how about the basic stuff?</li>
<li>open a file and stuff</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>that mostly stays the same</li>
<li>you can start using that interface now</li>
<li>I'll rip out the guts later when we start implementing the new system</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>are you comfortable doing an implementation against what's there today?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>that's one of those areas I'd like to delegate</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>I worked on the IO design</li>
<li>I'm comfortable with Parrot's IO</li>
<li>I'll read up on Perl 6's IO</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>it'll make Rakudo more visible where people can use it and make something work</li>
<li>reading from and writing to files will help</li>
</ul>

<p><strong>c:</strong></p>

<ul>
<li>Haskell went a long time without that and it's pretty popular</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>it comes up on the channel regularly</li>
<li>we can write our own filters and stuff for test suites in Rakudo instead of Perl 5</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>eating our own dog food</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>do you have a feeling for the strings PDD delivery and implementation?</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>due for implementation June 1</li>
<li>probably ready for rolling in for mid-June</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>Rakudo is holding off on reading Perl 6 source as Unicode waiting for that</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>you can probably use some of Simon's optimization techniques in the PDD</li>
<li>he defines a new string type</li>
<li>you can use that before the full integration into Parrot</li>
<li>gives you always a fixed width lookup</li>
<li>as far as I can tell, that's what's expensive</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>if I switched and translated everything over to UCS-2?</li>
<li>I don't want to implement any C code personally</li>
<li>what will exist in Parrot and when?</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>let's lay on Simon to get something working soon</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>I can't guarantee that we'll have something before June 1</li>
<li>but we can start implementing the new string type right away</li>
<li>if we can get Simon to do a first draft, that'll help</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>I just don't want to switch to a variable-width encoding, which'll make parsing really slow</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>if you transcode when something first comes in, you'll take a first hit but not subsequent hits</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>the problem with transcoding to UCS-2 right now is that it requires ICU, and we don't have ICU on all platforms right now</li>
<li>I could potentially add those operations...</li>
<li>I did that for UTF-8</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>you might be able to use the Perl 5 program that spits out Unicode tables into Perl 5 friendly tables</li>
<li>they turn into bitmaps in a way that you probably don't care about</li>
<li>could use that to write something based on UCS-4 or UCS-2ish integers</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>the UTF-8 code is directly based on those codepoints</li>
<li>we work only with codepoints at that level</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>how much effort do you want to spend, knowing that the new string implementation is coming?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>the lack of Unicode support in Rakudo prevents the French angles</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>how much of the Pugs test suite uses those?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>they don't show up much</li>
<li>it's not a killer feature</li>
</ul>

<p><strong>Jesse:</strong></p>

<ul>
<li>seems like you could go a long way without it being a problem</li>
</ul>

<p><strong>Nicholas:</strong></p>

<ul>
<li>which codepoints do you need?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>in a case-insensitive search, we fold everything to a single case</li>
<li>without ICU, when you hit a codepoint outside of Latin-1, Parrot throws an exception</li>
<li>we check for downcasing first, which is slow</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>or we could trap the exception</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>but a downcase on the French quotes is a no-op</li>
<li>I could catch it</li>
<li>but it's a bit of painful overhead to add</li>
</ul>

<p><strong>Nicholas:</strong></p>

<ul>
<li>with a UTF-16 implementation which matched downcase for Latin-1, would that work?</li>
<li>or do people expect to use accented characters and have them work?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>short answer: yes</li>
<li>right now, Parrot downcases ASCII, checks for ICU and downcases, and throws an exception for everything else</li>
<li>one patch I have is smarter about the non-ASCII codepoint on the ICU part</li>
<li>if it's Latin-1, then we can figure out how to do it</li>
<li>that's pretty easy to downcase</li>
<li>not that many additional codepoints</li>
<li>if it's outside of that, we can throw the exception</li>
<li>that range includes the French quotes</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>let's see if we can get Simon to do an initial implementation</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>one of the milestones was documentation for PCT</li>
<li>is the PCT tutorial close to that?</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>it needs to be in PDD form</li>
<li>Will's talking to him about that</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>I'm happy to work with him on that</li>
</ul>

<p><strong>Nicholas:</strong></p>

<ul>
<li>have you been struggling alone with those bugs, Larry?</li>
<li>have you had help from others?</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>when you have a bug in TRE from a DFA that's too large and you try to cut it down, and it goes away when you cut it down, I worry that I'll have to solve it on my own</li>
</ul>

<p><strong>Nicholas:</strong></p>

<ul>
<li>AEvar wrapped it for Perl 5</li>
<li>he may be familiar with it</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>it's down in the guts</li>
<li>in the long run, we may abandon TRE and write our own DFA</li>
<li>just a question if I can work around it right now</li>
<li>TRE might need modification anyway</li>
<li>it gives me the longest token, but it won't give me the second longest token if the first one fails</li>
<li>not sure how to backtrack into that</li>
<li>a parallel NFA might be more reasonable in that case</li>
</ul>

<p><strong>Nicholas:</strong></p>

<ul>
<li>don't you need all the decreasing order of longest?</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>you make a list of all candidate token resolutions</li>
<li>find the longest unique</li>
<li>call that and hope it succeeds</li>
<li>if not, and if you're not ratcheting, you need to try something shorter</li>
<li>all the way down to nothing</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>once you know the longest one, it's a lot easier to find the shortest one</li>
<li>then you know the lookahead</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>that assumes you have a hash to look up the shorter keys in</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>there's some value in knowing the longest one</li>
<li>it'd be better to have an automoton in this case</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>I'd like to have this applicable beyond parsing and lexing</li>
<li>any regular expression-like thing can automatically do DFA-style matching to the extent that it's reasonable</li>
<li>and gracefully fall over to the other one</li>
<li>there are various ways of hacking around it that would work for a lexer</li>
<li>that's not the direction I want to go</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>you're after bigger game</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>Perl originally integrated regex matching into the language</li>
<li>we've ignored DFA-style matching for so long, we're late in integrating it</li>
<li>but I think we can do it better than anyone else so far</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>is that a new motto for Perl 6?</li>
</ul>

<p><strong>Larry:</strong></p>

<ul>
<li>uh oh, another new motto!</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>one thing in Rakudo stops us from writing Perl 6 methods and classes in Perl 6</li>
<li>it's a bug or limitation in PCT, I think</li>
<li>when you compile Perl 6 code to PIR to create bytecode you can call as a library, it creates subs with the same name as other subs</li>
<li>the generator for the sub names starts with the same number in every file</li>
<li>you'll get <code>_BLOCK_10</code> twice</li>
<li>will HLL and namespaces help that?</li>
<li>does something else in PCT need modification for that?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>namespaces would do a lot for it</li>
<li>I don't have a good answer for that</li>
<li>the name generator needs a better universally-unique identifier for its names</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>a UUID generator would go a very long way to solving this problem with Parrot in its current state</li>
<li>anything we can steal?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>it'd be nice to have a good UUID generator in Parrot itself</li>
</ul>

<p><strong>Will:</strong></p>

<ul>
<li>are they generated separately and then included in the same file?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>when I say "universally unique" I mean "I<universally> unique"</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>needs external tracking or something</li>
</ul>

<p><strong>Will:</strong></p>

<ul>
<li>sounds like we're solving the wrong problem there</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>if there's a way to make identifiers for subs <code>static</code> like in C -- file-scoped but don't leak out, we could use that</li>
<li>I don't know if the <code>:anon</code> flag does that</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>that just makes sure that they don't get stored in the namespace</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>we're typically talking about nested closures</li>
<li>all in the same compilation unit</li>
<li>as long as the PIR compiler can make all of those linkages such that there's no runtime symbol lookup, there's no problem</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>can we include the name of the sub the closure is in in the generated name?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>that may be a short-term solution</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>if you put in the namespace and the name as part of the generated name, does that help?</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>does the <code>:anon</code> flag gives us what we want?</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>it may not be enough</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>we can test that easily enough</li>
<li>I'd like to see this problem solved before conference season</li>
<li>I want developers to be able to jump in and implement things in Perl 6 by then</li>
</ul>

<p><strong>Allison:</strong></p>

<ul>
<li>seems like a more urgent problem than French quotes</li>
<li>if it doesn't work, it's a bug in the current implementation of anonymous subs</li>
</ul>

<p><strong>Patrick:</strong></p>

<ul>
<li>is there a ticket for this?</li>
</ul>

<p><strong>Jerry:</strong></p>

<ul>
<li>if there isn't, I'll add one</li>
</ul></p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


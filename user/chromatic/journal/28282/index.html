<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of chromatic: It Wasn't the C Code Breaking...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>It Wasn't the C Code Breaking...</h1>
<h2><a href="/user/chromatic/">chromatic</a> on 2006-01-08T09:16:18</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>I'm writing <em>Perl Hacks</em> (&lt;TorgoX&gt;All must buy!&lt;/TorgoX&gt;) and in the process I'm coming across some really dusty corners of Perl.</p>

<p>One of my long-planned hacks was on tracing your code down at the opcode dispatch level -- who needs a debugger when you have something this cool -- using pure Perl.  Of course, if I want to make this work correctly, <em>I</em> can't write pure Perl.  That's fine.  I'm a polyglot.  I can handle a little C and XS.</p>

<p>When I hit the part tonight where my Perl callback was somehow, in some circumstances, getting a null op instead of the <code>B::*</code> object I expected, I started to debug my XS code, trying all sorts of permutations of creating the object, throwing in the magic XS incantations to manage the stack and reference count, and so on.  I even went as far as to use the <code>Devel::Peek</code> equivalent in C.</p>

<p>I had no luck until I looked at the Perl code again and realized I was accidentally calling my callback from Perl without passing any values.  ~bonk~</p>

<p>I can only defend myself by explaining that not only is figuring out exactly when this code takes over from the normal Perl runloop a bit tricky (as if the description alone weren't enough to scare almost everyone else away), but dodging segfaults always makes me woozy, and oh yeah is this difficult to test in process.</p>

<p>Look for <code>Devel::TraceOps</code> on the CPAN in the next couple of weeks, followed perhaps by <code>ExtUtils::NCI</code>.</p></p>


<hr/>



<h2>An interesting utility</h2>
<h3><a href="/user/n1vux/">n1vux</a> on 2006-01-09T18:18:46</h3>
I look forward to trying this out, it sounds like a very interesting hack and potentially useful tool.



<h2>Level With Us</h2>
<h3><a href="/user/rooneg/">rooneg</a> on 2006-01-09T20:23:32</h3>
This new book is just an excuse for you to explore strange and uncharted parts of Perl, isn't it?<nobr> <wbr></nobr>;-)



<blockquote>

<h2>Re:Level With Us</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2006-01-09T21:30:37</h3>
<p>It's sure not to make loads of money or to become famous.  Of course, I was already writing some of these hacks before the book even came up....</p>



<blockquote>

<h2>Re:Level With Us</h2>
<h3><a href="/user/rooneg/">rooneg</a> on 2006-01-09T22:43:35</h3>
You mean writing technical books doesn't make you rich and famous?!?!  Damn it!  Why didn't anyone tell me this before I wrote mine!<nobr> <wbr></nobr>;-)





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


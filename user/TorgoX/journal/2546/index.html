<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of TorgoX: goto LabelHELL;</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>goto LabelHELL;</h1>
<h2><a href="/user/TorgoX/">TorgoX</a> on 2002-01-31T07:00:23</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>Dear Log,
<p>Now is the time for the telling of the horror story:

<p>I always say that the worst code I ever "wrote", I didn't actually write -- I translated it.  It was straight translation from BASIC code.  Oh, but not just <em>any</em> BASIC code -- it was about a thousand lines of totally uncommented code that did some inscrutible scientific calculations that I needed to implement in Perl.  Of course, the one person who wrote and understood that BASIC code, had long since gone mad, and no-one was available to explain any part of it to me.

<p>It was in a BASIC dialect that ran only on Sharp programmable calculators!  There were just 26 variables in the language, called "A" to "Z", all global of course.  There was no gosub.  There was no for/next.  In fact, the only flow control structures in the language were an unconditional "goto <i>line_number</i>" and a conditional "goto <i>line_number</i> if <i>condition</i>".  And that last "goto X if Y" was the only conditional structure in the language!  So the code was NOT PRETTY.

<p>After about a solid week of staring at this code, and plotting out what jumped to where, I figured out that the first half of the endless code was just for initialization and user-interaction, and had only one point of interaction with the real code that I needed to translate, which was the second half, which did all the figuring.  So then I agonized over what to do with the second half.  I eventually decided to just translate it line by line into Perl.  It ended up being about 300 lines of code that looked like this:

<blockquote>...
<br>Label225:
<br>goto Label230 if $q == 1;
<br>goto Label235 if abs($a - $j)&lt;90;
<br>goto Label227 if abs($a - $j) == 90;
<br>$q = 1;
<br>goto Label205;
<br>
<br>Label227:
<br>$b = 1;
<br>$a += 180 if $a == 0;
<br>$k = $s + $h+$i;
<br>$l = $c - $i;
<br>goto Label500 if $l == 0;
<br>$m = $a;
<br>goto Label350 if $l&gt;0;
<br>goto Label450;
<br>...</blockquote>

...for pages and pages, with only the occasional lapse into deeply nested trig functions to break the monotony.

<p>What does each variable A-Z mean (and they mere mostly all used!)?  I have no idea.  I only ever figured out that K, L, and M held the input parameters at the start, and at the end of this monolith of code, they magically held the output of the algorithm.

<p>But it ran perfectly!  All the test data whipped right thru, correct on every point.  Because, you see, I am a superstar.

<p>And <em>then</em> they wanted it translated into
<a href="http://www.amazon.com/exec/obidos/ASIN/0471986151">Lingo</a>.  I said "Have fun!"
<p>So they got a "Lingo expert" to work on it.  I gave him the Perl source for my implementation.
<br>He said "I... don't really understand this".
<br>I said "Neither do I!".
<br>"But you wrote it!"
<br>"No, I <em>translated</em> it.  I could show you the 'original Klingon', but it wouldn't help.  This Perl code is as clear as it gets."
<br>"Hm."
<br>"Well, not to get all <a href="http://www.amazon.com/exec/obidos/ASIN/0785811257">zen</a> and wu-tang and stuff, but there's <em>understanding</em>, and there's understanding.  So this line, 'goto Label230 if $q == 1;', I understand what that does -- it sees if $q is 1, and if so, jumps to Label230."
<br>"Why does it do that? What's $q's value mean?"
<br>"I have no idea," I say.
<br>He weeps quietly.
<br>I say, "BUT...!"
<br>"Yes? [sniff]"
<br>"Can you translate 'goto Label230 if $q == 1;' into Lingo?"
<br>"I... I don't know if there's a 'goto' in Lingo.  I think there is."
<br>"Well if there isn't, we'll think of something.   But suppose there is.  Could you translate 'goto Label230 if $q == 1;' then?"
<br>"Sure", he said.
<br>"And the next line is 'goto Label235 if abs($a - $j)&lt;90;' -- could you translate that?"
<br>"I... I guess."
<br>"Well, start at the beginning, and proceed to the end, and it'll <em>work!</em>"
<br>"It will?"
<br>"Yes!  If you translate <em>each</em> line right, and you do all of them, you'll have all the program translated!  I did it from this creepy BASIC to Perl  that way, and it worked for me" I said.
<br>"Wow!"
<br>"And here's a sheaf of test numbers you can run thru."

<p>So the "Lingo expert" went and translated each line. And it didn't work.  It never worked.  He tried adding fudge factors here and there in the code to make <em>some</em> of the test numbers work.  That didn't help, of course.  And he was on the clock the whole time, every time they'd call him back to "correct" the code for the next emergency last-minute burn to the CDROMs it was supposed to go on. So he made a mint, for code that has never worked, <em>and</em> makes no more sense than mine.  Apparently it just doesn't pay to get it right the first time.  But don't get me started on that.
<p>And <em>my</em> program worked, and still works -- no bugs found, ever.  Even though I have no idea how it works, and no idea what any of it means.</p>


<hr/>



<h2>The nightmares have returned</h2>
<h3><a href="/user/Whammo/">Whammo</a> on 2002-01-31T08:51:46</h3>
<p>On a very short-lived project that I was assigned to, my primary responsibility was to port a particular astrodynamics engine to Java from C.  The program had previously been ported to C from Fortran, and to Fortran from some ungodly, unknown language for an
old HP paper-tape computer.  I was the first actual programmer to look at said
program, and all the previous ports were exactly like you described: literal translations
from one language to the next.</p>

<p>Function parameters were <tt>a</tt> through <tt>z</tt>.  All local variables
were declared like <tt>float r[412];</tt>, and used like <tt>r[53] = r[212] * r[81];</tt>.
Not every index would be used, no index would be reused, and the indices
were seemingly randomly chosen.  All constants were handled as
just numbers, many of which I was unable to track down.  There was but one comment
in the entire program - a four line assertion that some basic C construct
did actually work.  (Not that the logic worked, that the C itself was valid.)</p>

<p>They quickly decided that <a href="http://www.stk.com/" title="stk.com">STK</a stk.com>'s
engine would be money well-spent.  (Perl, BTW, is their scripting language
of choice.)</p>



<blockquote>

<h2>Re:The nightmares have returned</h2>
<h3><a href="/user/godoy/">godoy</a> on 2002-01-31T09:15:13</h3>
Indeed... It's funny how we all have passed through that.And that's funny how non-programmers choose their variables' names. This algorithm was gotten from an electrical circuits book and it's Portuguese title translates to "Electrical Circuits Course". Got it? No? They are teaching future engineers to write their programs in Basic and name their variables after A1, A2, A3,<nobr> <wbr></nobr>..., Z7, Z8, Z9.
<br>
<br>It has just made me curious about what happens after Z9... Maybe AA1?<nobr> <wbr></nobr>;-)
<br> <br>The entry in my diary is like yours: variables with one letter and one number, loops using 'for', several GOTO and as the last line, a 'return'.
<br>
<br>I'm <em>translating</em> the FFT algorithm to Perl and then I'll try doing the same for C...<nobr> <wbr></nobr>;o) I was originally going to <em>translate</em> it to C, but since I like Perl more, I've done that first.





</blockquote>


<h2>That</h2>
<h3><a href="/user/pudge/">pudge</a> on 2002-01-31T15:44:23</h3>
is a fantastic story!



<h2>wow</h2>
<h3><a href="/user/yDNA Barak/">yDNA Barak</a> on 2005-04-20T01:46:58</h3>
That was a fun read. Um, thanks. Now I don't feel so bad about everyday hell.



<h2>I had something less horrorific</h2>
<h3><a href="/user/wickline/">wickline</a> on 2005-06-05T20:51:24</h3>
happen several years ago. I wanted to create <a href="http://colorlab.wickline.org/" title="wickline.org">http://colorlab.wickline.org/</a wickline.org> and found a site that showed colorblind versions of the websafe colors and referenced HCIRN as the source. I asked them for their code, which they were kind enough to provide.<br> <br>The code was provided in two forms: Java that didn't work, and a spreadsheet that did work. Neither form was clear to read. Since the spreadsheet worked, I started off with a literal translation of that document. Instead of your Label200 things, I had oodles of variables like $E3 and $F45 referencing the contents of spreadsheet cells. The translation worked.<br> <br>Of course it looked decidedly nasty. I trimmed dead paths in the code, removed variables that were calculated but never used, and cut out some repeated calculations that were always run on the same inputs. It was still a mess of course.<br> <br>I spent some time educating myself about color spaces and tracked down the credited source of the algorithm the spreadsheet was intended to embody. Eventually I was able to start putting variable names from the broken Java onto the translated spreadsheet code, reworking the spreadsheet code into something that fit the rough form of the Java code.<br> <br>I never did bother to figure out what the bug was in the Java code was because once the translation got sufficiently far enough away from the spreadsheet version and looked a bit more like perl code, I kept morphing the code in a more perl-like direction to make it easier for me to read.<br> <br>Then I translated the whole mess to javascript.<br> <br>The result is in <a href="http://colorlab.wickline.org/colorblind/colorlab/engine.js" title="wickline.org">http://colorlab.wickline.org/colorblind/colorlab/engine.js</a wickline.org> at the function color_blind_sims() and in the lookup tables above there. If you scroll up to Color_rgb_from_xyz() you can find a reference to a slight difference in the constants supplied in the spreadsheet versus the java code.<br> <br>I was lucky enough to have had two code sources (although only one worked), a reference to the algorithm which was being used, and reference material discussing the problem domain. If I hadn't have had all of that, I suspect that the code would still exist as a nice black box full of $E3 and $F45 variable names<nobr> <wbr></nobr>:)<br> <br>-matt





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


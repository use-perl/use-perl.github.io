<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of jesse: Parrot Sketch 26 Oct 2005 (since the logbot is down)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Parrot Sketch 26 Oct 2005 (since the logbot is down)</h1>
<h2><a href="/user/jesse/">jesse</a> on 2005-10-31T18:25:51</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>13:52 -!- leo [~lt@feather.perl6.nl] has joined #parrotsketch
14:01 <Nicholas> The hour is upon us
14:01 <chip> meatspace meating will take me away for first 5min or so, sry
14:01 -!- pmichaud [~chatzilla@c-24-1-26-255.hsd1.tx.comcast.net] has joined #parrotsketch
14:03 -!- chromatic [~chromatic@nat-147-140.oreilly.com] has joined #parrotsketch
14:03 <chromatic> Apologies for the delay.
14:03 <chromatic> Shall we start?
14:03 -!- mdiep [~matt@bursley-221-209.reshall.umich.edu] has joined #parrotsketch
14:03 <pmichaud> okay with me :-)
14:04 <chromatic> Autrijus, what have you been doing this week?
14:05 <chip> (present)
14:05 <chromatic> Okay, chip you go then!
14:06 <chip> OK then
14:07 <chip> I've unconscionably delayed the lexical spec, but the good news is that having learned a lot about what's 
             known about lexicals (and, separately, about Tcl variables *rimshot*), I've planned the points of inflection 
             required to support p6 and tcl both
14:08 <chip> So it'll be better when it finally emerges
14:09 <chromatic> What's blocking you this week?
14:09 <chip> And I've looked over matt's namspace spec and found it a good direction, albeit with some false notes
14:09 <chip> (but I'll let him talk further if he likes)
14:09 <chip> EOT
14:10 <chromatic> What's blocking you this week?
14:10 <chip> blocking this week? .... nothing external :/
14:10 <chip> time is all.  Oh, and
14:11 <chip> ... meatspace friends regaining patience with seeing me having a laptop on my lap :-
14:11 <chip> :-)
14:11 <chip> EOT2
14:11 <chromatic> Thanks, chip.  Leo?
14:11 <leo> - continued variable-sized register frame patches
14:12 <leo> - almost done, OTOH amd64 behaves strangely, can't gdb it yet (no bt, ...)
14:12 <leo>   (I've to chat with ^conner - it's his machine where I'm testing amd64)
14:12 <leo> - recent stuff isn't checked in yet because of a few test failures on ppc
14:12 <leo> - spent the weekend in Budapest/Hungary, nice Perl workshop
14:12 <leo> - talked with Larry about magic pairs, junctions and possible implications
14:12 <leo>   e.g. with respect to MMD
14:12 <leo>   (runtime param binding due to named arguments can currently cause MMD
14:12 <leo>    redispatch, ...)
14:13 <leo> - fixed a nasty x86/JIT bug in mandel.pir, where due to 80-bit precision
14:13 <leo>   (caused by keeping intermediates in the x86 FP regstack) wrong 'pixels'
14:13 <leo>   were calculated see also: $ svn log -v -r 9514
14:13 <leo>   4 actual patch lines (+ comments, test) done in 8 hrs :-(
14:13 <leo> :wq
14:14 <chromatic> What's blocking you this week?
14:14 <leo> nothing parrot related
14:14 <chromatic> Thanks, Leo.  Matt?
14:15 <mdiep> spent some time this week waiting for chip to give me feedback on my namespace spec
14:15  * chip whistles
14:16 <mdiep> he's getting back to me now, so I shouldn't be blocking on that any longer
14:16 <mdiep> there are also a few points I haven't fully considered
14:17 <mdiep> (namespaces are also variables in python)
14:17 <mdiep> but I think I'm headed in the right direction
14:17 <mdiep> tcl still has failures - some from unimplemented unicode functions
14:17 <mdiep> others from lexical pad issues
14:18 <mdiep> I'm hoping to come up with a fix for the latter, but it means understand all the changes that coke has made 
              and understanding the current lexical pad implementation
14:18 <mdiep> so the new lexical pad implementation and unimplemented unicode functions are blocking
14:18 <mdiep> ^D
14:19 <chromatic> Thanks, Matt.  Is that all that's blocking you?
14:19 <mdiep> yes
14:20 <chromatic> Great.  Nicholas?
14:20 <Nicholas> I got less done last week than I hoped. (basically nothing after Monday) because $work's $work consumed 
                 more of my time and energy than I initially suspected
14:20 <Nicholas> things might be different this week. however
14:21 <Nicholas> I tried out your patch for auto-generating extend.c, and mailed an improved version back to the list, but 
                 to date I don't think that anyone has commented. They're not *all* writing books, are they?
14:21 <Nicholas> and I got some today, but have hit a question about parrot hashes for Chip and Leo that might want to wait 
                 until a questions section.
14:21 <Nicholas> If so, that's it
14:22 <chromatic> What's blocking you?
14:22 <Nicholas> well
14:22 <Nicholas> 1: answer to today's question
14:22 <Nicholas> 2: figuring out how hash iterators work from the C API level, as the docs are thin.
14:22 <Nicholas> (that's just brute force work on my part I think)
14:22 <Nicholas> indireectly
14:23 <Nicholas> 1: I'd hoped that someone would take your patch further
14:23 <Nicholas> 2: last week Chip intimated that my question about events and parrot currently grabbing SIGHUP had an easy 
                 interim solution, but I don't remember any further comment on that solution
14:23 <Nicholas> and
14:24 <Nicholas> 3: longer term, I'm wondering about how parrot will do threading, and how long it will to take to get 
                 right, as ponie will have to implement/emulate ithreads and ithread cloning atop it
14:24 <Nicholas> oh, and I had some other design questions that are in the queue
14:24 <Nicholas> so, I think that's it. Nothing short term. But medium term things are not getting resolved
14:24 <Nicholas> oops, nothing external short term.
14:25 <chromatic> Okay, thanks Nicholas.  I don't know if Jesse's here, so Patrick?
14:25 <pmichaud> <<EOT
14:25 <pmichaud> I'm continuing to forge ahead on the shift/reduce parser
14:25 <pmichaud> I finally found a PIR interface that I think I can live with
14:26 <pmichaud> and I'm getting the parser to handle significant whitespace issues
14:26 <pmichaud> after finishing that I'll be updating the PGE milestones document
14:26 <pmichaud> I expect to have all of that done by Wednesday
14:26 <pmichaud> I'm only blocking on time+energy at the moment
14:27 <pmichaud> I'm a little apprehensive about upcoming changes to the :w flag in p6 rules, but will deal with whatever 
                 comes from the language side of things
14:27 <pmichaud> EOT
14:27 <chromatic> Thanks, Patrick.  Is Autrijus or Jesse here to report?
14:27 <chromatic> I have nothing to report; I had a lot of distractions last week, but hope to review Nicholas' comments on 
                  my patch in the next day or two.
14:28 <chromatic> Okay, let's move on to questions.  Chip had one for Leo.
14:30 <chip> leo: argument pairs
14:30 <leo> yes?
14:30  * pmichaud may have the same question as chip
14:30 <chip> leo: last I heard from autrijus, all named parameter pairs can be known to _be_ named argument pairs at 
             compile time.  Obvoiusly the key values may not be known until runtime.  This is true?
14:31 <chip> (In other words, it's isomorphic to the Python named param model)
14:31 <leo> I think so, yes
14:32 <chip> <burns> Eeexcelent. </burns>  That's it for now
14:32 <chip> (Modifying the calling convention to support that is eminently doable, but isn't blocking anyone AFAIK.)
14:32 <chip> chromatic: I'm good
14:33 <chromatic> Nicholas also had a question.
14:33 <leo> chip: first we need lexicals anyway then we can bind named args
14:33 <chip> quite.  can't assign by name without names.
14:34 <leo> wrt Nicholas' Qs:
14:34 <leo> 1 [extend.c] 
14:34 <leo> if it works, just commit it
14:34 <leo> I don't use extend.c ;-)
14:34  * chip concurs on extend patch, having read the mail
14:35 <Nicholas> no, there was more than that. including a quesiton about whether/how to remove the old names for some of 
                 the APIs
14:35 <leo> chip?
14:35 <Nicholas> it works, but as is it's still a bodge
14:35 <chip> Oh.
14:35 <Nicholas> and I have no good idea how many external bits of code are relying on those API names. Or even a good way 
                 to find/test anything live inside the parrot source tree
14:35 <chip> Policy is as Linus:
14:36 <chip> When you change an API, it's your responsibility to see to it that consumers of the API are fixed ... as long 
             as they're in the same source control tree.
14:36 <chip> Out-of-tree projects fend for themselves.
14:36 <chip> I'll mail to p6i on that now
14:36 <Nicholas> OK
14:37 <Nicholas> Timing wise parrot hacking proves problematic for me, in that the ponie project timescales were envistaged 
                 based on not needing to work on parrot, and I think that we got 'em wrong - ponie is bigger than we 
                 estimated.
14:37 <leo> my POV: patch it, 'make test', if ok mail to p6i and ci
14:37 <Nicholas> So having to do any parrot hacking is
14:37 <Nicholas> a: it's eating into ponie's time budget
14:38 <Nicholas> b: "my brain hurts" - there's already rather too much I'm trying too keep in it at once, and having to 
                 also implement bits of parrot that I need just makes the job longer, and hurts my morale
14:38 <leo> ok fair enough
14:38 <Nicholas> so whilst in theory I can work on parrot, in practice it will kill ponie
14:39 <leo> I think extend.c is a bit different, as ponie is using it I presume heavily
14:39 <Nicholas> it's using parts. but it finds more parts that it needs. it's trail blazing there
14:39 <chromatic> We have source control.  If the patch breaks things on some platforms, won't we get test results?
14:40 <Nicholas> because ponie is coming at parrot from a totally odd direction, compared with all the bytecode using 
                 projects
14:40 <leo> testing extend is a bit tedious, as a) there are just a few extend tests b) ther may be a lot of code outside 
            our tree 
14:41 <Nicholas> I'm not convinced that make test ran tests on everything in our tree, but I've not checked
14:42 <chromatic> Patrick also had a question.
14:43 <Nicholas> I actually haven't asked mine yet :-)
14:43 <leo> Nicholas: the extend code are very thin wrappers around vtables, not much can break there
14:43 <pmichaud> I think my question was answered by chip+leo's exchange, which was about named argument handling in 
                 parrot.  I see what the plan is, like it, and don't have a pressing need for it
14:43 <Nicholas> it's changing the names of the wrapper functions that will break things. fortunately at link time I think.
14:43 <pmichaud> I was just curious about how it would work and eta to implementation so that I could perhaps take 
                 advantage of it from pge.  But I'll wait on it for now.
14:44 <chip> (afk 5min sry)
14:44 <leo> Nicholas: just keep the old interfaces for a while then
14:44 <pmichaud> eoq
14:45 <chromatic> Alright.  Anything else?
14:45 <Nicholas> my quesiton was about the parrot hash code
14:45 <leo> I got some more answers for nich
14:45 <leo> 2 [hash iter from C]
14:45 <leo> seems to be untested and underdoced
14:46 <leo> but straight forward: it's tested from pasm/pir
14:46 <Nicholas> I could see iterator.pod whcih gave a PASM interface
14:46 <leo> just run the vtables which are called from PASM
14:46 <Nicholas> but digging briefly into iterator.pmc, I saw that it actually uses VTABLE methods on key.pmc to get the 
                 next key
14:46 <leo> yes
14:47 <Nicholas> so I wondered if I could skip having an interator PMC and manipulate the key directly
14:47 <leo> the Key holds the state for iteration
14:47 <Nicholas> so if I can create a key that is at the start, I only need it to move through the hash?
14:47 <leo> I can put together a t/src/hash.t that iters over a hash
14:48 <Nicholas> that would be useful, if you can do that easily, beacuse that would make it easier for me to translate to C
14:49 <leo> that would be C already - you probably need translation to extend.c only
14:49 <Nicholas> ah right
14:49 <leo> 3 [sighup]
14:49 <leo> I'll disable it RSn
14:49 <Nicholas> great
14:49 <Nicholas> thanks
14:49 <chip> (back)
14:49 <leo> 4 [threads] too early to ask ;-)
14:49 <Nicholas> :-(
14:49 <Nicholas> that's what I feared
14:50 <leo> a ParrotThread isa ParrotInterpreter
14:50 <leo> which is created by ParrotThread.clone of an interpreter
14:50 <Nicholas> but they are evil and pervade everything, hence why the sooner we get the the prototype, the sooner we can 
                 throw it away and make the real thing :-)
14:51 <Nicholas> it's the cloning that's the faff I'm scared of. Threads running are steady state
14:51 <Nicholas> and only the ithreads threads::shared needs replacing, and it's a bit pants currently, so whatever 
                 replaces it will probably actually be an improvement
14:51 <leo> the problem currently is that we don't have shared PMCs (except TQueue)
14:52 <Nicholas> mmm, shared PMCs. and shared GC.
14:52 <Nicholas> eek.
14:52 <chip> is cloning actually necessary?
14:52 <leo> shared PMCs need some vtable tweaking 
14:52  * chip would prefer a spawn model for threads, rather than a fork model
14:52 <Nicholas> I can't see how cloning can be avoided to correctly implement 5.8.x ithread semantics
14:53 <chip> brute force, then?  iterate through all namespaces looking for an honest man^W^W^Wshared PMCs?
14:54 <leo> no
14:54 <Nicholas> it's just the details. the devil being in the details. and how to replace all the clone code from the 
                 bottom of sv.c with something that does PMCs
14:55 <Nicholas> [and I've still not asked my question about hases]
14:55 <chip> Nicholas: In short we can't answer it yet.  But you have added a use case
14:55 <chip> (use cases.  slowly I turn...)
14:56  * chip suggests moving on to the answerable
14:56 <Nicholas> :-)
14:56 <Nicholas> OK. Leo kindly wrote an address registry PMC. and I used it.
14:56 <Nicholas> And then I noticed that I already had a hash implenmeted using the itreads ptr_table code to track all 
                 SVs, as step 1 of eliminating arenas
14:57 <Nicholas> and I thought "this duplicates the address registry. If I can iterate over the address registery, I can 
                 kill this ptr_table hash"
14:57 <Nicholas> and then I realised/remembed the pain it copes with
14:57 <Nicholas> sv.c wants to iterate over all remaining SVs
14:57 <Nicholas> and "do stuff" to them.
14:57 <Nicholas> if you're going to meet SVs A and B in that ortder during iteration
14:57 <Nicholas> the fun comes because
14:58 <Nicholas> you can process A, which can cause B to be deleted
14:58 <Nicholas> alternatively, processing A can add more SVs, by creating new ones
14:58 <Nicholas> so the ptr_table hash code had to be hacked about until it could cope with
14:58 <Nicholas> 1: things being deleted mid iteration
14:58 <Nicholas> 2: things being added mid iteration. (it doesn't actually matter if you meet them during the iteration)
14:59 <Nicholas> IIRC, Leo said that the current src/hash.c implementation can cope with things being deleted mid iteration
14:59 <leo> yes
14:59 <Nicholas> but before I try to work out from understanidn the source
14:59 <Nicholas> can it cope with things being added?
14:59 <leo> that depends
14:59 <Nicholas> and secondly, is this an "implementation side effect", or is either/both the deletion/addition stuff 
                 guaranteed in its "spec"
14:59 <leo> you probably want to see these PMCs later in iteration?
15:00 <Nicholas> I don't mind if I don't see the added PMCs
15:00 <leo> then iteration should still work
15:00 <Nicholas> because the existing perl 5 SV iteration code had no idea if it was going to meet newly created PMCs 
                 immediately
15:00 <Nicholas> I can add to a hash mid iteration, and still see all the keys that were in it before I started iterating?
15:01 <Nicholas> [I don't mind it being unspecified whether I see keys I added mid-iteration]
15:01 <leo> untested but I thimk yes
15:01 <Nicholas> [I do mind that I mustn't "see" keys that I delete prior to reaching them]
15:01 <leo> think even
15:01 <Nicholas> but I faked that in ptr_table by replacing keys with NULL, and then running a cleanup afterwards to 
                 actually delete the NULLs
15:02 <Nicholas> does the hash do a "split" if it gets full buckets?
15:02 <leo> that's not necessary with parrot hashes as the bucket storeage is inside the hash and not malloced
15:03 <Nicholas> ponie has this:
15:03 <Nicholas>     if (!empty && tbl->tbl_items > tbl->tbl_max && !tbl->iteration_nesting)
15:03 <Nicholas> Iptr_table_split(tbl);
15:03 <Nicholas> where !tbl->iteration_nesting is the check to disable any split mid-iteration
15:03 <leo> if it's getting full it resizes, bucket storage is expanded and bucket pointers are recalced
15:03 <pmichaud> (gotta run, see you all next week)
15:03 <Nicholas> but an iterator would still be valid across that resize?
15:04 <leo> I think so yes
15:04 -!- pmichaud [~chatzilla@c-24-1-26-255.hsd1.tx.comcast.net] has left #parrotsketch []
15:04 <chip> even if hte iterator is valid, the list of 'future' notes changes with the resize, I should think
15:04 <Nicholas> OK. Good. It's not so in perl5, either in hv.c or the ptr_table code before I bodged it
15:04 <chip> so some nodes will no longer be visited
15:04 <Nicholas> gah. that's not going to suit me. need to visit everything that I started with
15:04 <chip> I suspect you'll want to swap hashes.  Union hash, so to speak
15:04 <Nicholas> yes. :-(
15:05 <Nicholas> I was starting to think that I'd need a second hash of "things I added"
15:05 <Nicholas> union the two during the iteration
15:05 <Nicholas> merge it in afterwards
15:05 <chip> seems so
15:05 <leo> not necssarily
15:05 <Nicholas> if chip's answer is "the answer", then that's OK.
15:06 <Nicholas> I know that I need to do the work. Rather than wondering
15:06 <leo> if delete puts in a DELETED_pmc, all added pmcs go to the end and wil be seen
15:06 <Nicholas> I don't mind if the added PMCs don't get seen
15:06 <leo> but a few tests can easily verify how it works
15:06 <Nicholas> but I do mind if a resize causes some PMCs not to be seen
15:06 <chip> leo, it's growth making preexisting entries rearrange to behind the iterator that's the problem
15:06 <leo> as said, resize shouldn't cause any problems
15:07 <chip> having seen A and B but not C, adding D can put C behind the iterator when it used to be ahead, so C will not 
             be visited.
15:07 <leo> not as far as I know
15:07 <chip> but the buckets get recalculated.
15:07 <leo> bucket pointers
15:07 <chip> oh well.  I haven't read the code.
15:08 <chip> just working on first principels
15:08  * chip bows out
15:08 <chromatic> I need to take off in a few minutes.
15:08 <Nicholas> I prefer to understand the code. As my ability to write evil controlled tests is far less than the ability 
                 of the perl regression tests to throw up unpredictable corner cases that I never envisaged a test for, and 
                 so spend some hours (or days)(or weeks once) head scratching
15:08 <chromatic> Is there anything else?
15:08 <leo>    for (b = hash->bu.bs-i-1; i < (INTVAL)N_BUCKETS(hash->mask + 1); ++i, --b)
15:08 <Nicholas> chip,leo: thanks
15:08 <leo> that runs through the bucket store
15:09 <chromatic> Leo, can you add tests for that to the iteration tests in hash.t you mentioned earlier?
15:09 <leo> yup, I'll do
15:09 <chromatic> Chip had another question, though I'm not sure it was a public one.
15:09 <chip> chromatic: not Parrot-related
15:10 <chromatic> Go ahead.
15:10 <chip> er, I meant, not for this channel.  I was just wanting you not to run off post-meeting
15:10 <chip> until I could ask it
15:10 <chip> sry
15:10 <chromatic> Ah okay.
15:10 <chromatic> I'll send out logs in a little bit.  Thank you all.
15:11 <Nicholas> given that our logbot isn't here, who will grab the log?
15:11 <chromatic> I'm saving it now.
15:11 <Nicholas> and was our logbot on london.irc.perl.org? if so, that would explain its absense
15:11 <Nicholas> er, absence.
15:12 <chromatic> Perhaps irc.perl.org.
15:12 <chip> thanks chromatic 
15:12 <leo> thanks too
15:12 <Nicholas> thanks
15:14 -!- chromatic [~chromatic@nat-147-140.oreilly.com] has quit [Quit: meeting]
</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


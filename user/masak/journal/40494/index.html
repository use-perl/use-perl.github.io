<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of masak: Weeks 8..12 of GSoC work on Buf -- not packing it in yet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Weeks 8..12 of GSoC work on Buf -- not packing it in yet</h1>
<h2><a href="/user/masak/">masak</a> on 2010-08-13T22:35:51</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p><em>I was reproached by my colleague because of the lack of "no cake"-style jokes in this last grant update. So what can I do to amend the situation? Firstly, let me concede that the below blog post is almost tear-inducingly boring. Secondly, let me remind you that when accosted by boring material such as that in this post, the most important thing to have is a positive outlook on life. Thank you.</em></p>

<p>The past couple of days have been really eventful. The coming couple of days probably will be, too. It seems fitting to punctuate all this eventfulness with a status-updating blog post, something that I apparently haven't gotten around to in a few weeks.</p>

<p>So, what's been happening?</p>

<ul>
<li>In the <a href='http://use.perl.org/user/masak/journal/40440'>last update</a>, I was at a point where I needed to encode to different encodings, not just UTF-8. Tonight I had <a href='http://irclog.perlgeek.de/parrot/2010-08-13#i_2701004'>an enlightening discussion</a> with the Parrot people, which gave all the pieces of the puzzle. Now it's just a Simple Matter of Programming. More precisely, I need to apply it to <a href='http://github.com/rakudo/rakudo/blob/0839993ed01c816dc8b3459fa7b79608be4fbf3a/src/core/Str.pm#L17'>this spot</a> in the code base.</li>

<li>By that discussion, I was once again made aware that Parrot differs between <em>encodings</em> and <em>charsets</em>. For example, <code>utf8</code> is an encoding, but <code>iso-8859-1</code> is a charset. It's confusing me slightly, but that's OK. I can make the code work so that both are treated as "encodings" on the Perl 6 level.</li>

<li>I got unexpected assistance from oha++, who took me aside in private discussions to discuss new wild ideas for <code>Buf</code>. It all culminated in a <a href='http://www.mail-archive.com/perl6-language@perl.org/msg32689.html'>p6l thread</a>. Oha is writing code that uses Buf for network traffic, and has been preparing a patch for making <code>IO::Socket::INET</code> return <code>Buf</code>s instead of <code>Str</code>s. In trying out this patch, oha++ found that some tests <a href='http://irclog.perlgeek.de/perl6/2010-08-12#i_2694900'>will never work</a> when <code>Buf</code>s are used. Those tests will probably need to be rewritten.</li>

<li>During the past week or so, I've been implementing <code>pack</code> and <code>unpack</code> in a branch. I'm making steady progress, and trying to take in documentation such as Perl 5's <a href='http://perldoc.perl.org/functions/pack.html'><code>perldoc -f pack</code></a> and <a href='http://perldoc.perl.org/perlpacktut.html'><code>perlpacktut</code></a> and <a href='http://www.erlang.org/doc/man/ei.html'>Erlang's</a> <a href='http://www.trapexit.org/How_to_use_ei_to_marshal_binary_terms_in_port_programs'><code>ei</code></a> and <a href='http://www.tcl.tk/man/tcl8.5/TclCmd/binary.htm'>Tcl's <code>binary</code></a>. It's a lot to take in, and I won't aim for full functionality &#8212; look, <a href='http://github.com/mirrors/perl/blob/blead/t/op/pack.t'>Perl 5 has 14699 tests</a> for pack! &#8212; but rather a reasonable subset of the directives from Perl 5.</li>
</ul>

<p>There's a lot to be said about the interplay between Perl 6's high level of abstraction and the almost reckless to-the-metal feeling of <code>&pack</code>/<code>&unpack</code>. Add to this that the "metal" in this case is Parrot, which in some regards is there to abstract away the real metal. I think the details of this interplay might well be the subject of a separate blog post. When I'm not busy finishing up the code itself. &#21704;&#21704;</p>

<p>The hard pencils-down deadline for GSoC is on Monday. I'm pretty sure I will have tied up the remaining loose ends by then, but I also foresee a couple of fairly focused hours programming before that. Time to dig back in; see you on the other side.</p></p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


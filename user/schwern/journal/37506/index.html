<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of schwern: Method::Signatures 0.05:  speedy \@foo, closures work</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Method::Signatures 0.05:  speedy \@foo, closures work</h1>
<h2><a href="/user/schwern/">schwern</a> on 2008-09-21T22:24:29</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>Using Matthijs van Duin's amazing <a href="http://search.cpan.org/dist/Data-Alias">Data::Alias</a> module, the \@foo prototype now runs without a performance hit and @foo is a true lexical so closures work!<br/><br/><a href="http://search.cpan.org/dist/Method-Signatures">Method::Signatures</a> 0.05 just released.</p>


<hr/>



<h2>Sweet! But are attributes possible?</h2>
<h3><a href="/user/rhesa/">rhesa</a> on 2008-09-21T22:41:17</h3>
<p>I really like this. I was already tinkering with my extract_method script to make use of this gem of yours, and references were one of my unsolved issues. Thanks for fixing that so quickly<nobr> <wbr></nobr>:)</p><p>Is there any chance code attributes will be supported? I'd like to use this with CGI::Application, and I bet it'd be cool for Catalyst too.</p>



<blockquote>

<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/Aristotle/">Aristotle</a> on 2008-09-22T01:36:59</h3>
<p>Catalyst has plans to obsolete the attribute syntax in favour of something very much like Method::Signatures, where you write something very roughly like </p><blockquote><div><p> <tt>action foo (/bar/baz) {<nobr> <wbr></nobr>... }</tt></p></div> </blockquote><p> rather than </p><blockquote><div><p> <tt>sub foo : Chained('/bar/baz') {<nobr> <wbr></nobr>... }</tt></p></div> </blockquote><p> &#8230; at least that was the idea when I last heard of it.</p>



<blockquote>

<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/Ovid/">Ovid</a> on 2008-09-22T05:21:15</h3>
<p>I'm already having issues with how "magical" bits of Catalyst are.  Using hooks into the op-tree to stack the magic stuff on doesn't really reassure me.  Does it seem warranted?</p>



<blockquote>

<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/tsee/">tsee</a> on 2008-09-22T07:16:15</h3>
<p>Assuming that these bits of Catalyst would also be done with Devel::Declare, and guessing that it's still mostly mst hacking on Devel::Declare, it all depends on whether he's hit by a bus, doesn't it?</p><p>Personally, I'd rather worry about whether, by getting too cosy with the internals, Catalyst may eventually get similar breakage as Rails did between Ruby releases.</p>



<blockquote>

<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/Alias/">Alias</a> on 2008-09-22T08:18:30</h3>
<p>Indeed.</p><p>Data::Alias has already horribly died once, plus it doesn't work anywhere that forbids the hack it uses to reference unexported symbols.</p>



<blockquote>

<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/Aristotle/">Aristotle</a> on 2008-09-22T15:05:01</h3>
<p>There was discussion on p5p a while back to pull modules like PadWalker and Data::Alias into the core on the basis that they are highly dependent on the internals, and need to be maintained in synch, but that never happened. I still think it&#8217;s a good idea; Data::Alias and PadWalker allow things that are indispensable in some situations, and leaving them fend for themselves seems like a choice that diminishes the value of the entire Perl ecosystem to an extent.</p>





</blockquote>

</blockquote>

</blockquote>

</blockquote>


<h2>Re:Sweet! But are attributes possible?</h2>
<h3><a href="/user/schwern/">schwern</a> on 2008-09-22T16:49:32</h3>
<p><div class="quote"><p>Is there any chance code attributes will be supported?</p></div><p>I hadn't even thought about them.  It could, I think it just involves more Devel::Declare black magic from mst to make it aware of attributes.</p>





</blockquote>


<h2>Launch from Moonbase Alpha</h2>
<h3><a href="/user/jplindstrom/">jplindstrom</a> on 2008-09-22T00:20:36</h3>
<p>Very. Very. Cool.</p><p>So it's alpha, with large blinking warning signs to stay away, etc. Is the alpha flag a matter of concept (unsound/fragile) or a matter of effort (just not done yet)?</p><p>What's needed (if possible) to get it to a state so that people can use it?</p>



<blockquote>

<h2>Re:Launch from Moonbase Alpha</h2>
<h3><a href="/user/schwern/">schwern</a> on 2008-09-22T16:35:07</h3>
<p><div class="quote"><p>Is the alpha flag a matter of concept (unsound/fragile) or a matter of effort (just not done yet)?</p></div><p>It might be fragile.  So far it's holding up well, but I haven't done anything major with it and I'm wary of building this on top of so much scary tech.  Devel::Declare has a few bugs (it causes the debugger to spin like a top) that I hope mst will clear up shortly.</p><p>Second is the prototyping syntax and behaviors.  Since I'm creating, essentially, a new language feature here I'd like it to get knocked around some before locking it in place.  I'm pretty happy with how it's come out, and if I stabilized with just the list of features in 0.10 I'd be very happy.</p><p>There's a list of <a href="http://search.cpan.org/user/mschwern/Method-Signatures-0.10/lib/Method/Signatures.pm#BUGS,_CAVEATS_and_NOTES" title="cpan.org">bugs and caveats</a cpan.org> as well as the open issues from the <a href="http://www.perlfoundation.org/perl5/index.cgi?named_parameter_proposal" title="perlfoundation.org">named parameters proposal</a perlfoundation.org> which Method::Signatures is an implementation.</p><p><div class="quote"><p>What's needed (if possible) to get it to a state so that people can use it?</p></div><p>More testing to ferret out bugs.  More commentary on how the prototypes behave (good or bad).  More fuel for mst's brain.</p><p>Also making sure I'm not boxing the prototype syntax into a corner.  That I'm not preventing us from adding something important on later.</p>



<blockquote>

<h2>Re:Launch from Moonbase Alpha</h2>
<h3><a href="/user/jplindstrom/">jplindstrom</a> on 2008-09-22T22:31:31</h3>
<p>On the matter of syntax, do you have any ideas on named arguments (i.e. hash/hash ref automatically unpacked into the variables)?</p><p>It seems doable to me. If the signature is misc vars, but you pass in a single hash ref, then... *magic*</p>



<blockquote>

<h2>Re:Launch from Moonbase Alpha</h2>
<h3><a href="/user/schwern/">schwern</a> on 2008-09-23T09:42:45</h3>
<p>While they are definitely a possibility, and you're not the first<br>person to ask for them, I'm wary of trying to mirror Perl 6's <a href="http://perlcabal.org/syn/S06.html#Named_parameters" title="perlcabal.org">named parameters</a perlcabal.org> right now for a number of reasons.  First, they're not<br>necessary just now.  Method::Signatures has a nice bag of problems to<br>deal with already and the signature syntax is extensible.  And I<br>haven't given them a lot of thought.</p><p>Second, Perl 6 has all sorts of magic at the caller's end to force<br>named vs positional parameters.  We have none of that.  All we can do<br>is, as you suggest, treat a hash ref as positional.  But that leaves<br>some ambiguity...</p><blockquote><div><p> <tt>method foo( $things ) {<br>&nbsp; &nbsp;<nobr> <wbr></nobr>...<br>}<br>
&nbsp; <br>Class-&gt;foo({ things =&gt; 42 });</tt></p></div> </blockquote><p>What's in $things?  Currently it's { things =&gt; 42 }.  Under named<br>parameters it might be just 42.  Or maybe not.  It's ambiguous.</p><p>Because named parameters are implied in every method, it means every method has to have a little extra code to check if the first argument is a hash ref.  This adds a performance hit of about 10-15% to an empty method call whether or not you use it.</p><blockquote><div><p> <tt>#!/usr/bin/perl -lw<br>
&nbsp; <br>use Benchmark qw(cmpthese);<br>
&nbsp; <br>{<br>&nbsp; &nbsp; package Methods;<br>&nbsp; &nbsp; use Method::Signatures;<br>
&nbsp; <br>&nbsp; &nbsp; method echo(\@args) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return @args;<br>&nbsp; &nbsp; }<br>}<br>
&nbsp; <br>{<br>&nbsp; &nbsp; package Subs;<br>
&nbsp; <br>&nbsp; &nbsp; sub echo {<br>&nbsp; &nbsp; &nbsp; &nbsp; my $self = shift;<br>&nbsp; &nbsp; &nbsp; &nbsp; my $args = $_[0];<br>&nbsp; &nbsp; &nbsp; &nbsp; return @$args;<br>&nbsp; &nbsp; }<br>}<br>
&nbsp; <br>{<br>&nbsp; &nbsp; package Subs::With;<br>
&nbsp; <br>&nbsp; &nbsp; sub echo {<br>&nbsp; &nbsp; &nbsp; &nbsp; my $self = shift;<br>&nbsp; &nbsp; &nbsp; &nbsp; my $args = (ref $_[0] eq 'HASH') ? $_[0]-&gt;{args} : $_[0];<br>
&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return @$args;<br>&nbsp; &nbsp; }<br>}<br>
&nbsp; <br>cmpthese( shift || -3, {<br>&nbsp; &nbsp; 'M::S'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; sub { Methods-&gt;echo([1,2,3,4]) },<br>&nbsp; &nbsp; 'sub'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&gt; sub { Subs-&gt;echo([1,2,3,4]) },<br>&nbsp; &nbsp; 'with positional'&nbsp; &nbsp;=&gt; sub { Subs::With-&gt;echo([1,2,3,4]) },<br>&nbsp; &nbsp; 'as positional'&nbsp; &nbsp; &nbsp;=&gt; sub { Subs::With-&gt;echo({ args =&gt; [1,2,3,4] }) },<br>});<br>__END__<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rate as positional with positional&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;M::S&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sub<br>as positional&nbsp; &nbsp;272775/s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -39%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-45%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-47%<br>with positional 448256/s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;64%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-10%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-13%<br>M::S&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 496243/s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;82%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -3%<br>sub&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512481/s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;88%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--</tt></p></div> </blockquote><p>It needs more thought.  Maybe you can think of some trick to eliminate that drag.  Or maybe a method would have to declare its use of named parameters.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


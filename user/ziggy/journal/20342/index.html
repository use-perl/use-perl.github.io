<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of ziggy: Newfound Respect for Class::DBI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Newfound Respect for Class::DBI</h1>
<h2><a href="/user/ziggy/">ziggy</a> on 2004-08-10T14:57:08</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>So I finally took a look at <a
href="http://www.hibernate.org/">Hibernate</a>, the new kid on the
block for lightweight persistance in Java.  The <a
href="http://use.perl.org/comments.pl?sid=21886&cid=33273">docs</a>
described something so hideously complex, I stopped skimming after Chapter 1
(of 19).  If I want to have object based access to a database, why do I
need to use Tomcat, code generators, and XML config files?  I
<i>just</i> want simplified database access ferchrissakes!

<p>

I'm still twitching in disbelief.  Class::DBI may have a lot of
dependencies on modules from CPAN, but the interface itself is
simple, easy to understand, and easy to use -- especially in the
simple case.  And I don't need to redefine fundemental constants
of the universe in the process.
</p>


<hr/>



<h2>Javalternative</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2004-08-10T16:19:39</h3>
<p>Remember, Hibernate is a reaction to EJB, which I believe was originally a conspiracy between Pope John XIII and the Byzantine Empire to divide up Africa.</p>



<h2>overstating it a bit?</h2>
<h3><a href="/user/perrin/">perrin</a> on 2004-08-10T17:59:33</h3>
Hibernate is more complex than Class::DBI, but it's not hard to use.  To your specific complaints, Hibernate doesn't need Tomcat, although Tomcat is a common place to use it.  It uses code generation, but so Class::DBI.  In both cases, the code generation is done at run-time.  It does use XML config files, and I kind of like them.  Take a look at this one from the quickstart chapter:<blockquote><div> <tt>&lt;?xml version="1.0"?&gt;<br>&lt;!DOCTYPE hibernate-mapping<br>&nbsp; &nbsp; PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"<br>&nbsp; &nbsp; "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd"&gt;<br> <br>&lt;hibernate-mapp ing&gt;<br> <br>&nbsp; &nbsp; &lt;class name="net.sf.hibernate.examples.quickstart.Cat" table="CAT"&gt;<br> <br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- A 32 hex character is our surrogate key. It's automatically<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; generated by Hibernate with the UUID pattern. --&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;id name="id" type="string" unsaved-value="null" &gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;column name="CAT_ID" sql-type="char(32)" not-null="true"/&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;generator class="uuid.hex"/&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/id&gt;<br> <br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- A cat has to have a name, but it shouldn' be too long. --&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;property name="name"&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;column name="NAME" length="16" not-null="true"/&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/property&gt;<br> <br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;property name="sex"/&gt;<br> <br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;property name="weight"/&gt;<br> <br>&nbsp; &nbsp; &lt;/class&gt;<br> <br>&lt;/hibernate-mapping&gt;</tt> </div></blockquote>This provides two constraints, and id generation from the program rather than the database.  Doing those things in Class::DBI would require writing a constraint method and a trigger method, and is generally more confusing.  One idea I've had is to write something that would allow Class::DBI classes to be configured with an XML file like this.  So far though, I haven't used the constraints enough to make it worth the trouble.<p>
Class::DBI is pretty good for a simple O/R mapper, but Hibernate has a much more complete feature set.  If there was a full-featured port of Hibernate for Perl, I would definitely be using it instead of Class::DBI.</p>



<blockquote>

<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/tmtm/">tmtm</a> on 2004-08-10T18:38:22</h3>
Personally, my brain switches off at the sight of XML, so I find it really hard to read that example at all. Seriously.<br> <br>I'm not entirely convinced that<br> <br>__PACKAGE__-&gt;constrain_column(name =&gt; qr/\w{1,16}/);<br> <br>is that much more confusing than their XML, but the constrain_column stuff is fairly simplistic at the minute (interface wise. It's actually designed so that my base class can set up certain things to make it hook into CGI::Untaint in nice ways). I'm certainly tempted to allow:<br> <br>__PACKAGE__-&gt;constrain_column(name =&gt; sub { length = 16 });<br> <br>I'd certainly be interested in a list of Hibernate features that you'd like to see in Class::DBI. I tried reading their docs, but my brain shut down.



<blockquote>

<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/tmtm/">tmtm</a> on 2004-08-10T19:03:43</h3>
<tt>&gt; __PACKAGE__-&gt;constrain_column(name =&gt; sub { length = 16 });<br> <br>That was even easier than I'd expected. (Other than perl needing to disambiguate via length()...)<br> <br>&nbsp; &nbsp; } elsif (ref $how eq "Regexp") {<br>&nbsp; &nbsp; &nbsp; $class-&gt;add_constraint(regexp =&gt; $col =&gt; sub { shift =~ $how });<br>|+&nbsp; } elsif (ref $how eq "CODE") {<br>|+&nbsp; &nbsp; $class-&gt;add_constraint(<br>|+&nbsp; &nbsp; &nbsp; code =&gt; $col =&gt; sub { local $_ = $_[0]; $how-&gt;($_) });<br>&nbsp; &nbsp; } else {<br> <br>Tony</tt>



<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/perrin/">perrin</a> on 2004-08-10T19:49:50</h3>
I'm really not a big XML fan, but I think it's applied in a very reasonable way here.  The constrain_column() method requires more thinking than specifying it in the XML does.  I would ideally like to see more of the stuff that Tim Bunce did to auto-detect database constraints folded into Class::DBI::SomeDBD classes.  He had stuff to detect the column length, not-NULL constraints, etc. and build the same constraints in the CDBI classes.<p>
Hibernate has many good features.  Here are some of the ones I would most like to have:
</p><ul>
<li>Built-in support for mapping of inheritance.</li>
<li>Efficient many-to-many support, including support for search criteria on the mapping table.</li>
<li>Support for flexible object and query caching.  (I plan to work on this.)</li>
<li>Built-in support for fetching a graph of related objects in one SQL statement (like the recent question on the mailing list about fetching an object and it's might_have relation in one shot).</li>
<li>Optimistic locking.  This wouldn't be very hard to add, I think.</li>
<li>More extensive support for collections, like delete_from_* (as opposed to add_to_*) and mapping of related objects to sets, rather than just arrays.</li></ul>





</blockquote>


<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/djberg96/">djberg96</a> on 2004-08-10T20:50:23</h3>
This is why I'm becoming less of a fan of ORM's in general every day.  To me having XML config files like this feels like I'm writing the DDL *twice*.
<p>
I'm now beginning to contemplate a strictly bottom-up ORM approach, where you would get this information dynamically instead of by hand.
</p><p>
Actually, I'm starting to think ORM's are an unnecessary layer of goo.</p>



<blockquote>

<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/pdcawley/">pdcawley</a> on 2004-09-05T17:25:22</h3>
Down that road lies Pixie.





</blockquote>


<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/ziggy/">ziggy</a> on 2004-08-11T00:37:54</h3>
<blockquote><div> <i>
Hibernate doesn't need Tomcat, although Tomcat is a common place to use it.
</i> </div></blockquote>

Whatever.  I really don't care if Hibernate or Hibernate's docs are making my skin crawl.  I've been programming long enough to know that I'm looking for a thin shim that converts application-level concepts into database actions, and that I want that as a single aspect in my codebase.  If the Hibernate folks are telling me that I need a full-bore <a href="http://www.pablotron.org/download/7_layer_burrito.html" title="pablotron.org">seven layer burrito</a pablotron.org> to use their code, I'd rather write my own CDBI-inspired abstraction instead.

<blockquote><div> <i>
It uses code generation, but so Class::DBI. In both cases, the code generation is done at run-time. It does use XML config files, and I kind of like them.
</i> </div></blockquote>

I don't have any quibbles about autogenerated code.  I <i>do</i> mind that I need to install yet another dependency to get code generation to work before I can even kick the tires.

<p>

I don't want to touch the programming-via-XML-config-file bikeshed.  If it works for you, then by all means use it.  For me, I don't want to spend the effort -- however minimal -- switching gears between reading code and reading XML metacode.</p>



<blockquote>

<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/perrin/">perrin</a> on 2004-08-11T04:12:21</h3>
Mapping a data model with any complexity between objects and a database is just not that simple a problem.  Hibernate is pretty easy to use.  It might look complex to you if you are not already familiar with current Java concepts, in the same way that Class::DBI leaves many Perl newbies scratching their heads.  There is a basic assumption that you've already written some Java apps with databases and objects and thus are familiar with the terms and libraries.  I wouldn't hire a Java coder who didn't know Tomcat, and the code generation library being used is pretty common in Java open source projects these days.<p>
I can't see complaining about its dependencies being fair, considering how many Class::DBI has.  And it's hard for me to imagine a perl interface for declaring all of that metadata that would be any easier to read than the XML config.  Plus it's neat to write classes without any database awareness in them at all and then magically persist them by writing this separate config.</p><p>
All I'm saying is, don't dismiss it as needlessly complex so quickly.  Hibernate is only tricky in the places where the underlying problem it's trying to solve is tricky.  It has some good ideas and has really had a big impact on how object persistence is done in Java.</p>



<blockquote>

<h2>Re:overstating it a bit?</h2>
<h3><a href="/user/ziggy/">ziggy</a> on 2004-08-11T04:59:52</h3>
I'm still not swayed.  Let's just call this a bikeshed and move on.

<p>

I've written about three database abstraction frameworks in the last two years, none of which have had a dependency aside from DBI / database drivers.  So it <i>is</i> possible, even if it doesn't scale up to handle every degenerate schema on the planet.

</p><p>

That's fine.  What I'm looking for is probably outside the scope of what Hibernate is trying to deliver (or, best case, what the Hibernate docs have chosen to focus on).  I can live with that.  I've found that ~80% of the benefit is not from purging SQL code from an application and replacing it with an ORM framework.  The primary benefit comes from programming in an aspect-like manner, separating the generic database code from the schema management, and separating schema management from the rest of the application.  With that big a win, I haven't found the need use ORM frameworks.

</p><p>

But that's just me.  I could be wrong here.</p>





</blockquote>

</blockquote>

</blockquote>


<h2>8hrs &amp;gt; 30 min ? 'bad' : 'good'</h2>
<h3><a href="/user/inkdroid/">inkdroid</a> on 2004-08-10T18:55:44</h3>
I was just going through the same process of getting aquainted with hibernate. I thought it would be fun to see how long it took me to get up and running with a simple class. It took 8hrs (give or take a few minutes); compared to like 30 minutes for Class::DBI using Kake's <a href="http://www.perl.com/pub/a/2003/07/15/nocode.html" title="perl.com">article</a perl.com>.
<p>
I actually *like* the XML file since you can autogenerate the db schema with it, and also autogenerate the pojo's with it. You're right, the docs are very intimidating...but there are some good beginner <a href="http://www.systemmobile.com/articles/IntroductionToHibernate.html" title="systemmobile.com">articles </a systemmobile.com> linked from the hibernate.org site which I found more useful.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


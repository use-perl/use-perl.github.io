<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of ziggy: In the Zone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>In the Zone</h1>
<h2><a href="/user/ziggy/">ziggy</a> on 2002-03-27T01:07:26</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>I guesstimated that it would take me 2 solid months (with interruptions) to rewrite 250,000 lines of really bad Perl code (with lots of embedded SQL and HTML) into something small, manageable and maintainable.  Lucky for me that the rough count via <tt>wc</tt> was for the <i>entire package</i>, not the back end system I'm concerning myself with.  It turns out that it's using roughly 50,000 LOC to do something reasonably trivial (extract a complex schema from a database and emit SGML).
<p>
As best as I can count, there are <i>only</i> 60 or so of over 200 inhouse modules used in this part of the project.  That number was found by removing all <tt>use lib</tt> statements (Yes, Virginia, there are <tt>use lib</tt> statements peppered about the code...), mucking with <tt>@INC</tt> to <i>not</i> include any non-standard directories, and continually running <tt>perl -c</tt>.  I copied one of these modules at a time into the current directory until the main program passed the syntax checker: 60ish modules found (from memory; I'm not at the office at the moment).
<p>
Two of the many factors that allowed this code to get into this state are copy-and-paste programming 
and poor idiomatic usage.  No surprises there.  What was an immense boon to the project were the supposedly "generic" modules that were required to get this program to compile: things like CGI, modules for web-based user authentication and HTML generation are to be included in that 50KLOC figure, and completely unnecessary for my purposes.
<p>
For a project like this, <a href="http://perltidy.sf.net/">PerlTidy</a> is an incredible help.  I find the native formatting style to be abysmal, but that's purely a matter of taste; nothing substantive wrong here.  Running all the code through PerlTidy to produce a single, consistent style has been a great help.  (I also told PerlTidy to remove all comments and POD; that removed around 10KLOC from examination.  Woo Hoo!)
<p>
The project is turning the corner now.  I've been in the zone for the the past two weeks, to the point where I come home at night completely drained.  Today, I started the familiar sprint to the end, where it's a simple case of iterative development and refinement until the new system agrees with the old system.  Three weeks into the project, and it looks like I should have a new foundation and a completed prototype by the end of the week (barring major complications).
<p>
That's going to be a great help, since I'm not sure I can get the XSLT stylesheets done to my satisfaction within the one month I promised.  I thought that generating PDF would be enough, but it looks like RTF generation is going to be a requirement as well...</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


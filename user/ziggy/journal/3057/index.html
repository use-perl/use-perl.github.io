<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of ziggy: Converting XML and avoiding DSSSL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Converting XML and avoiding DSSSL</h1>
<h2><a href="/user/ziggy/">ziggy</a> on 2002-02-23T00:36:49</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>Remember the early days of XML?  Remember how widespread adoption was key, and <i>leveraging</i> (ugh) the existing SGML infrastructure was important?   Even in those areas where SGML tools seemed like a good bet (like converting XML to print), they really weren't as great as the apologists made out.
<p>
Duh.
<p>
It took forever to get XSL-FO out the door, and even now the tool support isn't that great (except thorough TeX; Thank You Sebastian!).  Which leaves us with the old model DSSSL stylesheet to produce print (typically RTF), or generating PostScript,  PDF, or some TeX variant on your own (no thanks!).
<p>
I've worked with enough corner cases to say that DSSSL was a good average case solution, if you knew enough Scheme and DSSSL to be dangerous.  But the flow object model supported by DSSSL and the quirks of the [Open]Jade back end lead me to say that this path was never as glorious as the apologists promised.  Case in point: <tt>keep-with-next-paragraph</tt> support.
<p>
This week I had to craft a rather complicated output from a rather large document.  Margins; gutters; colors (no big deal); tables, and <b><i>lots</i></b> of keeps.  Either I don't understand what the rather dense DSSSL spec is telling me, or [Open]Jade doesn't really do what the spec says it should do (doubtful), or the [Open]Jade RTF backend doesn't manage keeps and other such properties very well.  I'm going with option number 3 here (based on some other quirks I've grown to know and love...).  
<p>
Eventually, there comes a time when you have to accept that DSSSL or OpenJade or the RTF backend cannot produce what you expect; and it's time to remediate the problem.  The classic solution is to fire up Word as an OLE server, load the document and poke around to get the formatting.  Except when you have to remediate <i>every single paragraph!</i>
<p>
After lots of trial and error, I can say conclusively that the best tools for RTF remediation are (1) MS Word (to see what you <i>should</i> have generated in the first place), (2) <tt>diff</tt>, (3) Perl, and (4) a vague clue about RTF syntax.
<p>
Shoot me for not seeing this sooner.</p>


<hr/>



<h2>RTF</h2>
<h3><a href="/user/TorgoX/">TorgoX</a> on 2002-02-23T04:35:18</h3>
A significant problem these days with looking at the <a href="http://search.cpan.org/doc/SBURKE/RTF-Writer-1.06/lib/RTF/Cookbook.pod" title="cpan.org">RTF</a cpan.org> that MSWord generates is that MSWord 2000 generates ungodly amounts of code that is pointless.

<p>Here's "Hello World" as generated by wordpad:
</p><blockquote><div>
{\rtf1\ansi\ansicpg1252\deff0\deflang1033{\fonttbl<br>{\f0\fnil\fcharset0 Times New Roman;}}
<br>\viewkind4\uc1\pard\f0\fs20 Hello World\par
<br>}
</div></blockquote>

<p>And as generated by MSWord 2000;
</p><blockquote><div>
{\rtf1\ansi\ansicpg1252\uc1 \deff0\deflang1033\deflangfe1033{\fonttbl{\f0\froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f27\froman\fcharset0\fprq2{\*\panose 02040502050405020303}Georgia;}
{\f29\froman\fcharset238\fprq2 Times New Roman CE;}{\f30\froman\fcharset204\fprq2 Times New Roman Cyr;}{\f32\froman\fcharset161\fprq2 Times New Roman Greek;}{\f33\froman\fcharset162\fprq2 Times New Roman Tur;}
{\f34\froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\f35\froman\fcharset178\fprq2 Times New Roman (Arabic);}{\f36\froman\fcharset186\fprq2 Times New Roman Baltic;}{\f245\froman\fcharset238\fprq2 Georgia CE;}
{\f246\froman\fcharset204\fprq2 Georgia Cyr;}{\f248\froman\fcharset161\fprq2 Georgia Greek;}{\f249\froman\fcharset162\fprq2 Georgia Tur;}{\f252\froman\fcharset186\fprq2 Georgia Baltic;}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;
\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\gree<nobr>n<wbr></nobr>  0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\r<nobr>e<wbr></nobr>  d0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\<nobr>b<wbr></nobr>  lue0;
\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}{\sty<nobr>l<wbr></nobr>  esheet{\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f27\fs22\lang1033\langfe1033\cgrid\langnp1033\langfenp1033 \snext0 Normal;}{\*\cs10
\additive Default Paragraph Font;}}{\info{\title Hello World}{\author Sean M. Burke}{\operator Sean M. Burke}{\creatim\yr2002\mo2\dy22\hr21\min26}{\revtim\yr2002\mo2\dy22\hr21\min26}<nobr>{<wbr></nobr>  \version1}{\edmins0}{\nofpages1}{\nofwords0}{\nofchars0}
{\*\company }{\nofcharsws0}{\vern8247}}\widowctrl\ftnbj\aenddoc\noxlattoyen\expshrtn\noultr<nobr>l<wbr></nobr>  spc\dntblnsbdb\nospaceforul\formshade\horzdoc\dgmargin\dghspace180\dgvspace180\<nobr>d<wbr></nobr>  ghorigin1800\dgvorigin1440\dghshow1\dgvshow1
\jexpand\viewkind1\viewscale100\pgbrdrhead\pgbrdrfoot\splytwnine\ftnlytwnine\ht<nobr>m<wbr></nobr>  autsp\nolnhtadjtbl\useltbaln\alntblind\lytcalctblwd\lyttblrtgr\lnbrkrule \fet0\sectd \linex0\endnhere\sectlinegrid360\sectdefaultcl {\*\pnseclvl1
\pnucrm\pnstart1\pnindent720\pnhang{\pntxta<nobr> <wbr></nobr>.}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta<nobr> <wbr></nobr>.}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang{\pntxta<nobr> <wbr></nobr>.}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}{\*\pnseclvl5
\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang
{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain \ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f27\fs22\lang1033\langfe1033\cgrid\langnp1033\langfenp1033 {Hello World

\par }}
</div></blockquote>

<p>Makes ya think, don't it!?</p>



<blockquote>

<h2>Re:RTF</h2>
<h3><a href="/user/ziggy/">ziggy</a> on 2002-02-23T16:57:45</h3>
Have you read the most recent RTF spec?  It reads like Microsoft is saying "this is how <b>you</b> should model your word processor internally, because that's how we did it; furthermore, you should understand how <b>we</b> built word, because that will be a valid expression of RTF.  Oh, and we'll deign to read whatevery you generate, if it somehow matches this specification, but don't expect us to go through hoops..."
<p>
The output that I generated with OpenJade with a 22MB SGML source file produced a 4MB RTF output file +/- a few KB after munging.  After opening that file and repaginating it, the filesize ballooned to over 10MB - a 150% increase in size!</p>



<blockquote>

<h2>Re:RTF</h2>
<h3><a href="/user/TorgoX/">TorgoX</a> on 2002-02-23T17:30:19</h3>
Yes, RTF can have no pretense of being an "open file format".  The only things separating it from<nobr> <wbr></nobr>.doc are 1) that it doesn't convey macros and 2) that Microsoft didn't actively try to make it totally obfuscated and encrypted.





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


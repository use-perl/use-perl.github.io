<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of demerphq: Perl5 Regex Engine Abstracted - Win A Metre of Beer!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Perl5 Regex Engine Abstracted - Win A Metre of Beer!</h1>
<h2><a href="/user/demerphq/">demerphq</a> on 2006-12-03T16:43:11</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>
With patch <a href='http://public.activestate.com/cgi-bin/perlbrowse/29430'>Change  #29430</a> the regex engine should now be sufficiently abstracted that it is reasonably feasable to write a plugin to use a different regex engine in perl. The documentation for most of the interface is contained in the perlreguts module although one needs to understand the flags in the regexp.h in order to make it work.
</p>
<p>
The basic idea is that the existing perl engine and data structures have been ripped in half. The structures which the perl core must interact are now well defined and the parts that are "private" to a given regex engine implementation are now isolated from the core. 
</p>
<p>
A big issue with Perl 5.8 and earlier Perls regex engine pluggability interface was that it was intended mostly for swapping in a DEBUG build of the real engine, with the expectation that any engine in use could cope with the data structures generated by any other engine. Additionally some of the management routines for regexps were harded coded into the core, with the expectation that the core routine could handle any engines data. 
All of these design issues meant that basically you couldnt plug an arbitrary engine into perl. You would have to apply core patches to do even the meanest implementation.
</p>
<p>
In the new scheme what Perl needs to know about a pattern, is defined by the <code>struct regexp</code>. What Perl needs to know about a regex engine is defined by the <code>struct regexp_engine</code>. All a plug in needs to do is create a <code>regexp_engine</code> that contains the appropriate callbacks and populate %^H appropriatly when the module is use()d. Perl will then use the compiler routine specified by the engine to create a <code>regexp</code> struct which it will then use as though it was its own. The <code>regexp</code> structure contains a pointer to the <code>regexp_engine</code> structure which created it, so the regexp is completely encapsulated. You can compile a regexp using one engine and pass it through to a routine expecting a normal regexp and everything would work out.
</p>
<p>
So now all we need to do is get some intrepid hacker to actually put all this to good use and write a plug in for another engine.
</p>
<p>
And you know what?
</p>
<p>
<b>
The first person that publishes a proper regexp engine plug in for BleadPerl (soon to be Perl 5.10) will get a <em>METRE OF BEER</em> for doing so.... 
</b>
<p>
Ill give a bonus prize (to be determined) if the engine ported is the latest TCL engine.   
</p>
<p>
So lets see how long it takes... :-)
</p>
<p><small>Note: I'm going to publish this challenge elsewhere over the next few days. Thanks to AdamK for the idea of the prize.</small></p></p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of iburrell: Reverse proxy mirror</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Reverse proxy mirror</h1>
<h2><a href="/user/iburrell/">iburrell</a> on 2007-06-02T23:57:54</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>Does anybody know of software that could be used to build a mirroring reverse proxy?  I am looking for something to cache and mirror files for distributions and other archives of mostly static files.  

<p>
To clients, it looks like a copy of the archive.  If a file does not exist, or is too old, it is fetched from the master servers and saved to disk.  The files can be populated from CDs or mirrored through rsync to get complete copies.  Ideally, it would load balance from multiple mirror servers.

<p>
It is possible to set something up with Apache2, mod_proxy, and mod_disk_cache but that does not allow load balancing between servers and stores files in an opaque cache.

<p>
Would Perlbal be usable for this?  Could it be extended?  I think a mod_perl module could be written.
</p>


<hr/>



<h2>Apache+squid</h2>
<h3><a href="/user/Juerd/">Juerd</a> on 2007-06-03T16:17:25</h3>
Just use Apache with Squid (or another balanceable proxy). mod_proxy's ProxyRemote directive lets you pick another proxy to use, and Squid can be load balanced quite well.



<blockquote>

<h2>Re:Apache+squid</h2>
<h3><a href="/user/iburrell/">iburrell</a> on 2007-06-04T01:22:28</h3>
Can Squid store the files on disk in a structure that mirrors the master servers?  Part of what I am looking for is a way to preload the cache with files from the CD or DVD.  I also want to be able to sync parts of the mirror with rsync or wget.



<blockquote>

<h2>Re:Apache+squid</h2>
<h3><a href="/user/Juerd/">Juerd</a> on 2007-06-04T08:18:26</h3>
Why would you worry about the storage structure? As long as everything appears to be the same through http, does the physical layout on disk matter?<br><br>No, Squid won't use a similar structure, but you can preload anyway, by just requesting the relevant URIs.<br><br>If you're not loading from a normal internet site, though, you may have to set up a tiny http server for this purpose yourself. Or perhaps another proxy<nobr> <wbr></nobr>:)



<blockquote>

<h2>Re:Apache+squid</h2>
<h3><a href="/user/Aristotle/">Aristotle</a> on 2007-06-04T10:30:32</h3>
<p>Not really. Squid&#8217;s directory structure doesn&#8217;t look like what it has cached, but it&#8217;s pretty easy to hack some Perl to bulk-feed a directory structure plus given base URI into the Squid cache dirs.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


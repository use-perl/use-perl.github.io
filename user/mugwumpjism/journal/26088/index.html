<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of mugwumpjism: Dude, WTF?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Dude, WTF?</h1>
<h2><a href="/user/mugwumpjism/">mugwumpjism</a> on 2005-08-04T13:28:25</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><pre>watts:/home/samv# vserver-stat 
CTX   PROC    VSZ    RSS  userTIME   sysTIME    UPTIME NAME
0       41  64.4M   5.2K  11m06s90   9m21s19   1d37h44 root server
49153    2     5M   459    0m01s34   0m02s25   1d37h42 bind
49155    8  31.9M   2.2K   0m00s16   0m01s61   1d37h42 www
49156    2   4.5M   237    0m00s00   0m00s10   1d37h42 ns
49157    1   1.7M    56    0m00s00   0m00s20   1d37h42 squid
49159   32 288.7M  31.6K  11m53s64   0m45s71   9h16m02 mail
49160   34 764.2M    14K   7m03s93   1m52s74   9h04m22 longdrop
49163   19 119.3M    10K   1m03s11   0m19s54   8h12m52 juan
watts:/home/samv# </pre>

<p>No, Seriously, WTF?

<pre>top - 00:57:49 up 1 day, 13:45,  1 user,  load average: 0.11, 0.05, 0.01
Tasks: 137 total,   1 running, 136 sleeping,   0 stopped,   0 zombie
Cpu(s):  1.1% us,  1.1% sy,  0.0% ni, 97.7% id,  0.0% wa,  0.0% hi,  0.0% si
Mem:    190500k total,   186584k used,     3916k free,     5068k buffers
Swap:   987988k total,   125584k used,   862404k free,    42676k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND           
 8244 #1004     11   0 29684  20m 2292 S  0.0 10.9   0:06.64 spamd             
 8243 #1004     11   0 29516  20m 2292 S  0.0 10.8   0:07.07 spamd             
 8245 #1004     11   0 29464  20m 2268 S  0.0 10.8   0:05.80 spamd             
 8246 #1004     11   0 29296  19m 2280 S  0.0 10.7   0:06.95 spamd             
 8247 #1004     11   0 29456  19m 2284 S  0.0 10.7   0:07.37 spamd             
16249 samv      10   0 36440  12m 6152 S  0.0  6.7   1:04.04 pugs              
10318 stevew    11   0 12616 7972 1676 S  0.0  4.2   0:04.89 python            
10320 stevew    11   0  8620 4648 1760 S  0.0  2.4   0:53.49 python            
 8072 #1004     13   0 27416 4340 1344 S  0.0  2.3   0:02.61 spamd             
 8069 #104      11   0 10328 4328 2048 S  0.0  2.3   0:01.08 postgrey          
10321 stevew    11   0  8052 3736 1592 S  0.0  2.0   0:02.96 python            
</pre>

<p>Well, I guess it's all normal on the internet.  Spam, spam and more spam.

<p>But seriously, WTF?

<pre>watts:/home/samv# vserver longdrop exec killall apache2
watts:/home/samv# vserver-stat 
CTX   PROC    VSZ    RSS  userTIME   sysTIME    UPTIME NAME
0       41  64.6M   5.2K  11m09s00   9m23s22   1d37h51 root server
49153    2     5M   457    0m01s36   0m02s26   1d37h50 bind
49155    8  31.9M   2.2K   0m00s16   0m01s61   1d37h50 www
49156    2   4.5M   237    0m00s00   0m00s10   1d37h50 ns
49157    1   1.7M    56    0m00s00   0m00s20   1d37h50 squid
49159   40 319.8M  35.2K  13m02s34   0m47s73   9h23m56 mail
49160   26 283.1M  11.1K   7m10s35   1m53s86   9h12m16 longdrop
49163   19 119.3M   9.5K   1m04s85   0m20s12   8h20m46 juan
watts:/home/samv# </pre>

<p>What's left in longdrop includes svnserve, postgres, mysql, screen, sshd, irssi and pugs.  As well as all the regulars, like syslogd, cron, et al.

<p>Dropping Apache changed it to this:

<pre>top - 01:10:26 up 1 day, 13:58,  1 user,  load average: 0.00, 0.08, 0.09
Tasks: 136 total,   1 running, 135 sleeping,   0 stopped,   0 zombie
Cpu(s):  1.0% us,  0.3% sy,  0.0% ni, 98.3% id,  0.3% wa,  0.0% hi,  0.0% si
Mem:    190500k total,   183008k used,     7492k free,    10616k buffers
Swap:   987988k total,   126516k used,   861472k free,    35856k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND           
 8246 #1004     11   0 29528  20m 2348 S  0.0 11.0   0:07.91 spamd             
 8244 #1004     11   0 29652  20m 2292 S  0.0 10.9   0:07.24 spamd             
 8243 #1004     11   0 29516  19m 2292 S  0.0 10.6   0:07.07 spamd             
 8245 #1004     11   0 29464  19m 2268 S  0.0 10.5   0:05.80 spamd             
 8247 #1004     11   0 29456  19m 2284 S  0.0 10.4   0:07.37 spamd             
16249 samv      10   0 36440  11m 6024 S  0.0  6.4   1:05.16 pugs              
10318 stevew    11   0 12616 6840 1672 S  0.0  3.6   0:04.90 python            
10320 stevew    11   0  8620 4644 1760 S  0.0  2.4   0:55.45 python            
 8072 #1004     13   0 27416 4328 1344 S  0.0  2.3   0:02.61 spamd             
 8069 #104      11   0 10328 4308 2044 S  0.0  2.3   0:01.11 postgrey         </pre>

<p>Aha!  No less memory consumed!  So, apache2 isn't so bad, after all.  It's just mapped every single bloody library on my system into one mammoth process.

<p>A good thing that this server is using <a href="www.linux-vserver.org">Linux-Vserver</a> for its virtual servers.  Just imagine how much memory aboched2 and Xen could use if that memory wasn't allowed to be shared between servers..</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


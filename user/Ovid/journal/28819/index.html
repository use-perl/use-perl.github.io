<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of Ovid: Test::SQL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Test::SQL</h1>
<h2><a href="/user/Ovid/">Ovid</a> on 2006-02-28T00:19:06</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>I'm not proposing to write a <tt>Test::SQL</tt> module, but I am tired of having the following two things not being equivalent:</p>

<pre>CREATE TABLE foo (
  id INTEGER NOT NULL PRIMARY KEY,
  name VARCHAR(32) NOT NULL,
  age INTEGER
);</pre>

<p>And:</p>

<pre>create table foo (
  id INTEGER       NOT NULL PRIMARY KEY,
  name VARCHAR(32) NOT NULL,
  age integer
);</pre>

<p>Those are functionally equivalent but there are a few potential problems with testing it.  I can get a reasonably easy to debug test if I do the following:</p>

<ul>
  <li>Collapse all <em>unquoted</em> whitespace to a single space.</li>
  <li>Preserve newlines (so that <a href="http://search.cpan.org/dist/Test-Differences/">Test::Differences</a> will still be meaningful)</li>
  <li>Lower-case all <em>unquoted</em> characters.</li>
</ul>

<p>I can use <a href="http://search.cpan.org/dist/Data-Record/">Data::Record</a> to easily split the string on spaces without affecting quoted characters:</p>

<pre>use Regexp::Common;
use Data::Record;
my $record = Data::Record->new({
    split  => qr/\s\t/,
    unless => $RE{quoted},
});
my $data = join ' ', map { lc $_ } $record->records($data);</pre>

<p>That doesn't seem flexible enough, though.  It would be useful to wrap this in a test module whereby one can control whether or not one wants to alter the case, ignore quoted data, preseve newlines, and so on.  I could make a plethora of test functions, but the number of possible combinations would make them unweildy.  I could have the user set the parameters at the top of the test and change the parameters as needed.  This would make this far more flexible than simply an SQL tester.  Thoughts?</p>

<p>I'm thinking a name like <tt>Test::ControlWhitespace</tt>.</p></p>


<hr/>



<h2>What about comparing Parse Trees??</h2>
<h3><a href="/user/Stevan/">Stevan</a> on 2006-02-28T03:33:23</h3>
<p>
Functional equivalence could probably be determined by parsing the different SQL then analyzing the two parsed structures using various heuristics.
</p>
<p>
I use a similar technigue with <a href="http://search.cpan.org/user/stevan/Test-PDF" title="cpan.org">Test::PDF</a cpan.org> to do a basic test for "visual" similarity, by using Test::Deep to compare the data-structures CAM::PDF produces after it parses the PDF file.
</p>
<p>
Just a thought<nobr> <wbr></nobr>:)
</p>
<p>
- Stevan
</p>



<blockquote>

<h2>Re:What about comparing Parse Trees??</h2>
<h3><a href="/user/jdavidb/">jdavidb</a> on 2006-02-28T23:05:17</h3>
<p>Maybe one of the deep-structure equivalence testing methods could be called after parsing both with SQL::Statement.</p>



<blockquote>

<h2>Re:What about comparing Parse Trees??</h2>
<h3><a href="/user/Ovid/">Ovid</a> on 2006-02-28T23:25:48</h3>
<p> <tt>SQL::Statement</tt> won't work for me due to the sheer complexity of much of our autogenerated SQL.  For example, it won't handle case statements.  There are a number of other constructs it won't handle, so while I'd like to have a specific parser for this problem domain, I would like a more general solution for where parsers are not available.</p>





</blockquote>

</blockquote>


<h2>Title?</h2>
<h3><a href="/user/jplindstrom/">jplindstrom</a> on 2006-02-28T15:01:15</h3>
That "title" thing in the first chunk, is that a typo or some weird SQL dialect I don't know?



<blockquote>

<h2>Re:Title?</h2>
<h3><a href="/user/Ovid/">Ovid</a> on 2006-02-28T17:01:00</h3>
<p>Oops.  Typo.  I'll edit that out, thanks.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


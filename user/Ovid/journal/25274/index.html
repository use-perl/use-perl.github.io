<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of Ovid: Writing a pre-processor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Writing a pre-processor</h1>
<h2><a href="/user/Ovid/">Ovid</a> on 2005-06-19T20:01:51</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>It's very unusual, but my macro system for Prolog is a Prolog preprocessor written in Perl for <a href="http://search.cpan.org/dist/AI-Prolog/">AI::Prolog</a>.  Basically, whenever a Prolog snippet is passed to <tt>AI::Prolog</tt>, the preprocessor will search for unusual syntactical bits (such as math) and rewrite them in an internal form which the current parser already understands.  In other words, as mentioned earlier, it's a source filter for a language embedded in Perl.</p>

<p>I'm am just getting the barest glimmering of an idea of what happens when someone really implements a language.  I'm already up to about 86 tests just for the pre-processor and there's a long way to go.  Part of what makes this fascinating is my realization, after a typo led to an unexpected success, that I needed far better test coverage on this than I normally do.  And I don't just mean "test every line of code."  Using a regex once counts as code coverage for that line.  It hardly counts as coverage for the regex.  I'm having to really think hard to come up with reasonable counter-examples without providing the infinite number of negatives that each regex can have.</p>

<p>Currently the full regex comes to 88 lines when printed out.</p></p>


<hr/>



<h2>branch coverage for a regex</h2>
<h3><a href="/user/merlyn/">merlyn</a> on 2005-06-19T22:17:37</h3>
Now that'd be an interesting idea.  Using the regex modules in the CPAN, pull apart a regex, and insert tracing steps as code blocks into it, to make sure your tests shook out all the braches.  Devel::Regex::Cover, anyone?





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


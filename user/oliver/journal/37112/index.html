<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of oliver: DBIx::Class, Catalyst, CRUD, AJAX (and other buzzwords)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>DBIx::Class, Catalyst, CRUD, AJAX (and other buzzwords)</h1>
<h2><a href="/user/oliver/">oliver</a> on 2008-08-06T17:01:30</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>I teach a Perl course about once a year for folks in my organization, and one question the students always ask is, "<em>I need a quick and simple web interface to this database we have, what should I use?</em>" And there was no answer (until now, I suppose).</p>

<p>Okay, there are a few things which do a similar job in Perl; a couple of abandonware Catalyst applications, or frameworks which require you to write templates, but what I mean is the whole shebang - Database to ORM to Templates to Web Page, all from one installation. Closest thing I know of is <a href="http://search.cpan.org/perldoc?Rose::DBx::Garden::Catalyst">Rose::DBx::Garden::Catalyst</a>, but even that seemed to require too much effort for a lazybones like me.</p>

<p>So about a year ago a chap called Andy Payne who was working at Dragonstaff produced the ListBuilder, a framework using <a href="http://search.cpan.org/perldoc?Catalyst::Manual">Catalyst</a>, <a href="http://search.cpan.org/perldoc?DBIx::Class">DBIx::Class</a>, <a href="http://search.cpan.org/perldoc?Template::Toolkit">Template::Toolkit</a>, and the <a href="http://extjs.com/products/extjs/">ExtJS Javascript library</a> to churn out nice looking functionable CRUD interfaces to database tables. I spent a fun evening hacking with it <a href="http://mail.pm.org/pipermail/miltonkeynes-pm/2008-February/000397.html">'til around 3 in the morning</a>.</p>

<p>My eyes were opened to the real possibility, that the whole interface should be generated from information which DBIx::Class already knows; there's no need for us to be explaining things twice. I booked a few days off work and we now have <a href="http://search.cpan.org/perldoc?CatalystX::ListFramework::Builder">CatalystX::ListFramework::Builder</a> (LFB).</p>

<p>LFB needs only a few lines of configuration (database connection parameters), and then also needs you to have DBIx::Class schema classes available which describe your database, but those can be automagically generated by the excellent <a href="http://search.cpan.org/perldoc?DBIx::Class::Schema::Loader">DBIx::Class::Schema::Loader</a> module.</p>

<p>Out the other end of the sausage machine comes a Javascript-rich list-based, paged view of a database table, supporting search, delete, create and edit. LFB handles one-to-one and one-to-many relations, showing related data and allowing creation and linking of related rows when editing.</p>

<p>If you like the look of the module and want to know something, please do drop me a line; equally if there's a missing feature you desperately need we can probably arrange to have you buy some of my time. In the rest of this article I'll explain a little about how LFB works.</p>

<p>Your complete Catalyst application looks like this:</p>

<p>
<pre>
package ListFrameworkUser;
use Catalyst qw(ConfigLoader +CatalystX::ListFramework::Builder);

__PACKAGE__->setup;
1;
</pre>
</p>

<p>You can take my word for it that the config really is trivial (an example is on the CPAN documentation page), with just database connection parameters and a URL path for the Javascript library. The base class used creates a Catalyst application on the fly in your application's namespace (ListFrameworkBuilder, here) which has all the Models, Views and Controllers needed to run LFB. It does this using a mixture of package-scoped eval(), %INC injection, and overriding a little of Catalyst's core (setup_components in particular, because of eval() vs. Module::Pluggable timing issues).</p>

<p>Once that is done, a begin() handler in Catalyst instructs a Model to introspect DBIx::Class for all the table, column, data type and relation information which it pops into the Catalyst application stash. This is used by Template::Toolkit templates to customize a truck-load of ExtJS Javascript which is sent to the browser as the main page, and which in turn draws the list-based table view.</p>

<p>From that, everything notches up a gear into Web 2.0 land, as the user interface conducts its business over JSON-based AJAX. As mentioned above, you can add, delete, edit and search for records in the paged list-based view, and there are a few more bells and whistles besides that.</p>

<p>What are the current limitations? Well, I have coded along the 80/20 principle so there are some missing features, and some parts are inefficient. For example only single column primary keys are supported, although perhaps this will be improved in the future. Also, I didn't want you to have to install much more besides LFB itself and the ExtJS 2.1 library, so a small number of static <a href="http://www.famfamfam.com/lab/icons/silk/">PNG icons</a> are served from LFB rather than your web server. These are reasonable compromises given the aim of LFB which is to be a near-zero-conf quick-install web GUI for (probably) your legacy databases.</p>

<p>We're up to release 0.15 as I write this, and most of the recent work has been refactoring, and there is still a long way to go. Certainly, some of the logic used for creating related rows and so on in the database is sub-optimal (but it does support forward and reverse relations - belongs_to, might_have, has_one and has_many, in DBIx::Class parlance). Don't be too critical, but feedback and ideas (and hey, if you like it, some praise!) would be appreciated. I'm already working with a handful of early adopters to refine the UI.</p>

<p>Oh, and last but not least... you want to see a running demo of the system? Well as a reward for reading this whole article try <a href="http://dragonstaff.co.uk/oliverg/album">this simple Albums application</a>, at least until the use.perl.org effect brings down my friend Peter's little VM host :-)</p>





</p>


<hr/>



<h2>MVC Marathon</h2>
<h3><a href="/user/jk2addict/">jk2addict</a> on 2008-08-06T19:29:57</h3>
<p>Dude! I just got done with the latest step of the MVC Marathon project: build a control to list results and CRUD. I was totally bummed out that Cat/DBIC had nothing like rails or cakephp or django.</p><p>CatalystX::CRUD is mostly RDBO unless you write a forms processer, and Enzyme is all CDBI.</p><p>I'm soooooo happy to see this post. I never looked at ListFramework because, well, it doesn't sound like CRUD at all. "List"?</p><p>I'll be getting this up and running tonight and working it into the next MVC post.</p>



<blockquote>

<h2>Re:MVC Marathon</h2>
<h3><a href="/user/jk2addict/">jk2addict</a> on 2008-08-07T02:30:35</h3>
<p>Ok, It's not what I thought it was.<nobr> <wbr></nobr>:-/</p><p>Is there any way to map this magic to an url, like<nobr> <wbr></nobr>/admin/? Also, when I tried using the latest Cat that now uses<nobr> <wbr></nobr>.conf instead of<nobr> <wbr></nobr>.yml, it dies about not seeing schema_class, even though I'm pointing it to the sample<nobr> <wbr></nobr>.yml file. After puttin the config in<nobr> <wbr></nobr>.conf, it then dies about not finding any templates.</p><p>I looked at just the ListFramework, but even that seems to need a fair amount of coding to get working...at in my situation which is comparing what rails/cake/django have out of the box.</p>



<blockquote>

<h2>Re:MVC Marathon</h2>
<h3><a href="/user/oliver/">oliver</a> on 2008-08-07T07:48:03</h3>
Hi,<p>

Firstly, thanks for posting a comment<nobr> <wbr></nobr>:-) It might be better to take this support stuff off use.perl.org and onto the CPAN forum, if you like.</p><p><div class="quote"><p>Ok, It's not what I thought it was.<nobr> <wbr></nobr>:-/</p></div><p>Did you look at the demo app? I'd be interested to know what you _did_ think it'd be, as that might offer up some cool feature(s) for the future.</p><p><div class="quote"><p>Is there any way to map this magic to an url, like<nobr> <wbr></nobr>/admin/?</p></div><p>Again, I think the demo app linked in the post shows what the URLs look like. You can use Firebug to see the AJAX calls.</p><p><div class="quote"><p>when I tried using the latest Cat that now uses<nobr> <wbr></nobr>.conf instead of<nobr> <wbr></nobr>.yml</p></div><p>Not sure what you're referring to here - might be best to send me an email with a link to the docs ref so I can better understand.</p><p>

Once again, many thanks for the feedback,</p><p>

olly.</p>



<blockquote>

<h2>Re:MVC Marathon</h2>
<h3><a href="/user/jk2addict/">jk2addict</a> on 2008-08-07T11:43:44</h3>
<p>Yes, I looked at the demo app. It appears from the docs/code/demo that this is a complete app that does only CRUD.</p><p>What's I'm interested in is bolting on CRUD to an existing app that already has DBIC models, and ideally, that would put all of it's stuff under an<nobr> <wbr></nobr>/admin/ location, while the rest of the app runs  in<nobr> <wbr></nobr>/.</p><p>Are you in #catalyst@irc.perl.org?</p>



<blockquote>

<h2>Re:MVC Marathon</h2>
<h3><a href="/user/oliver/">oliver</a> on 2008-08-07T12:52:51</h3>
Okay, good suggestions, I'll see you on IRC then to talk about this further (my nick is 'oliver')





</blockquote>

</blockquote>


<h2>Re:MVC Marathon</h2>
<h3><a href="/user/oliver/">oliver</a> on 2008-08-07T12:51:46</h3>
<p><div class="quote"><p>when I tried using the latest Cat that now uses<nobr> <wbr></nobr>.conf instead of<nobr> <wbr></nobr>.yml, it dies about not seeing schema_class</p></div><p>I found the error causing this - the interface to one of the Catalyst plugins has changed. I've just uploaded version 0.16 of LFB to the CPAN with a fix.</p>





</blockquote>

</blockquote>


<h2>Re:</h2>
<h3><a href="/user/peterdragon/">peterdragon</a> on 2008-08-08T09:36:40</h3>
Heh, nice one Oliver. My VPS is still up<nobr> <wbr></nobr>:)
<p>

Best,<br>
-Peter
</p><p>
<a href="http://perl.dragonstaff.co.uk/" title="dragonstaff.co.uk">http://perl.dragonstaff.co.uk</a dragonstaff.co.uk></p>



<h2>gantry</h2>
<h3><a href="/user/trwww/">trwww</a> on 2008-08-22T00:28:46</h3>
<blockquote><div><p> <i>I teach a Perl course about once a year for folks in my organization, and one question the students always ask is, "I need a quick and simple web interface to this database we have, what should I use?" And there was no answer.</i></p></div> </blockquote><p>Gantry has been able to do this for a while now:</p><p> <a href="http://www.onlamp.com/pub/a/onlamp/2007/06/14/a-holiday-gantry-web-application.html" title="onlamp.com">A Holiday Gantry Web Application</a onlamp.com> </p><p>trwww</p>



<blockquote>

<h2>Re:gantry</h2>
<h3><a href="/user/oliver/">oliver</a> on 2008-08-25T08:01:04</h3>
<p>Yes there are a few other equivalent systems, as I mentioned in the article (the Rose Garden one, in particular, I was familiar with). I must confess to being unaware of Gantry.</p><p>What's interesting, and this is just typical of the Perl community's way of doing things, is that one module inspires use of another.</p><p>For example people want a CRUD-ish system like this, but are put off by the size and power of the Rose Garden, or Gantry. then they install my LFB, and are happy for a while. Then they want to customize it in some way which isn't supported, so they migrate off to these other systems such as your own.</p><p>This is a good way of doing things - one small tool which does one thing well, and larger systems which fulfill other needs, but no less well. I've already had people get this far with LFB and been pointing them at these alternatives.</p><p>thanks for the feedback,<br>
olly.</p>





</blockquote>


<h2>InstantCRUD</h2>
<h3><a href="/user/zby/">zby</a> on 2008-09-20T09:24:12</h3>
InstantCRUD is another scaffolding package (just like Gantry above).  It is now very outdated - but I have a new version of it and I am just waiting for a new release of DBIC (since unfortunately the more advanced features rely on some bug fixes).  I try to make it lightweight - by offloading the work to more general purpose libraries.  There is now really a multitude of CRUD packages - do you see any possibility to collaborate?  Maybe by establishing some interfaces?  Using common base modules?  One thing that I've developed for Instant is a ResultSet base class that makes it much easier to edit a structure build of many records in one form - this is something quite universal that should be usable in many other framework - what do you think?



<blockquote>

<h2>Re:InstantCRUD</h2>
<h3><a href="/user/oliver/">oliver</a> on 2008-09-20T12:34:54</h3>
I think this is a great suggestion!<p>

Most of my effort on this module has been on the intelligence in the user interface, so the guts are certainly not very pretty nor elegant. But they work.</p><p>

At some point it will need refactoring, and there are a few good candidates for generic components. For example Metadata.pm which (heavily) introspects the DBIx::Class schema, and also AJAX.pm which parses web forms and performs DBIx::Class insert/updates. If these two were factored out and had standardized output/input data structures (respectively), it would be great.</p>



<blockquote>

<h2>Re:InstantCRUD</h2>
<h3><a href="/user/zby/">zby</a> on 2008-09-23T14:19:11</h3>
Ping me when you start your refactoring ( zzbbyy *at* gmail ).





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of jk2addict: For the love of all that is holy...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>For the love of all that is holy...</h1>
<h2><a href="/user/jk2addict/">jk2addict</a> on 2007-11-01T02:49:53</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>Please fracking make this go away.<br/><br/><code>t/storage_validate_data...................Called UNIVERSAL::can() as a function, not a method at C:/strawberry-perl/perl/site
/lib/DateTime/Locale.pm line 313</code><br/><br/>I don't care who's fault it is, but it isn't mine. Now stop pissing in my pool just because I'm mock testing and UNIVERSAL::JAMMYRELIGIONINYOURFACE is loaded.<br/><br/>That is all.<br/><br/>
/rant mode=off</p>


<hr/>



<h2>What that is...</h2>
<h3><a href="/user/Alias/">Alias</a> on 2007-11-01T03:52:08</h3>
That is a warning message generated by Test::MockObject (chromatic) about DateTime::Locale because when things fail weirdly, chromatic was sick of receiving bogus error reports and complaints about Test::MockObject when it was really the fault of the person using UNIVERSAL::can/isa as a function (which they shouldn't be).<br><br>DateTime::Locale needs to call stuff as a method, not a function.



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2007-11-01T04:30:02</h3>
<p>All too true, but given the lack of willingness of some CPAN authors to fix bugs in their modules, I plan to release new versions of UNIVERSAL::isa and UNIVERSAL::can which only give those warnings for code that calls them for modules which use both modules directly.</p>

<p>I should have time to work on that this weekend.</p>



<h2>Re:What that is...</h2>
<h3><a href="/user/autarch/">autarch</a> on 2007-11-01T05:05:02</h3>
Err, take a look at that line:<p><blockquote> <div><tt>unless ( $real_class-&gt;can('new') )</tt></div> </blockquote> What exactly is wrong with that?



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2007-11-01T05:29:37</h3>
<p>If you can trigger that false positive in a test case, I'll add it to the U::c/U::i suite and fix it.</p>



<h2>Re:What that is...</h2>
<h3><a href="/user/jrockway/">jrockway</a> on 2007-11-01T15:02:25</h3>
<tt>A shot in the dark, but is $real_class loaded when you make that call?<br><br>Compare:<br><br>$ foo-&gt;isa('UNIVERSAL') and print "yes\n"<br>&lt;nothing&gt;<br><br>to<br><br>$ package foo;<br>$ foo-&gt;isa('UNIVERSAL') and print "yes\n"<br>yes<br><br>I think U::can might get upset in this case... but who knows.<br><br>Another possibility... didn't that line use can as a function in an older version of the module?&nbsp; I can't get the warning to happen with the latest DateTime::Locale, but I could about a year ago. </tt>



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/jrockway/">jrockway</a> on 2007-11-01T15:06:04</h3>
<tt>Sorry, an addendum:<br><br>$ use UNIVERSAL::can;<br>$ UNIVERSAL-&gt;can('can') and print "can can\n";<br>can can<br>$ FOOBAR-&gt;can('can') or print "cannot can\n";<br>Called UNIVERSAL::can() as a function, not a method at (eval 59) line 5<br>cannot can<br>$ package FOOBAR;<br>$ FOOBAR-&gt;can('can') and print "now can can\n";<br>now can can<br><br></tt>



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/autarch/">autarch</a> on 2007-11-01T15:26:34</h3>
Yep, that's the issue. In fact, the use of <code>can</code> is a way to check if the module has been loaded. It's quicker than blindly using <code>require</code> in every case, I think.



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/chromatic/">chromatic</a> on 2007-11-01T17:31:05</h3>
<p>That's the problem then.  Your heuristic for testing if a class exists fights with my heuristic for testing if a class exists.  I suppose U::i/U::c could skim through the optree for a <code>method</code> or <code>method_named</code> opcode, but that's a lot more work.</p>



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/autarch/">autarch</a> on 2007-11-01T20:03:44</h3>
Well, I think the problem is yours, since clearly I'm using UNIVERSAL::can as a method there, not a function, but your module is reporting that I'm using it as a function anyway.<br>



<h2>Re:What that is...</h2>
<h3><a href="/user/btilly/">btilly</a> on 2007-11-02T02:38:41</h3>
I cannot reproduce the behavior on perl 5.8.6.  But based on the description, there is a simpler solution.  See whether the package can was called for is in the package tree.  If it is not, then don't warn.<br><br>In fact you already <b>have</b> the necessary logic in UNIVERSAL::can to figure out whether the package is in the symbol table.  Therefore the following patch looks like it should fix the problem:<br><br><code><br>---<nobr> <wbr></nobr>/usr/lib/perl5/site_perl/5.8.6/UNIVERSAL/can.pm     2006-03-31 22:15:10.000000000 -0800<br>+++ can.pm      2007-11-01 19:28:29.000000000 -0700<br>@@ -51,7 +51,6 @@<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # make sure the invocant is useful<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unless ( _is_invocant( $_[0] ) )<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>-               _report_warning();<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto &amp;$orig;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br></code>



<blockquote>

<h2>Re:What that is...</h2>
<h3><a href="/user/btilly/">btilly</a> on 2007-11-02T14:08:14</h3>
D'oh.  Just use warnings and I can reproduce the behaviour.  And yes, my patch fixed it.





</blockquote>

</blockquote>


<h2>That smells like a really bad idea</h2>
<h3><a href="/user/btilly/">btilly</a> on 2007-11-02T14:06:04</h3>
You are relying on undocumented internal behaviour.  At the very least <i>I</i> can find no documentation that a class that has not been fully defined yet does not have the methods that all classes should have.  In fact I would <b>prefer</b> it if Perl had the opposite behaviour.  What will you do if that behaviour changes someday?<br><br>Furthermore pity the poor programmer who has to figure out your code.  Do you always put comments on your uses of that idiom?  If not, then will it make sense to someone else that you're checking whether something can can when it should always be able to can?  It wouldn't to me!<br><br>It is far safer to write a function to do your test.  That function can either check %INC directly or can walk the symbol table.  (Walking the symbol table is closer to what calling the can method is.)  Then you can just write is_loaded("class") and your code is more self-documenting, and is less likely to break in a future version of Perl.



<blockquote>

<h2>Re:That smells like a really bad idea</h2>
<h3><a href="/user/btilly/">btilly</a> on 2007-11-02T14:10:16</h3>
D'oh!  You aren't relying on undocumented internal behaviour.  You're checking for whether the class can call new, not whether it can call can!<br><br>I'll just go hide in a corner then.





</blockquote>

</blockquote>

</blockquote>


<h2>Re:What that is...</h2>
<h3><a href="/user/jk2addict/">jk2addict</a> on 2007-11-01T15:19:13</h3>
I had the same thought, so I updated my DateTime/DateTime::Locale to the latest before my rant...on my strawberry perl install and on my Ubuntu/OSX installs which are quite recent.





</blockquote>

</blockquote>


<h2>Re:What that is...</h2>
<h3><a href="/user/jk2addict/">jk2addict</a> on 2007-11-01T13:05:49</h3>
Which it does [as a method] according to the code. And let me be clear, this isn't/wasn't meant as a personal attack on the module authors directly. It's just that I've stared at that warning for two years worth of Handel tests, and I finally cracked.<nobr> <wbr></nobr>:-)



<blockquote>

<h2>UTS, L</h2>
<h3><a href="/user/grinder/">grinder</a> on 2007-11-01T16:57:04</h3>
<p>Heh, we had the same long-time issues on a local box, and as we deemed it to be SEP, we commented out the warning message. The world has come to an end, so far<nobr> <wbr></nobr>:)</p>



<blockquote>

<h2>Re:UTS, L</h2>
<h3><a href="/user/grinder/">grinder</a> on 2007-11-01T16:59:23</h3>
<p>err, <i>not</i> come to an end, of course. (jeez I wish this software would let us edit comments -- that's the second time in a week).</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of Abigail: 1kb to spare.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>1kb to spare.</h1>
<h2><a href="/user/Abigail/">Abigail</a> on 2006-01-06T15:27:39</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>One of the things I've done in my current (almost finished) gig is creating a linux distro for a small device. Require: the entire distro needs to be installed from a floppy disk.
<p>
So I had about 42kb of free space on my 1680kb floppy disk when I got this feature request yesterday. Whether I could fit in a 'real' ps, instead of busybox's ps. Right. A real ps, with just 42 kb to spare.
<p>
In order to save space, all binaries (except for the kernel) on the distro have been compiled using uClibc, which is very nice gcc front end to produce really small, statically linked, binaries.  As part of the make process of the distribution, any tool that isn't found on our (quite bare) RedHat servers is compiled as well. Including uClibc.
<p>
So, I set off to compile ps with uClibc. No go. It needs a compiler configured for wide chars. I configure uClibc so it can deal with wide chars. ps compiles, and seems to work! Now, will it all fit on the floppy disk? I no longer need ps in busybox, so I kick out the module and attempt to create a floppy disk. It's too big! Not a lot - I can fit the compressed initrd on the floppy disk, but not two additional, small files. 
<p>
I notice that the other binaries are slightly larger than they used to be. Must be because they now have wide char support compiled in. Aha! What if I create two compilers - one with wide char support to compile 'ps', and the other without wide char support for the rest? A bit of Makefile hacking, and I end with a floppy disk with 1 or 2 kb to spare (the amount of kb to spare fluctuates from build to build - there's a compressed file system on the floppy and filesystems contain timestamps. And if they are just right, they compress better...).
<p>
That's going to be last feature added.</p>


<hr/>



<h2>just getting started</h2>
<h3><a href="/user/lachoy/">lachoy</a> on 2006-01-06T16:02:49</h3>
I'm just getting started with this as well but being lazy and impatient took a shortcut and grabbed one of the <a href="http://gumstix.com/" title="gumstix.com">Gumstix</a gumstix.com> devices. (It probably has more space than your device as it's got busybox + a number of bluetooth utils, boa web server and a few other goodies.) Even a complete newbie like me got it up and running, which was nice, and their buildroot setup <b>seems</b> pretty straightforward, but I haven't tried it out yet.



<blockquote>

<h2>Re:just getting started</h2>
<h3><a href="/user/Abigail/">Abigail</a> on 2006-01-06T17:22:22</h3>
The hardware already exists - it has been rolled out since 1996. Although some pieces of equipment have more, I have to consider many have no more than 16Mb of RAM, and 25Mb of disk space - of which the application that runs on it needs 16 Mb. And there has to be space to save core files.
<p>
Luckely, I wil be gone when the most of them will get my distro. Their floppy disks haven't been used since they were first installed.</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


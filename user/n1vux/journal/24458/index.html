<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of n1vux: TDD and Unit Testing with Mock Objects ... in Java (vs Perl)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>TDD and Unit Testing with Mock Objects ... in Java (vs Perl)</h1>
<h2><a href="/user/n1vux/">n1vux</a> on 2005-04-29T23:54:14</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><P>I was in all day training today, a 1-day quick-step run-through of 2-day course on <A 
href="http://www.agitar.com">Agitar</A> <A 
href="http://www.agitar.com/products/">Agitator</A>, a <A 
href="http://c2.com/cgi/wiki?UnitTest">unit-test</A>ing <A 
href="http://c2.com/cgi/wiki?EclipseEditor">Eclipse</A> 
plugin, for testing Java, that does semi-automated unit-testing and also 
does&nbsp;bulk-build unit-test regressions and house-style-checking and 
code-coverage&nbsp;etc, and can even do daily SIT regressions.  
(Not 
much Perl to be had, but interesting none the less. It gave me a better feeling 
for hard-core fine-grained unit-test design as the Agile/Java/TDD purists intend 
it to be than I'd had from the <A 
href="http://www.Perl.com">Perl.com</A>&nbsp;<A 
href="http://www.perl.com/pub/a/2005/04/07/mockobject_kata.html">Kata</A>    
   articles.)</P><br/><br/><P>If I <EM>wanted</EM> to do <A 
href="http://java.sun.com/">Java</A> <EM>development</EM>, this would rock. As 
something to have both our developers and our Build system execute, it looks very promising. 
</P><br/><br/><P><A href="http://www.agitar.com/products/">Agitator</A> makes 
<EM>nearly-pure</EM>&nbsp;<A 
href="http://www.testdriven.com/modules/news/">TDD</A>&nbsp; practical in Java. 
<BR>(Or if you prefer&nbsp;<A 
href="http://www.chiasmus.com/">chiasmatically</A>:&nbsp;It makes <EM>pure 
</EM><STRONG>T</STRONG>est <STRONG>D</STRONG>riven <STRONG>D</STRONG>evelopment 
<EM>nearly </EM>practical in Java.)<BR>To do <EM>nearly</EM>-TDD with Agitator, 
you have to <EM>declare </EM>the Class and methods before you can write the 
test, but you can write the test before the method body, all in the same IDE, 
which is pretty slick. </P>
<P>But since the majority of programming is maintenance and enhancement, 
nearly-TDD is usually good enough. And for maintaining legacy Java, Agitator 
will deduce a lot of the class invariants&nbsp;and test cases for you, way cool 
-- with full control to override and tune as needed. It has hooks and tools to 
mock simple things automatically and to do sophisticated mocking of the regular 
important objects, much like <A 
href="http://search.cpan.org/dist/Test-MockObject">T:MO</A>, <A 
href="http://search.cpan.org/dist/DBD-Mock">DBD::Mock</A>, <A 
href="http://search.cpan.org/dist/Test-MockClass">T::MC</A>, only with hooks 
into the IDE.)&nbsp; This could actually be easier to use than <A 
href="http://search.cpan.org/dist/Test-Simple/">Test::Simple</A>. (*cue 
background cries* <EM>Heresy! </EM>)</P><br/><br/><P>For pre-existing projects, adopting&nbsp;<A 
href="http://www.junit.org/">jUnit</A> testing "Big Bang" is <A 
href="http://c2.com/cgi/wiki?MoreObjectionsToWorkingTestFirst">widely 
considered</A> to take too much work to scaffold a test, it's much more work 
than Perl's&nbsp;<A 
href="http://search.cpan.org/dist/Test-Simple/">Test::Simple</A>/<A 
href="http://search.cpan.org/dist/Test-Harness">T:H</A>/<A 
href="http://search.cpan.org/dist/Test-More">T:M</A>&nbsp;although partly that's 
because of the foliation of the Java class trees and <A 
href="http://geekswithblogs.net/sbellware/archive/2005/03/18/26621.aspx">visual 
program "designers"</A> not designing for testability? There are other toolsets 
for making&nbsp;mock objects/classes and generating&nbsp;jUnit tests, and other 
tools for doing style/rule validation, but&nbsp;this has it all. They've figured 
out that they need to provide tools that are useful to the developer at the 
moment of writing code <EM>and</EM>&nbsp;while refactoring/debugging/enhancing, 
<EM>and </EM>useful to the Build/ConfigMgt team, <EM>and</EM> provide useful 
statistics to management.</P><br/><br/><P>A key point that bears repeating is that, as with jUnit, 
&nbsp;<STRONG>Agitator is primarily designed for <EM>true</EM> <U>unit</U> 
testing</STRONG>: white box testing of just one class's methods at a time, under 
the <U>assumption</U> that its dependencies work.&nbsp;As with induction, one is 
allowed to assume all else is fine, and one need not,&nbsp;one would prefer not, 
to rely on&nbsp;(possibly broken)&nbsp;out-of-class componentry. Why? So that a 
class test failure implies exactly and unambiguously either a class method error 
or a class test error. (It's Bad enough that it might really be a superclass 
error, but we don't want to be distracted by a underlying layer error that 
should be caught by it's unit-test.) This may require replacing those interfaces 
with Mock objects either automatically or with custom factories. [No, that's <A 
href="http://http://www.martinfowler.com/articles/mocksArentStubs.html">not 
stubbing</A>!] So, Yes, <STRONG>you can <U>unit</U> test server-side code on the 
developer's PC </STRONG>-- you don't need FTP, a printer, a DB, or active Unix 
daemon processes to <U>unit</U> test, only to Integration Test -- if the 
dependencies are mocked. (Like jUnit, Agitar can be (ab)used to run SIT tests 
and regression tests by driving the top level class with factories and not 
mocking anything. That's ok, but that's not Developer Unit Testing.)</P><br/><br/><P>I deduce from this that the House Style Rules should include that all complex 
subsystems that aren't intrinsically trusted (JDBC) must come with Unit test set 
(or have one added); each&nbsp;should provide a TestHelper class with factories; 
and that the rule for what to mock is whatever has Unit tests of its own or is 
trusted but complex. The little things like "string" one obviously doesn't 
mock.</P><br/><br/>
<P>The downside is that it doesn't work with <A 
href="http://http://e-p-i-c.sourceforge.net/">EPIC</A>&nbsp;-- it's Java only. 
(And it is nowhere near Free or free, if either is important to you, but then, 
it's Java for the enterprise, so that's no surprise.)</P><br/><br/>
<P>Interesting <b>quotes</b> found on web on this topic...</P>
<UL>
  <LI>&nbsp;<FONT size=2><A 
  href="http://www.jroller.com/page/diathesis/20040712">people are in the habit of 
  calling any test written in <B>JUnit</B> a <B>unit</B> 
  <B>test</B>.</A></FONT>
  <LI>"<A href="http://c2.com/cgi/wiki?WikiObjectionsToWorkingTestFirst">TDD is 
  not a silver bullet</A>. Cases where a wrong test 
  passes a wrong code are not unheard of, but are not frequent enough to be a 
  major negative factor. Cases where a test that discovers a defect is not 
  written are a much bigger problem." 
  <LI><A href="http://c2.com/cgi/wiki?WikiObjectionsToWorkingTestFirst">Tests 
  are easy to write</A> - very simple, very modular code. So use easy things to 
  make the hard things - <A 
  href="http://c2.com/cgi/wiki?ProductionCode">ProductionCode</A> - easy to write
  <LI>Be careful MO does not implement any logic in its fake 
  objects, <A href="http://jakarta.apache.org/cactus/mock_vs_cactus.html">that 
  would be "stubbing"</A>
  <LI><A 
  href="http://www.martinfowler.com/articles/mocksArentStubs.html">Mocks aren't 
  Stubs</A> ... Interaction-based testers write 
  mocks for all secondary objects. State-based testers write stubs only for 
  those objects where it's not practical to use the real object - external 
  services, things that are expensive, and some things that are awkward to test 
  in a state-based way such as a cache.    
  </LI></UL><br/><br/></p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


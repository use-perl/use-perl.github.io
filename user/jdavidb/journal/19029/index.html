<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of jdavidb: Big directory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Big directory</h1>
<h2><a href="/user/jdavidb/">jdavidb</a> on 2004-06-01T13:29:29</h2>
</div> <!-- /span4 -->


<div class="span8">
<p><p>Working in a directory with a large number of files:</p>

<pre>
$ time ls -1  # GNU ls
real    2m22.169s
user    0m2.080s
sys     0m5.850s
$ time /bin/ls -1  # Solaris ls
real    0m18.013s
user    0m1.230s
sys     0m1.390s
$ time ~/perlls.pl  # Custom Perl program
real    0m22.355s
user    0m1.200s
sys     0m1.260s
</pre>

<p>Interesting facts.  I'd been fretting about how slow using the standard utilities was, until I remembered that I had installed GNU versions of these utilities in my ~/bin, presumably because they were better.  I'm sure GNU ls does something like load the entire directory into memory before printing it out or something, in order to use a "different" implementation method and avoid copyright infringement.</p>

<p>Maybe I should install busybox...</p>

<p>For the record, I ended up using a custom Perl program to do what I was trying to do, and it still seemed the fastest solution (even including development time for the program).</p>

<p><b>Update:</b> it made more sense when I got the proper figures posted, instead of duplicating the figures for Solaris ls.  That turns out to be a bug with Cygwin cut and paste...</p></p>


<hr/>



<h2>Turn off sorting</h2>
<h3><a href="/user/Dom2/">Dom2</a> on 2004-06-01T20:39:05</h3>
This <a href="http://docs.freebsd.org/cgi/mid.cgi?40867A5D.9010600" title="freebsd.org">came up</a freebsd.org> recently on the freebsd-current list and the conclusion was that not only do you have to turn off statting each file (no <tt>-l</tt>), you also have to turn off sorting of the results list.  This is <tt>ls -f</tt> in FreeBSD.

<p>-Dom</p>



<blockquote>

<h2>Re:Turn off sorting</h2>
<h3><a href="/user/jdavidb/">jdavidb</a> on 2004-06-01T20:51:02</h3>
<p>That's a -1, not a -l.  The reason I added -1 to the test was to make sure none of the ls versions was spending extra time trying to compute the number of filenames that could fit on a line or whatever.  (And also because my little hacked-up Perl version couldn't do that.)</p>

<p>I posted to the GNU coreutils (combination of fileutils, which includes ls, and two other packages) bugs mailing list, and they responded by asking the version of my GNU ls and my OS.  Turns out ls from GNU coreutils 5.0 (my version) has this problem, but the latest version did not.  As always, the solution always seems to be to upgrade.<nobr> <wbr></nobr>:)</p>

<p>Yikes.  I'm the only person I've ever known who has filed a bug report on ls!</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>


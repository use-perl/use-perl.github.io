<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>use.perl.org journal of Alias: Creating GUI code for Padre - A walk through a new feature</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the
bottom of the topbar */
      }
    </style>
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse"
data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/"><img src="/static/img/slashhead.png"/></a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/journals/">Journals</a></li>
              <li><a href="/stories/">Stories</a></li>
            </ul>
            <p class="navbar-text">All the Perl that's Practical to Extract and Report</p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>



<div class="container">

<div class="row">

<div class="span4">
<h1>Creating GUI code for Padre - A walk through a new feature</h1>
<h2><a href="/user/Alias/">Alias</a> on 2009-09-17T18:15:39</h2>
</div> <!-- /span4 -->


<div class="span8">
<p>One of the most common problems people who have only recently arrived on the Padre team have is the creation of Wx code that, well, doesn't suck ass.<br/><br/>The API is rather opaque, badly documented (for now) and it's behaviour isn't always entirely obvious.<br/><br/>So when Sewi, who's been trying to make headway on a Padre::File API (for doing remote SSH/FTP/etc file operations), demonstrated quite possibly the worst textbox entry dialog ever seen, he was more than happy for someone else to produce a better one.<br/><br/>Since it's a relatively straight forward job, I thought that it might be a good idea to demonstrate how to do Wx GUI code in a reasonably efficient and decent looking way.<br/><br/>You can follow the set of commits, and see graphical diffs of each, at the following:<br/><br/><a href="http://fisheye2.atlassian.com/changelog/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre">http://fisheye2.atlassian.com/changelog/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre</a><br/><br/>The implementation starts at <a href="http://fisheye2.atlassian.com/changelog/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/?cs=7970">commit 7970</a>.<br/><br/>I start by mocking up the layout in wxGlade. The Perl code generated by this Python application is... well... questionable. While it technically works (thankfully) you'd struggle to build a scalable application using the style of code it produces.<br/><br/>HOWEVER, once you get past the horrible boilerplate, what it does generate is pretty much perfect code for creating the various widgets and sizers. This is the most verbose and annoying part, so having something to copy and paste liberally from makes a huge difference.<br/><br/>In <a href="http://fisheye2.atlassian.com/rdiff/padre?csid=7971&u&N">commit 7971</a> I drop in a basic class skeleton for a dialog. This is just a cut and paste job from the Find dialog, and does nothing more than create the dialog itself, sucking in a role that simplifies a few things for dialogs that are direct children of the main window.<br/><br/><a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7971&r2=7975">Commit 7975</a> sucks in the code from wxGlade for the actual form components. We do this first because the layout doesn't matter until we have the parts that actually do work in place.<br/><br/>Unfortunately, the code doesn't actually work, because the wxGlade code uses wxCONSTANT values directly and Padre does not. It turns out exporting 5000 constants into 300 classes results in a rather ugly memory overhead, so in Padre we use Wx::wxCONSTANT directly.<br/><br/>So in <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7971&r2=7975">commit 7976</a> I drop in a temporary "use Wx 'everything';" so the constants work.<br/><br/><a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7976&r2=7978">Commit 7978</a> drops in the wxGlade layout code, which should pretty much just work as is.<br/><br/>Some of the objects use horrible auto-generated "sizer_1" variables. But oddly, I find for some of the stuff like the border sizers it doesn't really matter that much, since there's really not much better meaning you can use instead.<br/><br/>And now to the clean up.<br/><br/>First up, wxGlade likes to make more things accessors than are really necessary. So in <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7978&r2=7980">7980</a> we convert them over to regular lexicals that will just exist in the C heirachy of the application, not the Perl heirachy. <br/><br/>Next, in <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7980&r2=7983">commit 7983</a> I'll separate, comment, group and layout the sizer code into something that's actually maintainable.<br/><br/>Note that I'm doing pretty much all of this without actually running anything, although I do bother to at least run the test script which checks that the code compiles. We'll get to the running of code later.<br/><br/>But in anticipation of that day (and now that all the cut and pasting is done) we do a standardisation pass.<br/><br/>In commit <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7988&r2=7989">7989</a> we finish converting all the wxCONSTANTS to Wx::wxCONSTANTS, and add in the standard Padre copyright fragments to the Debian people don't get annoyed with us. :)<br/><br/>Now to the actual functionality.<br/><br/>Copy/paste again from the Find dialog gives us a working cancel button in commit <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7988&r2=7989">7989</a> and a working OK button in <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7995&r2=7999">commit 7999</a>.<br/><br/>Having reached this point, we pause briefly to watch azawawi blatantly steal commit 8000 and quietly loath and envy him.<br/><br/>Anyway, onwards again.<br/><br/>So <b>now</b> we can start to actually run the code. And of course, as soon as I tried to do that I discovered that the dialog really should run modally. So in <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=7999&r2=8005">commit 8005</a> we do some refactoring to make the dialog modal (and to give it a top level easy to use method for starting and stopping the dialog).<br/><br/>Now, finally, we start running it for real. So the final <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Dialog/OpenURL.pm?r1=8005&r2=8011">commit 8011</a> is debugging, plus replacing the old dialog in the <a href="http://fisheye2.atlassian.com/browse/user/author=adamk,date=2009-09-18T00%3A00%3A00/padre/trunk/Padre/lib/Padre/Wx/Main.pm?r1=8002&r2=8011">main window class</a>.<br/><br/>The result? A great looking "Open URL" menu entry that does absolutely nothing at all other than spit out a "this doesn't work" message box.<br/><br/>But then that's the main point. By making a working chunk of UI ready for Sewi to step in and take over, I've removed a major obstacle from his completing the feature that he REALLY cares about.<br/><br/>And hopefully this entry can serve as something of a template for others needing to create simple to medium complexity gui code.</p>


<hr/>



<h2>That doesn't sound much better than the &quot;hard&quot; way</h2>
<h3><a href="/user/TeeJay/">TeeJay</a> on 2009-09-18T14:13:35</h3>
<p><nobr> <wbr></nobr>.. that I <a href="http://use.perl.org/user/TeeJay/journal/39518" title="perl.org">blogged previously</a perl.org>
</p><p>
Maybe it's just me, but I find GUI Designers cumbersome, much nicer to play around with demos and samples - no boiler plate, learn about the API instead of leaving a trail of boilerplate and cargo-culted code.
</p>





</div> <!-- /span8 -->

</div> <!-- row -->
</div> <!-- /container -->



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

  </body>
</html>

